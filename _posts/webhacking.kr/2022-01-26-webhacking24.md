---
title: "[webhacking.kr] 24ë²ˆ ë¬¸ì œ í’€ì´[PHP]"
categories:
  - webhacking
tags:
  - webhacking.kr
  - wargame
  - php
toc: true
toc_sticky: true
toc_label: "24ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/webhacking.jpg
---

ğŸ’¡ Webhacking.kr challenge(old) 24ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ
## ë¬¸ì œ í™”ë©´
  ![image](https://user-images.githubusercontent.com/33647663/151004365-d7da5f7c-a431-4fcc-9528-259d238b41d1.png)

## ë¬¸ì œ ì†ŒìŠ¤ ì½”ë“œ
  ```php
  <?php
  extract($_SERVER);
  extract($_COOKIE);
  $ip = $REMOTE_ADDR;
  $agent = $HTTP_USER_AGENT;
  if($REMOTE_ADDR){
    $ip = htmlspecialchars($REMOTE_ADDR);
    $ip = str_replace("..",".",$ip);
    $ip = str_replace("12","",$ip);
    $ip = str_replace("7.","",$ip);
    $ip = str_replace("0.","",$ip);
  }
  if($HTTP_USER_AGENT){
    $agent=htmlspecialchars($HTTP_USER_AGENT);
  }
  echo "<table border=1><tr><td>client ip</td><td>{$ip}</td></tr><tr><td>agent</td><td>{$agent}</td></tr></table>";
  if($ip=="127.0.0.1"){
    solve(24);
    exit();
  }
  else{
    echo "<hr><center>Wrong IP!</center>";
  }
  ```
## ë¬¸ì œ í’€ì´
  ë¬¸ì œë¥¼ ë³´ë©´ ```$ip=="127.0.0.1"```ì´ ë˜ë©´ í’€ë¦¬ê²Œ ë©ë‹ˆë‹¤.ì´ ë¬¸ì œë¥¼ í’€ê¸° ìœ„í•´ì„œëŠ” extract í•¨ìˆ˜ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.

  extract í•¨ìˆ˜ì˜ ì˜ˆì‹œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

  ```php
  <?php
  $array['x'] = 'apple';
  $array['y'] = 'banana';
  $array['z'] = 'carrot';

  extract($array)l
  echo $x; //'apple'
  echo $y; //'banana'
  echo $z; //'carrot
  ?>
  ```
 
  ë°°ì—´ì˜ 'key'ê°’ì„ ë³€ìˆ˜ì˜ ì´ë¦„ìœ¼ë¡œ í•˜ì—¬ ê°’ì„ ì„ ì–¸í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ë²ˆ ë¬¸ì œì—ì„œ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ 2ê°€ì§€ ë°°ì—´ì— ëŒ€í•´ì„œ extractë¥¼ í•´ì£¼ê³  ìˆìŠµë‹ˆë‹¤.
  
  ```php
  extract($_SERVER);
  extract($_COOKIE);
  ```
  
  ì´ ì¤‘ ì£¼ìš”í•œ ë¶€ë¶„ì€ $_COOKIEë¥¼ $_SERVER ë³´ë‹¤ ë‚˜ì¤‘ì— extractë¥¼ í•´ì£¼ê³  ìˆìœ¼ë©°, COOKIEëŠ” ì‚¬ìš©ì ì¸¡ì—ì„œ ì„¤ì •í•´ì„œ ë³´ë‚¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, $_SERVERì—ì„œ extract ëœ ë³€ìˆ˜ë“¤ì„ ë®ì–´ ì“¸ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

  í˜„ì¬ëŠ” ì¿ í‚¤ ê°’ì— ì•„ë¬´ê²ƒë„ ë„£ì§€ ì•Šê³  ì „ì†¡ì„ í–ˆê¸° ë•Œë¬¸ì— $_SERVER['REMOTE_ADDR'],$_SERVER['HTTP_USER_AGENT'] ê°’ì´ extract ë˜ì–´ í™”ë©´ì— ì¶œë ¥ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì¤‘ HTTP_USER_AGENTëŠ” í”„ë¡ì‹œ íˆ´ì„ í†µí•´ì„œ ì§ì ‘ USER-AGNET í—¤ë”ë¥¼ ë³€ê²½í•¨ìœ¼ë¡œì¨ $_SERVER['HTTP_USER_AGENT] ê°’ì„ ë°”ê¿€ ìˆ˜ë„ ìˆê³ , Cookie ê°’ì— HTTP_USER_AGENT ê°’ì„ ì¤˜ì„œ ë°”ê¿€ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë³¸ ë¬¸ì œì—ì„œëŠ” ë¬¸ì œë¥¼ í’€ë•Œ HTTP_USER_AGENT ëŠ” í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤.


  ë¬¸ì œë¥¼ í’€ë•Œ í•„ìš”í•œ ë¶€ë¶„ì€ $ip ë³€ìˆ˜ì…ë‹ˆë‹¤. í˜„ì¬ $ipì—ëŠ” $_SERVER['REMOTE_ADDR']ì´ ë“¤ì–´ê°€ ìˆìŠµë‹ˆë‹¤. ì´ ê°’ì„ ì¿ í‚¤ì— ì¤Œìœ¼ë¡œì¨ ê°’ì„ ë®ì–´ ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  ë‹¤ìŒê³¼ ê°™ì´ ì¿ í‚¤ ê°’ì„ ì¶”ê°€í•´ì„œ ë³´ë‚´ë©´ í™”ë©´ìƒì—ì„œ clinet ipê°€ ë°”ë€Œì—ˆìŒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/151014114-dc54b370-2ff4-4aae-8a0b-fe4be7a0c31d.png)

  ![image](https://user-images.githubusercontent.com/33647663/151014171-16345069-d1aa-4711-9692-daad856b39b7.png)


  ì¿ í‚¤ì— ì¤€ ê°’ì´ ì„œë²„ì—ì„œ ì–´ë–¤ ë¡œì§ì— ì˜í•´ì„œ ë°”ë€ŒëŠ”ì§€ ì¤‘ìš”í•œ ë¼ì¸ë“¤ë§Œ ë¹¼ì„œ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

  ```php
  extract($_COOKIE);
  $ip = $REMOTE_ADDR;
  if($REMOTE_ADDR){
    $ip = htmlspecialchars($REMOTE_ADDR);
    $ip = str_replace("..",".",$ip);
    $ip = str_replace("12","",$ip);
    $ip = str_replace("7.","",$ip);
    $ip = str_replace("0.","",$ip);
  }
  if($ip=="127.0.0.1"){
    solve(24);
  }
  ```

  ì¿ í‚¤ì— ì„¤ì •ëœ ipê°€ ë‹¤ìŒì˜ ê·œì¹™ì— ì˜í•´ì„œ ëŒ€ì²´ ë©ë‹ˆë‹¤.
  1. ".." -> "."
  2. "12" -> ""
  3. "7." -> ""
  4. "0." -> ""
  
  ìœ„ì˜ ê·œì¹™ë“¤ì„ í†µê³¼í•œ ë’¤ì— 127.0.0.1ì´ ë“¤ì–´ê°€ë„ë¡ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•´ ì¤ë‹ˆë‹¤.

  112277...00...00...1 

  ![image](https://user-images.githubusercontent.com/33647663/151016060-cead16e3-544f-40d0-b17d-d61fb789eb2e.png)

  í´ë¦¬ì–´

  ![image](https://user-images.githubusercontent.com/33647663/151016092-5c7300f4-7e36-4a8a-a6f6-775987c78a5a.png)
