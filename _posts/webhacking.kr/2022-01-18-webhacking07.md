---
title: "[webhacking.kr] 7ë²ˆ ë¬¸ì œ í’€ì´[SQL]"
categories:
  - webhacking
tags:
  - webhacking.kr
  - wargame
  - SQL
toc: true
toc_sticky: true
toc_label: "7ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
---

ğŸ’¡ Webhacking.kr challenge(old) 7ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ

## ë¬¸ì œ í™”ë©´
![image](https://user-images.githubusercontent.com/33647663/149808614-5431b303-9015-4639-84a1-046ed8aa84ba.png)

## ì†ŒìŠ¤ì½”ë“œ
 ```php
  <?php
    include "../../config.php";
    if($_GET['view_source']) view_source();
  ?><html>
  <head>
  <title>Challenge 7</title>
  </head>
  <body>
  <?php
  $go=$_GET['val'];
  if(!$go) { echo("<meta http-equiv=refresh content=0;url=index.php?val=1>"); }
  echo("<html><head><title>admin page</title></head><body bgcolor='black'><font size=2 color=gray><b><h3>Admin page</h3></b><p>");
  if(preg_match("/2|-|\+|from|_|=|\\s|\*|\//i",$go)) exit("Access Denied!");
  $db = dbconnect();
  $rand=rand(1,5);
  if($rand==1){
    $result=mysqli_query($db,"select lv from chall7 where lv=($go)") or die("nice try!");
  }
  if($rand==2){
    $result=mysqli_query($db,"select lv from chall7 where lv=(($go))") or die("nice try!");
  }
  if($rand==3){
    $result=mysqli_query($db,"select lv from chall7 where lv=((($go)))") or die("nice try!");
  }
  if($rand==4){
    $result=mysqli_query($db,"select lv from chall7 where lv=(((($go))))") or die("nice try!");
  }
  if($rand==5){
    $result=mysqli_query($db,"select lv from chall7 where lv=((((($go)))))") or die("nice try!");
  }
  $data=mysqli_fetch_array($result);
  if(!$data[0]) { echo("query error"); exit(); }
  if($data[0]==1){
    echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Access_Denied!')\"><p>");
  }
  elseif($data[0]==2){
    echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Hello admin')\"><p>");
    solve(7);
  }
  ?>
  <a href=./?view_source=1>view-source</a>
  </body>
  </html>

 ```

# í’€ì´

## ë¬¸ì œ ë¶„ì„
  ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ solveí•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ” ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
  ```php
  $data=mysqli_fetch_array($result);
  if(!$data[0]) { echo("query error"); exit(); }
  if($data[0]==1){
    echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Access_Denied!')\"><p>");
  }
  elseif($data[0]==2){
    echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Hello admin')\"><p>");
    solve(7);
  }
  ```

  ìœ„ ë¶€ë¶„ì˜ ë¡œì§ë§Œ ë¶„ì„í•´ ë³´ë©´, DBì¿¼ë¦¬ ê²°ê³¼ë¡œ ë‚˜ì˜¨ resultì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ì„ ë•Œ
  1. ë°ì´í„°ê°€ ì—†ìœ¼ë©´ : query error
  2. ë°ì´í„°ê°€ 1ì´ë©´ : í™”ë©´ì— 'auth' ë²„íŠ¼ì„ ë§Œë“¤ê³  ëˆ„ë¥´ë©´, Access_Deniedê°€ í‘œì‹œ
  3. ë°ì´í„°ê°€ 2ì´ë©´ : Solve


  ë”°ë¼ì„œ ê²°ë¡ ì ìœ¼ë¡œ ë³¸ ë¬¸ì œë¥¼ DBì—ì„œ ì¿¼ë¦¬ ê²°ê³¼ë¡œ ```2```ë¼ëŠ” ê°’ì´ ë‚˜ì˜¤ê²Œ í•´ì•¼ í•œë‹¤.

  ê·¸ëŸ¼ DBì˜ ì¿¼ë¦¬ë¬¸ì„ ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

  ```php
  $rand=rand(1,5);
  if($rand==1){
    $result=mysqli_query($db,"select lv from chall7 where lv=($go)") or die("nice try!");
  }
  if($rand==2){
    $result=mysqli_query($db,"select lv from chall7 where lv=(($go))") or die("nice try!");
  }
  if($rand==3){
    $result=mysqli_query($db,"select lv from chall7 where lv=((($go)))") or die("nice try!");
  }
  if($rand==4){
    $result=mysqli_query($db,"select lv from chall7 where lv=(((($go))))") or die("nice try!");
  }
  if($rand==5){
    $result=mysqli_query($db,"select lv from chall7 where lv=((((($go)))))") or die("nice try!");
  }
  ```
  ìœ„ì˜ ì½”ë“œì—ì„œ ëœë¤ì€ ë³„ë¡œ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤. ëœë¤ê°’ì€ ì–´ì°¨í”¼ ê³„ì† ì‹œë„í•˜ë©´ ë°”ë€Œë‹ˆê¹Œ í—·ê°ˆë¦¬ê²Œ 5ê°€ì§€ë¥¼ ìƒê°í•˜ì§€ ì•Šê³ , **$randê°’ì´ 1ì´ë¼ ê°€ì •**í•˜ê³  ë¬¸ì œë¥¼ í’€ë©´ ëœë‹¤. ì¦‰ ë‹¤ìŒì˜ ì¿¼ë¦¬ë¬¸ë§Œ ë¶„ì„í•˜ë©´ ëœë‹¤.

  ```php
  $result=mysqli_query($db,"select lv from chall7 where lv=($go)") or die("nice try!");
  ```

  ì¿¼ë¦¬ë¬¸ì€ ```select lv from chall7 where lv = ( 'ì…ë ¥ ê°’' )```ì´ë‹¤. 

  ì•„ì£¼ ì‰½ê²Œ ìƒê°í•˜ë©´ **ì…ë ¥**ìœ¼ë¡œ **2**ë§Œ ì…ë ¥í•˜ë©´ ëì¸ë°, ì½”ë“œë¥¼ ë³´ë©´ ë§¨ ì²˜ìŒ ë‚˜ì˜ ì…ë ¥ì— ëŒ€í•´ì„œ í•„í„°ë§ì„ ìˆ˜í–‰í•œë‹¤.


  ```php
  if(preg_match("/2|-|\+|from|_|=|\\s|\*|\//i",$go)) exit("Access Denied!");
  ```

  ìœ„ì˜ í•„í„°ë§ìœ¼ë¡œ í•„í„°ë§ ë˜ëŠ” ë¬¸ìë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤

  [```2```,  ```-``` , ```+``` , ```from``` , ```_``` , ```=```, ```\\s``` , ```*``` , ```/```] 
  
  ì´ì¤‘ ```\\s```ëŠ” ë„ì–´ì“°ê¸° ë¬¸ì %20, %0a, %09ë¥¼ ëª¨ë‘ í•„í„°ë§ í•œë‹¤.

  ì¦‰ ìœ„ì˜ ë¬¸ìë“¤ì„ ì´ìš©í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ì¼€ì´ìŠ¤ë¥¼ ìƒê°í•´ì„œ dbì˜ ê²°ê³¼ë¡œ 2ê°€ ë‚˜ì˜¤ê²Œ í•˜ë©´ ëœë‹¤.

  ì¼ë‹¨ ë¨¼ì € ìƒê°í•´ì•¼ í•  ê²ƒì€ **2**ê°€ ì…ë ¥ì´ ì•ˆë˜ë‹ˆê¹Œ ìš°ë¦¬ëŠ” ì–´ë–»ê²Œë“  SQLì—ì„œ 2ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤. 2ë¥¼ ë§Œë“œëŠ” ë°©ë²•ì€ ì •ë§ ë‹¤ì–‘í•œë°, ë‹¤ìŒ [ë¬¸ì„œ](https://dev.mysql.com/doc/refman/8.0/en/built-in-function-reference.html)ë¥¼ ì°¸ê³ í•˜ë©´ì„œ 2ë¥¼ ë§Œë“œëŠ” ë°©ë²•ì„ ì°¾ìœ¼ë©´ ëœë‹¤.

  ëŒ€ë¶€ë¶„ì˜ ì—°ì‚°ìë¥¼ í™œìš©í•´ì„œ 2ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´
  1.  ```6&10```
  2.  ```16>>3```
  3.  ```5%3``` 
  
  ë“±ë“± ë§¤ìš° ë‹¤ì–‘í•œ ë°©ë²•ì´ ìˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/149812309-8fb3df36-6670-4372-9865-f14aff488886.png)

  ìœ„ì˜ ë°©ì‹ë“¤ ëª¨ë‘ ë¬¸ì œì—ì„œ ì£¼ì–´ì§„ ì‚¬ì¹™ì—°ì‚° ë° ë‹¤ë¥¸ í•„í„°ë§ì„ ëª¨ë‘ ìš°íšŒí•˜ê¸° ë•Œë¬¸ì— ì…ë ¥ ê°’ìœ¼ë¡œ ë„£ì–´ë³¸ë‹¤.
  
   ![image](https://user-images.githubusercontent.com/33647663/149812667-53fcc91b-6a63-4fca-8137-bdb66b3b4ea2.png)

   í•˜ì§€ë§Œ ì‘ë‹µ ê²°ê³¼ë¥¼ ë³´ë©´ í•„í„°ë§ì— ê±¸ë ¸ë‹¤ë©´ ë‹¤ìŒ í•¨ìˆ˜ì— ì˜í•´ ```Access Denied```ê°€ ê±¸ë ¤ì•¼ í•˜ëŠ”ë°, query errorê°€ ë‚˜ì™”ë‹¤. 

   ```php
   if(preg_match("/2|-|\+|from|_|=|\\s|\*|\//i",$go)) exit("Access Denied!");
   ```
   

   ì¿¼ë¦¬ ì—ëŸ¬ê°€ ë‚˜ì˜¤ëŠ” ë¶€ë¶„ì€ DB ì¿¼ë¦¬ ê²°ê³¼ë¡œ ë¶€í„° ì•„ë¬´ëŸ° ê°’ì„ ë°›ì§€ ëª»í–ˆë‹¤ëŠ” ê²ƒì´ë‹¤. 
  ```php
  if(!$data[0]) { echo("query error"); exit(); }
  if($data[0]==1){
    echo("<input type=button style=border:0;bgcolor='gray' value='auth' onclick=\"alert('Access_Denied!')\"><p>");
   }
  ```

  ì—¬ê¸°ì„œ ìƒê° í•´ì•¼ í•  ê²ƒì€ DB ì¿¼ë¦¬ ì—ëŸ¬ê°€ ë‚¬ë‹¤ë©´ ì—¬ê¸°ê¹Œì§€ ì˜¤ì§€ë„ ëª»í•˜ëŠ” ê±´ë°, ì—¬ê¸° ê¹Œì§€ ì™”ë‹¤ëŠ” ê²ƒì€ ì •ìƒì ìœ¼ë¡œ ì¿¼ë¦¬ê°€ ì‹¤í–‰ ë˜ì—ˆì§€ë§Œ DBì— lv = 2ë¼ëŠ” ì»¬ëŸ¼ì´ ì—†ë‹¤ëŠ” ëœ»ì´ë‹¤.

  ì¦‰ ìš°ë¦¬ëŠ” DBì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” lv = 2 ì»¬ëŸ¼ì„ ë§Œë“¤ì–´ì„œ ë°˜í™˜ì„ í•´ì•¼ í•˜ë¯€ë¡œ Union Select êµ¬ë¬¸ì„ ì´ìš©í•´ì•¼ í•œë‹¤.
  
  ì•„ë˜ ì¿¼ë¦¬ ë¬¸ì²˜ëŸ¼ lv=500ì´ë¼ëŠ” ê°’ì´ DBì— ì—†ì–´ë„ 2ì˜ ê°’ì„ ë°˜í™˜í•  ìˆ˜ ìˆëŠ” ì›ë¦¬ì´ë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/149813559-d4e0e174-ddfa-45f7-b459-dc5911f1c899.png)

  í•„í„°ë§ ë¬¸ìë¥¼ ë‹¤ì‹œ ë³´ë©´

  [```2```,  ```-``` , ```+``` , ```from``` , ```_``` , ```=```, ```\\s``` , ```*``` , ```/```] 

  ìš°ë¦¬ëŠ” ë¬¸ì œì— **Union select 2**ë¥¼ ì…ë ¥í•˜ë ¤ë©´ ```\\s```ë•Œë¬¸ì— ë„ì–´ì“°ê¸°ë¥¼ ìš°íšŒí•˜ëŠ” ë°©ë²•ì„ ì°¾ì•„ì•¼ í•œë‹¤. 

  ê·¸ ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ì´ ê´„í˜¸ë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/149814231-dea3c75d-0d04-4081-9aa4-568adb50128a.png)

  ë³¸ ë¬¸ì œì—ì„œëŠ” ë‚˜ì˜ ì…ë ¥ê°’ì´ ë‹¤ìŒì˜ sqlë¬¸ì— ê·¸ëŒ€ë¡œ ì‚½ì…ì´ ë˜ë¯€ë¡œ ì´ë¥¼ ì§€ê¸ˆê¹Œì§€ ì •ë¦¬í•œ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ 
  1. 2ë¥¼ ë‹¤ë¥¸ ì—°ì‚°ìœ¼ë¡œ í‘œí˜„í•˜ì—¬ ìš°íšŒ 
  2. ë„ì–´ì“°ê¸°ë¥¼ ê´„í˜¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš°íšŒ

  í•˜ì—¬ì„œ ë‚˜ì˜¨ ìµœì¢… ì¿¼ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

  ì…ë ¥ ê°’ : ```999)union(select(16>>3)```

  ì´ë ‡ê²Œ ë˜ë©´ ë‚˜ì˜ ì¿¼ë¦¬ê°€ ì›¹ì„œë²„ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì²˜ë¦¬ ë  ê²ƒì´ë‹¤.

  ```select lv from chall7 where lv=(999)union(select(16>>3))```

 ![image](https://user-images.githubusercontent.com/33647663/149814989-2dfb6017-df23-40a6-8546-4e3cf30ea013.png)

 ì‹œë„í•˜ë©´ ê·¸ë¦¼ê³¼ ê°™ì´ rand = 1ì´ ë ë•Œê¹Œì§€ í‹€ë¦° ê°’ì´ ì‹œë„ë˜ë‹¤ê°€ í’€ë¦¬ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

 ![image](https://user-images.githubusercontent.com/33647663/149815187-48b06321-a39a-448b-b727-1784597f3f58.png)

 ![image](https://user-images.githubusercontent.com/33647663/149815433-b44317c3-aeea-4fd9-8ff7-0206c535e8a5.png)

 

   

  

 
  
