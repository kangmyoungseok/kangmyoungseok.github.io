---
title: "[webhacking.kr] 59ë²ˆ ë¬¸ì œ í’€ì´[SQL Injection]"
categories:
  - webhacking
tags:
  - webhacking.kr
  - wargame
  - sql injection
  - time-based
toc: true
toc_sticky: true
toc_label: "59ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/webhacking.jpg
---

ğŸ’¡ Webhacking.kr challenge(old) 59ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ
  ![image](https://user-images.githubusercontent.com/33647663/154050379-f43f907d-31bb-4126-abac-7e83c51fb1d4.png){: .align-center}

  ```php
# ë¡œê·¸ì¸ ê¸°ëŠ¥
if($_POST['lid'] && isset($_POST['lphone'])){
    $_POST['lid'] = addslashes($_POST['lid']);
    $_POST['lphone'] = addslashes($_POST['lphone']);
    $result = mysqli_fetch_array(mysqli_query($db,"select id,lv from chall59 where id='{$_POST['lid']}' and phone='{$_POST['lphone']}'"));

# í´ë¦¬ì–´ ì¡°ê±´    
    if($result['id']){
      echo "id : {$result['id']}<br>lv : {$result['lv']}<br><br>";
      if($result['lv'] == "admin"){
      mysqli_query($db,"delete from chall59");
      solve(59);
    }
  }

# íšŒì›ê°€ì… ê¸°ëŠ¥
  if($_POST['id'] && isset($_POST['phone'])){
    $_POST['id'] = addslashes($_POST['id']);
    $_POST['phone'] = addslashes($_POST['phone']);
    if(strlen($_POST['phone'])>=20) exit("Access Denied");
    if(preg_match("/admin/i",$_POST['id'])) exit("Access Denied");
    if(preg_match("/admin|0x|#|hex|char|ascii|ord|select/i",$_POST['phone'])) exit("Access Denied");
    mysqli_query($db,"insert into chall59 values('{$_POST['id']}',{$_POST['phone']},'guest')");
  }
  ```

íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ admin lvë¡œ ë¡œê·¸ì¸ì„ í•˜ë©´ ì„±ê³µí•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.
<br>

# ë¬¸ì œ í’€ì´
íšŒì›ê°€ì… ì‹œì— ì‚¬ìš©ë˜ëŠ” sql êµ¬ë¬¸ì…ë‹ˆë‹¤.

```sql
insert into chall59 values('{id}',{phone},'guest')
```

id, phoneì— ê°ê° ì ìš©ë˜ëŠ” ì¡°ê±´ì…ë‹ˆë‹¤.

- id 
  + addslashes()
  + admin í•„í„°ë§

- phone
  + addslashes()
  + ê¸¸ì´ < 20 
  + admin / 0x / # / hex / char / ascii / ord / select í•„í„°ë§

<br>
ë¡œê·¸ì¸ ì‹œì— ì‚¬ìš©ë˜ëŠ” sql êµ¬ë¬¸ì…ë‹ˆë‹¤.
```sql
select id,lv from chall59 where id='{id}' and phone='{phone}'
```

id,phoneì—ëŠ” ê°ê° addslashesê°€ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

íšŒì›ê°€ì…ìª½ ë¶€ë¶„ì„ ë³´ë©´ ì§‘ì¤‘ì ìœ¼ë¡œ í•„í„°ë§ì´ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ í•„í„°ë§ëœ ë¶€ë¶„ë“¤ì„ ìš°íšŒí•´ì„œ admin lvë¡œ íšŒì›ê°€ì…ì„ í•´ì•¼ í’€ë¦´ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ addslashes ê°€ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, id ìª½ì—ì„œëŠ” dbì˜ ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•˜ê¸°ê°€ ì–´ë µìŠµë‹ˆë‹¤. 
ê·¸ë¦¬ê³  phoneìª½ì—ëŠ” addslashesë•Œë¬¸ì— dbì˜ ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•  ë•Œ ë¬¸ìì—´ì„ ì‚¬ìš©í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  í•„í„°ë§ëœ ë‹¨ì–´ë“¤ì€ ëª¨ë‘ ascii ìˆ«ìë“¤ë¡œë¶€í„° ë¬¸ìì—´ì„ ìƒì„±(hex,char) í•˜ê±°ë‚˜ 0xë¡œ ë¬¸ìë¥¼ ì…ë ¥í•˜ëŠ” ê²ƒì„ ë§‰ê³  ìˆìŠµë‹ˆë‹¤.

ìœ„ì˜ ì¡°ê±´ë“¤ì€ idìª½ì—ì„œ ë¬¸ìì—´ì„ ì…ë ¥í•˜ê³ , phoneìª½ì—ì„œ idìª½ì˜ ë¬¸ìë¥¼ ì´ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¬¸ì œë¥¼ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ idì— ë¬¸ìì—´ì„ ì…ë ¥, phoneì—ì„œ í•´ë‹¹ ë¬¸ìë¥¼ db í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ì—¬ ë°”ê¿”ì¤Œìœ¼ë¡œì¨ id lv ë¡œ íšŒì›ê°€ì…ì´ ë©ë‹ˆë‹¤.

- id : nimda

- phone : 111,reverse(id))--   // ë§¨ ë§ˆì§€ë§‰ì— ê³µë°± í•„ìš”

í•´ë‹¹ ë³€ìˆ˜ë¡œ ìƒì„±ë˜ëŠ” ì¿¼ë¦¬ë¬¸
```sql
sql insert into chall59 values('nimda',111,reverse(id))-- ,'guest')
```

ì´ë ‡ê²Œ íšŒì›ê°€ì…ì„ í•œë‹¤ìŒ nimda, 111ë¡œ ë¡œê·¸ì¸ í•´ì£¼ë©´ ë¬¸ì œê°€ í’€ë¦½ë‹ˆë‹¤.


íšŒì›ê°€ì…

![image](https://user-images.githubusercontent.com/33647663/154053425-a6c957ed-5576-436c-8ebd-361ac03e16c6.png){: .align-center}

ë¡œê·¸ì¸

![image](https://user-images.githubusercontent.com/33647663/154053506-61f7f929-ecb1-42ec-84a0-6981a6467486.png){: .align-center}

