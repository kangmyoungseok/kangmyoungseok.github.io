---
title: "[webhacking.kr] 30ë²ˆ ë¬¸ì œ í’€ì´[php,apache] ì˜¤ë¥˜ í•´ê²°"
categories:
  - webhacking
tags:
  - webhacking.kr
  - wargame
  - php
  - apache
toc: true
toc_sticky: true
toc_label: "30ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
---

ğŸ’¡ Webhacking.kr challenge(old) 30ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ
  ![image](https://user-images.githubusercontent.com/33647663/152634355-e7bbed54-0f28-4c0e-b161-97538156d64b.png)

  ```php
  $db = mysqli_connect() or die();
  mysqli_select_db($db,"chall30") or die();
  $result = mysqli_fetch_array(mysqli_query($db,"select flag from chall30_answer")) or die();
  if($result[0]){
    include "/flag";
  }
  ```

# ë¬¸ì œ í’€ì´
  ë¬¸ì œ ì½”ë“œë¥¼ ë³´ë©´ mysql_connectë¥¼ í†µí•´ì„œ dbì— ì—°ê²°ì„ í•˜ê³ , 
  ```select flag from chall30_answer``` ì¿¼ë¦¬ë¬¸ì„ í†µí•´ì„œ ê²°ê³¼ë¥¼ ë°›ì•„ì˜¨ ë’¤, ê²°ê³¼ ê°’ì´ ì¡´ì¬í•˜ë©´ í”Œë˜ê·¸ë¥¼ ì¶œë ¥í•˜ëŠ” ë¡œì§ìœ¼ë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ë•Œ ì£¼ì˜í•´ì„œ ë´ì•¼í•  ì ì€ mysql_connect()í•¨ìˆ˜ì…ë‹ˆë‹¤.


  ì›ë˜ mysql_connect() í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ DBì— ì—°ê²°ì„ í•©ë‹ˆë‹¤.

  ```php
  $servername = "localhost";
  $username = "username";
  $password = "password";

  // Create connection
  $conn = new mysqli($servername, $username, $password);
  ```

  í•˜ì§€ë§Œ ë¬¸ì œì—ì„œëŠ” mysqli_connect í•¨ìˆ˜ì— ì¸ì ê°’ì„ ë„˜ê²¨ì£¼ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŸ´ë•ŒëŠ” [PHP ë¬¸ì„œ](https://www.php.net/manual/en/ini.list.php)ì— ë”°ë¥´ë©´ php.ini íŒŒì¼ì— ì„¤ì •ëœ default ê°’ìœ¼ë¡œ ì—°ê²°ì„ ì‹œë„í•œë‹¤ê³  í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ˆê¸° php.ini íŒŒì¼ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ port ë§Œ 3306ì´ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆê³ , ë‚˜ë¨¸ì§€ ê°’ì€ NULL ê°’ìœ¼ë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/152634545-5391dd14-b666-45bb-b7ec-1346a1f82676.png)
  

  Apacheë¥¼ ì´ìš©í•´ì„œ phpë¥¼ ìš´ì˜ í• ë•Œ, .htaccess íŒŒì¼ì„ ì´ìš©í•´ì„œ í•´ë‹¹ í´ë” í•˜ìœ„ì˜ ì„¤ì •ë“¤ì„ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  ìì„¸í•œ ë‚´ìš©ì€ [PHP ë¬¸ì„œ](https://www.php.net/manual/en/configuration.changes.php)ì— ë‚˜ì™€ìˆìŠµë‹ˆë‹¤.

  ë³¸ ë¬¸ì œì—ì„œëŠ” ì´ ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ .htaccess íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ê³ , .htaccess íŒŒì¼ì—ì„œëŠ” php.ini ì„¤ì • ê°’ì„ ë®ì–´ì“°ë„ë¡ í•˜ì—¬ DBì˜ default ê°’ë“¤ì„ ë°”ê¿”ì•¼ í•©ë‹ˆë‹¤.

  .htaccess íŒŒì¼ì—ì„œ php.ini ì„¤ì • ê°’ì„ ë°”ê¾¸ëŠ” ë¬¸ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

  ```ini
  php_value name value
  ```

  ìœ„ì˜ ë¬¸ë²•ì— ë”°ë¼ì„œ .htaccess íŒŒì¼ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì„¤ì • ê°’ì„ ë„£ì–´ì¤ë‹ˆë‹¤.

  ```ini
  php_value mysqli.default_host "[ë‚˜ì˜ DB ì„œë²„ IP]"
  php_value mysqli.default_user "[DB user]"
  php_value mysqli.default_pw "[DB ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸]"
  ```

  ì´ë ‡ê²Œ ì„¤ì •í•˜ì—¬ íŒŒì¼ì„ ì—…ë¡œë“œ í•œë‹¤ë©´, í•´ë‹¹ í´ë”ì—ì„œëŠ” ìë™ìœ¼ë¡œ ë‚˜ì˜ DB ì„œë²„ì— ì ‘ê·¼í•˜ì—¬ ë‚˜ì˜ DBì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ ê°„ ë’¤ í”Œë˜ê·¸ë¥¼ ì¶œë ¥í•´ ì¤„ ê²ƒì…ë‹ˆë‹¤.

  ì´ì œ ì´ ì¿¼ë¦¬ë¥¼ ë°›ì„ DBì„œë²„ë¥¼ êµ¬ì¶•í•´ ë³´ê² ìŠµë‹ˆë‹¤.
  ì €ëŠ” AWS Cloudë¥¼ ì´ìš©í•´ì„œ êµ¬ì¶•í•˜ì˜€ìœ¼ë©°, ìì‹ ì˜ DBì„œë²„ê°€ ìˆìœ¼ì‹  ë¶„ì€ í•´ë‹¹ ì„œë²„ë¥¼ ì´ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

## DBì„œë²„ êµ¬ì¶•
  - DB ë° table ìƒì„±<br>
  ```sql
  # ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
  create database chall30
  use chall30;

  # í…Œì´ë¸” ìƒì„±
  create table chall30_answer(
    flag int 
  );

  # ë°ì´í„° ë„£ê¸°
  insert into chall30_answer values(123);

  # ë°ì´í„° í™•ì¸
  select flag from chall30_answer;
  ```

  ![image](https://user-images.githubusercontent.com/33647663/152635127-bd071f6b-6d99-4548-a2f5-4b9e4d18d310.png)


  ì´ë ‡ê²Œ ìƒì„±í•˜ê³  ë¬¸ì œë¥¼ ë‹¤ì‹œ í™•ì¸í•´ ë³´ë©´

  ```php
  $db = mysqli_connect() or die();
  mysqli_select_db($db,"chall30") or die();
  $result = mysqli_fetch_array(mysqli_query($db,"select flag from chall30_answer")) or die();
  if($result[0]){
    include "/flag";
  }
  ```
  
  DBë¡œ ì—°ê²°ë§Œ ëœë‹¤ë©´ ì‘ë™ì´ ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  
  ì´ì œ í•´ë‹¹ DBê°€ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ ë‹¤ìŒì˜ ì„¤ì •ì„ í•´ì¤ë‹ˆë‹¤.



  - ì‚¬ìš©ì ìƒì„± ë° ê¶Œí•œ ì„¤ì •<br>
  ```sql
  # ì‚¬ìš©ì ìƒì„±
  create user 'test'@'%' identified by 'test1234';
  grant all privileges on *.* to 'test'@'%';
  ```

  ![image](https://user-images.githubusercontent.com/33647663/152635745-a71680bf-a0ae-4be2-9b0f-80d249e97999.png)

  - mysqld.cnf íŒŒì¼ ì„¤ì • ë³€ê²½<br>
  mysql ì„œë²„ë¥¼ ì„¤ì¹˜í•˜ë©´ ê¸°ë³¸ ê°’ìœ¼ë¡œ ë¡œì»¬ì—ì„œë§Œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •ì„ ë°”ê¿” ì¤ë‹ˆë‹¤.

  ì´ì „ ì„¤ì • ê°’

  ![image](https://user-images.githubusercontent.com/33647663/152635558-189317ab-8f2e-4fd0-95d1-0379a3837c47.png)

  31-32 ë²ˆì§¸ ë¼ì¸ ë³€ê²½

  ![image](https://user-images.githubusercontent.com/33647663/152635588-3187eaf5-63f6-4d77-9a9e-f6b9b0cf963d.png)

  ì„œë²„ ì¬ì‹œì‘ í›„ ë³€ê²½ ê°’ í™•ì¸

  ![image](https://user-images.githubusercontent.com/33647663/152635650-d97eb2c4-2fdd-4304-8eaa-0cf428ce4524.png)


  ì¶”ê°€ì ìœ¼ë¡œ ë°©í™”ë²½ì´ ìˆë‹¤ë©´ ë°©í™”ë²½ ì„¤ì •ì„ ë°”ê¿”ì£¼ê³ , ë¡œì»¬ì—ì„œ ì—°ê²°ì´ ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•´ë´…ë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/152635774-b95ca2b2-d4a1-4a08-a62d-b071dd804415.png)

  ì—¬ê¸°ê¹Œì§€ í•˜ë©´ DBë¥¼ êµ¬ì„±í•˜ê³  ì™¸ë¶€ì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

  ì´ì œ .htaccess íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ì—¬, ë¬¸ì œì—ì„œ ìë™ìœ¼ë¡œ ì œê°€ êµ¬ì„±í•œ DBì„œë²„ë¡œ ì ‘ê·¼í•˜ì—¬ ë°ì´í„°ë¥¼ ì½ì–´ê°€ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.

  ì €ì˜ ì„œë²„ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•˜ëŠ” .htaccess íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/152635852-2444c444-9b0b-4b75-abc0-ce87dbe795d3.png)

  íŒŒì¼ì„ ì—…ë¡œë“œ í•©ë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/152642270-567bdcac-25f7-4633-ba26-da514be030f9.png)

  ê·¸ë¦¬ê³  ì—…ë¡œë“œ í´ë”ì— index.phpì— ì ‘ê·¼ì„ í•´ë´…ë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/152642290-e68d7f93-b74e-48bd-a91f-da997d5a2a49.png)

  ì›ë˜ëŠ” ì—¬ê¸°ê¹Œì§€ í–ˆì„ë•Œ, ë‹µì´ ì¶œë ¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë‹µì´ ì¶œë ¥ë˜ì§€ ì•ŠëŠ” ì‚¬ëŒë“¤ì€ ë”°ë¡œ ì¶”ê°€ì ì¸ ì„¤ì •ì„ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. 


# ì˜¤ë¥˜ ì›ì¸ ë° í•´ê²°
  Mysqlì´ ë²„ì „ì´ ì—…ë°ì´íŠ¸ ë˜ë©´ì„œ, ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¸ì¦í•˜ëŠ” ë°©ì‹ì—ì„œ ì°¨ì´ê°€ ìƒê²¼ìŠµë‹ˆë‹¤. ì˜›ë‚ ì˜ Mysql ì„œë²„ì—ì„œëŠ” default_authentication_pluginì˜ ê°’ì´ mysql_native_password ì˜€ëŠ”ë°, Mysql 8.0ìœ¼ë¡œ ë²„ì „ì´ ì—…ë°ì´íŠ¸ ë˜ë©´ì„œ default_authentication_plugin ê°’ì´ caching_sha2_passwordë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. 

  ì¦‰ webhacking.kr 30ë²ˆ ë¬¸ì œì—ì„œì˜ mysql clientì—ì„œëŠ” êµ¬í˜• libraryë¥¼ ì‚¬ìš©í•´ì„œ ìµœì‹  pluginì¸ caching_sha2_password ë°©ì‹ì„ ì§€ì›í•˜ì§€ ëª»í•´ì„œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ~~ì €ëŠ” ì›ì¸ì„ ì°¾ëŠë¼ ì‚½ì§ˆì„ ì¢€ ë§ì´ í–ˆìŠµë‹ˆë‹¤ ã…ã…..~~

  ì € ì²˜ëŸ¼ ìƒˆë¡œ í´ë¼ìš°ë“œë¥¼ ì„¤ì¹˜í•˜ê³ , mysql ì„œë²„ë¥¼ ìµœì‹ ìœ¼ë¡œ ë°›ìœ¼ë©´ plugin ê°’ì„ ë°”ê¿”ì¤˜ì•¼ í•©ë‹ˆë‹¤. ë‹¤ìŒ ê·¸ë¦¼ì€ mysql ì„œë²„ì—ì„œ pluginì •ë³´ë¥¼ ì¶œë ¥í•œ ê²ƒì…ë‹ˆë‹¤. ê¸°ë³¸ìœ¼ë¡œ ë”°ë¡œ ì„¤ì •í•´ ì£¼ì§€ ì•Šì•˜ë‹¤ë©´ caching_sha2_passwordë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/152642948-9267b444-473c-4327-8117-1dd3e2882e8c.png)

  ì´ì œ ì´ ê°’ì„ mysql_native_passwordë¡œ ë°”ê¿”ì£¼ë©´ ë©ë‹ˆë‹¤.

  ```sql
  ALTER USER 'test'@'%' IDENTIFIED WITH mysql_native_password BY 'test1234';
  ```

  ![image](https://user-images.githubusercontent.com/33647663/152643139-69815877-9d5d-4c7a-aaf6-ec2c8923fe0e.png)

  í•´ë‹¹ ì„¤ì •ì„ í•´ì¤€ë’¤ ë‹¤ì‹œ ì ‘ì†ì„ í•´ì£¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ flagê°€ ì¶œë ¥ë©ë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/152643146-8e7c58e1-6aec-48ac-a169-11fe59373469.png)


  


