---
title: "[webhacking.kr] 2번 문제 풀이[php]"
categories:
  - webhacking
tags:
  - webhacking.kr
  - wargame
  - blind sql injection
toc: true
toc_sticky: true
toc_label: "2번 문제 풀이"
toc_icon: "bookmark"
author_profile: true
---

💡 Webhacking.kr challenge(old) 2번 문제에 대한 풀이입니다.
{: .notice--warning}

# 문제
## 문제 화면 & 문제 분석
  2번 문제는 일단 무엇을 해야 하는지 부터 찾아야 하는 문제였습니다. 메인 페이지를 들어가면, IP가 로그되고 있다는 내용밖에 없기 때문에 **개발자 모드**와 쿠키 값을 먼저 확인해 봅니다.

 ![image](https://user-images.githubusercontent.com/33647663/150627725-6d83d9bb-32ce-4103-91c5-88a32be657fd.png){: .align-center}

  일단 쿠키 값에는 'time'이라는 쿠키가 있었습니다.

  ![image](https://user-images.githubusercontent.com/33647663/150627776-6671c9bc-b629-4a89-9824-70f883322cfd.png){: .align-center}

  그 다음 페이지 소스코드를 보면, 다음과 같이 ~~친절히~~ admin.php로 들어가 보라고 가르쳐 줍니다.

  ![image](https://user-images.githubusercontent.com/33647663/150627800-2c1a3cdc-4b68-4729-b6bc-73dbd6217b39.png){: .align-center}

  admin.php에는 비밀번호를 입력하는 칸이 있습니다.

  ![image](https://user-images.githubusercontent.com/33647663/150627812-a2c70482-cbad-4de1-90c5-5c8079c334a6.png){: .align-center}

  ![image](https://user-images.githubusercontent.com/33647663/150627831-a837bb74-6c71-4fc3-867f-5e5acf636441.png){: .align-center}

  비밀번호를 입력하는 칸에 ```admin```, ```guest```, ```' or 1=1-- ```값을 입력해보면 비밀번호가 틀렸다고 나오는 걸 보니 비밀번호를 알아내서 입력하면 풀리는 문제로 추측됩니다.

  ![image](https://user-images.githubusercontent.com/33647663/150627878-0dc1e212-b45d-4276-a71d-f5d64aeda449.png){: .align-center}

  일단 여기까지는 방향을 못잡았는데 문제에서 힌트인 ```너의 IP가 기록되고 있다```를 이용해 보기 위해서 Burp_suite로 패킷을 잡아봅니다.

  ![image](https://user-images.githubusercontent.com/33647663/150627979-89945971-7ccb-4c8c-8cd7-463b6f70627f.png){: .align-center}

  잡아봐도 특별한건 없는데, 쿠키 값에 'time'이 있다는게 의심해 볼 만한 부분입니다. 원래는 서버에서 시간을 계산해서 처리하지 클라이언트로 시간값을 쿠키로 주는 경우는 없기 때문에 저 부분을 바꿔봅니다. 다음 그림처럼 클라이언트가 주는 시간값에 따라서 주석의 시간이 바뀌는 것을 볼 수 있습니다.

  ![image](https://user-images.githubusercontent.com/33647663/150628153-9a17f1a6-fd0d-4f53-acef-ea86520945a5.png){: .align-center}

  여기까지가 제가 알아낸 부분이고,,, 그 뒤로는 뭐 어떤걸 해야할 지 모르겠어서,,, 무엇보다 문제 페이지에서 IP가 기록되고 있다는 부분의 힌트를 이용하지 못하는 거 같아서 그 부분을 위주로 삽질을 좀 해보다가 그래도 못찾았습니다  ㅜㅜ 

  그래서 다른 포스팅을 참고해 봤더니 time 부분을 이용해서 sql injection을 하더라구요??? 여러개를 읽어 봤는데 다들 다짜고짜 injection을 하긴 하던데 솔직히 아직까지도 왜 서버에서 주석에 들어가는 부분이 DB에서 쿼리를 통한 결과가 나오는지 이해가 안가긴 합니다...

  제가 생각한 코드 흐름은 **1**처럼 사용자의 쿠키 값을 받아서 그대로 주석에 넣어주는 거였는데, 지금 문제의 경우에는 사용자한테 받은 시간값을 굳이 DB에 접속을 한다음 뭔 짓을 한다는 건데 조금 억지인 느낌인,,, sudo 코드로 작성을 해보려고 해도 잘 안되네요

  ```php
  // 내가 생각한 서버쪽 php 작동 로직
  <? php
   $time = $_COOKIES['time']
   $time을 날짜 형식으로 변환하는 로직
  echo("<!------ {$time} ---->");
  ?>
  ```

 ```php
 // 문제에서 실제로 작동하는 로직은 사용자의 time값이 DB를 거치게 되어있음.
  <? php
  $time = $_COOKIES['time']
  $DB = dbconnect();

  // DB에서 insert 후 Select 
  // 무슨 내용을 insert 하는지는 모르겠음
  // sql("select time from chall2 where ~"); 이런식으로 ?
 ```

  뭐 아무튼 time 부분이 DB의 쿼리로 들어가고, 참인경우와 거짓인 경우 다음처럼 응답값에 차이가 나온다는 것을 확인했습니다.

  ![image](https://user-images.githubusercontent.com/33647663/150628768-dd728134-8e24-434d-a857-a4385b59139b.png){: .align-center}
  ![image](https://user-images.githubusercontent.com/33647663/150628773-cf6d0aee-805c-44e7-ae46-7f67f53ca4e9.png){: .align-center}

  이제 참 거짓에 따른 응답 값을 알 수 있으므로 Blind Sql injection 공격을 수행하겠습니다.


# 문제 풀이
## 소스코드 설계
 지금 처럼 아무 것도 없는 상태에서 Blind Sql injection을 수행하려면 다음의 단계를 거쳐야 합니다
 
 1. DB 명을 알아내기 
   
   ```mysql
   database()
   ```

 2. table 명을 알아내기
   
   ```mysql
   select table_name from information_schema.tables where table_schema = [DB명]
   ```
 3. column 명을 알아내기
   
   ```mysql
   select column_name from information_schema.columns where table_name = [table 명]
   ```
 4. 해당 컬럼에서 데이터 뽑기

   ```mysql
   select [column명] from [table 명] 
   ```


### 1. DB명




